# =============================================================================
# FIXZIT ENVIRONMENT CONFIGURATION
# =============================================================================
# Copy this file to .env.local for development
# For production, configure these in your hosting platform (Vercel, AWS, etc.)
# =============================================================================

# === NODE ENVIRONMENT ===
NODE_ENV=development

# === APPLICATION URLS ===
NEXT_PUBLIC_APP_URL=http://localhost:3000
# NOTE: No separate backend on port 5000 - Next.js handles everything on port 3000

# Base URL for generating links (referrals, email templates, etc.)
# Production: https://fixzit.sa
# Staging: https://staging.fixzit.sa
# Development: http://localhost:3000
BASE_URL=http://localhost:3000
NEXT_PUBLIC_BASE_URL=http://localhost:3000
CORS_ORIGINS=http://localhost:3000

# Public contact details (surfaced on /about). Must be set in production.
NEXT_PUBLIC_CONTACT_EMAIL=info@example.com
NEXT_PUBLIC_CONTACT_PHONE=
NEXT_PUBLIC_SUPPORT_EMAIL=support@example.com
SELLER_PORTAL_URL=http://localhost:3000
SELLER_SUPPORT_EMAIL=support@example.com

# =============================================================================
# CRITICAL: REQUIRED FOR PRODUCTION
# =============================================================================

# === DATABASE (MongoDB) ===
# Development (Docker): mongodb://admin:fixzit2024@localhost:27017/fixzit?authSource=admin
# Production: Use MongoDB Atlas connection string
MONGODB_URI=mongodb://localhost:27017/fixzit
MONGODB_DB=fixzit

# Local Docker secrets (used by docker-compose.yml)
# NOTE: Set strong values before running `docker compose up`
MONGO_INITDB_ROOT_USERNAME=fixzit_admin
MONGO_INITDB_ROOT_PASSWORD=
MONGO_INITDB_DATABASE=fixzit
# Optional override for app containers (defaults to local Mongo service URI)
COMPOSE_MONGODB_URI=

# === JWT AUTHENTICATION ===
# MUST be 32+ characters, cryptographically random
# Generate: openssl rand -hex 32
# Production: Use AWS Secrets Manager, HashiCorp Vault, or environment variables
# NEVER commit the actual secret to git!
JWT_SECRET=

# === NEXTAUTH (OAuth Authentication) ===
# Multiple secrets strategy (security best practice):
# - JWT_SECRET: Used by custom auth.ts functions for API tokens
# - NEXTAUTH_SECRET: Used by NextAuth.js for OAuth session signing
# - INTERNAL_API_SECRET: Used for server-to-server authentication
# Each secret should be DIFFERENT to limit blast radius if one is compromised

# NextAuth secret for JWT signing (MUST be 32+ characters)
# Generate: openssl rand -base64 32
NEXTAUTH_SECRET=

# ⚠️ CRITICAL FOR VERCEL/PROXIED DEPLOYMENTS:
# Required to satisfy NextAuth host validation when running behind a reverse proxy.
# Without this, /api/auth/session and /api/auth/csrf will return 500 errors.
# Set to 'true' for Vercel, Cloudflare, AWS ALB, or any proxied deployment.
# Self-hosted/direct origin deployments can leave this unset (defaults to false).
AUTH_TRUST_HOST=true

# Allow fallback demo logins (local smoke tests only)
ALLOW_DEMO_LOGIN=false
# Optional: override default demo passwords (comma-separated)
# NEXTAUTH_DEMO_PASSWORDS=admin123,password123,Admin@123

# Super Admin OTP bypass for development only (requires NODE_ENV=development)
# In production, OTP is always required - configure SMS gateway properly
# NEXTAUTH_SUPERADMIN_BYPASS_OTP=true

# =============================================================================
# PRODUCTION OTP BYPASS (USE WITH EXTREME CAUTION)
# =============================================================================
# WARNING: Only enable these in controlled environments with additional security controls
# These allow bypassing SMS OTP verification for superadmin and test users
# SECURITY: Recommend using IP allowlisting when enabling these options

# Enable OTP bypass for superadmin@fixzit.co in production
# NEXTAUTH_BYPASS_OTP_ALL=true

# Enable OTP bypass for all demo/test users (use with ALLOW_TEST_USER_OTP_BYPASS)
# ALLOW_TEST_USER_OTP_BYPASS=true

# The bypass code to use (default: 000000) - change this to a secure value
# NEXTAUTH_BYPASS_OTP_CODE=000000

# Super Admin fallback phone for OTP (when user has no phone configured)
# NEXTAUTH_SUPERADMIN_FALLBACK_PHONE=+966500000000

# =============================================================================
# SUPERADMIN EMERGENCY PORTAL (/superadmin/login)
# =============================================================================
# This is a SEPARATE authentication system from NextAuth, used for emergency
# access when NextAuth is unavailable. Configure in Vercel/production.
#
# Username (defaults to "superadmin" if not set)
# SUPERADMIN_USERNAME=superadmin
#
# Password (REQUIRED - one of these must be set for emergency login to work)
# Option 1: Plaintext (for development only)
# SUPERADMIN_PASSWORD=your-strong-password-here
# Option 2: Bcrypt hash (recommended for production)
# Generate hash: node -e "console.log(require('bcryptjs').hashSync('password', 10))"
# SUPERADMIN_PASSWORD_HASH=$2a$10$...
#
# Org ID for session tokens (REQUIRED - uses first available)
# SUPERADMIN_ORG_ID= (or PUBLIC_ORG_ID or DEFAULT_ORG_ID)
#
# Optional: Second factor key for extra security
# SUPERADMIN_SECRET_KEY=
#
# Optional: IP allowlist (comma-separated, empty = allow all)
# SUPERADMIN_IP_ALLOWLIST=
#
# Optional: JWT secret (falls back to NEXTAUTH_SECRET if not set)
# SUPERADMIN_JWT_SECRET=

# Internal API secret for server-to-server authentication
# This should be DIFFERENT from NEXTAUTH_SECRET (security best practice)

# NOTE: E2E Playwright test credentials are configured in the
# "E2E TEST CREDENTIALS (RBAC VALIDATION)" section at the end of this file.
# NO FALLBACK CREDENTIALS exist - tests fail-fast if credentials are missing.
# See that section for detailed setup instructions.

# =============================================================================
# FACILITY MANAGEMENT (FM) FEATURE FLAGS
# =============================================================================
# Vendor assignments API remains mock-only until FMInspection integration lands.
# In production, leave VENDOR_ASSIGNMENTS_API_ENABLED=false and
# VENDOR_ASSIGNMENTS_API_MOCKS=false to avoid serving placeholder data.
VENDOR_ASSIGNMENTS_API_ENABLED=false
VENDOR_ASSIGNMENTS_API_MOCKS=false
# Client-side guard for the FM inspections workspace; keep aligned with server flags.
NEXT_PUBLIC_VENDOR_ASSIGNMENTS_API_ENABLED=false
NEXT_PUBLIC_VENDOR_ASSIGNMENTS_API_MOCKS=false

# =============================================================================
# SOUQ MARKETPLACE CONFIGURATION
# =============================================================================

# === FEATURE FLAGS (Souq Marketplace) ===
# Enable/disable marketplace features (gradual rollout)
SOUQ_FEATURE_ADS=false
SOUQ_FEATURE_DEALS=false
SOUQ_FEATURE_BUY_BOX=false
SOUQ_FEATURE_SETTLEMENT=false
SOUQ_FEATURE_RETURNS_CENTER=false
SOUQ_FEATURE_BRAND_REGISTRY=false
SOUQ_FEATURE_ACCOUNT_HEALTH=false
SOUQ_FEATURE_FULFILLMENT_BY_FIXZIT=false
SOUQ_FEATURE_A_TO_Z_CLAIMS=false
SOUQ_FEATURE_SPONSORED_PRODUCTS=false
SOUQ_FEATURE_AUTO_REPRICER=false
SOUQ_FEATURE_REVIEWS_QA=false

# === RETURNS / RMA ===
# Base URL for generating return labels (per-environment; avoids hard-coded prod host)
RETURN_LABEL_BASE_URL=http://localhost:3000
# Origin address for return shipments (override per region/tenant as needed)
RETURN_ORIGIN_NAME=Fixzit Returns Center
RETURN_ORIGIN_STREET=123 Warehouse St
RETURN_ORIGIN_CITY=Riyadh
RETURN_ORIGIN_STATE=Riyadh Province
RETURN_ORIGIN_POSTAL_CODE=11564
RETURN_ORIGIN_COUNTRY=SA

# === CACHE/QUEUE BACKEND ===
# Redis has been removed; caching and background jobs use in-memory stubs by default.

# === SEARCH ENGINE (Meilisearch) ===
# Development (Docker): http://localhost:7700
# Production: Use managed Meilisearch Cloud or self-hosted
MEILI_HOST=http://localhost:7700
# Generate: openssl rand -hex 32
MEILI_MASTER_KEY=

# Legacy (Deprecated - kept for backward compatibility only; prefer MEILI_HOST/MEILI_MASTER_KEY)
OPENSEARCH_URL=
OPENSEARCH_USERNAME=
OPENSEARCH_PASSWORD=
MEILISEARCH_HOST=http://localhost:7700
MEILISEARCH_API_KEY=
MEILI_SEARCH_TIMEOUT_MS=3000
MEILI_INDEXING_TIMEOUT_MS=5000
MEILI_MAX_ATTEMPTS=3
MEILI_RETRY_DELAY_MS=400

# === S3-COMPATIBLE STORAGE (Media & Documents) ===
# AWS S3, Cloudflare R2, MinIO, etc.
S3_ENDPOINT=
S3_ACCESS_KEY_ID=
S3_SECRET_ACCESS_KEY=
S3_BUCKET_NAME=fixzit-marketplace
S3_REGION=us-east-1

# === AV SCAN + STATUS TOKENS ===
# Optional: enable AV scanning for uploads (requires AV_SCAN_ENDPOINT service)
AV_SCAN_ENABLED=false
AV_SCAN_ENDPOINT=
# Per-tenant scan-status tokens (JSON map) for token-based polling without session cookies
# Example: {"tenant-1":"local-scan-token","tenant-2":"another-token"}
SCAN_STATUS_TOKENS_BY_ORG={"tenant-1":"local-scan-token"}
# Alternative single-token form: set org id + token together
SCAN_STATUS_TOKEN_ORG=tenant-1
SCAN_STATUS_TOKEN=
SCAN_STATUS_TOKEN_REQUIRED=false

# Local MinIO credentials (docker-compose.souq.yml)
MINIO_ROOT_USER=fixzit-minio
MINIO_ROOT_PASSWORD=

# === EVENT BUS (NATS or Kafka) ===
# NATS (Recommended for simpler setup)
NATS_URL=nats://localhost:4222
NATS_TOKEN=

# Kafka (Alternative for high-scale deployments)
KAFKA_BROKERS=localhost:9092
KAFKA_CLIENT_ID=fixzit-souq
KAFKA_GROUP_ID=fixzit-souq-group

# === PAYMENT GATEWAYS ===
# Tap Payments (Primary - Mada, Apple Pay, Credit Cards, STC Pay)
# Official Docs: https://developers.tap.company
# Dashboard: https://dashboard.tap.company

# Environment selector: "test" or "live" (defaults to NODE_ENV-based detection)
TAP_ENVIRONMENT=test

# Server-side secrets (NEVER expose to client)
TAP_TEST_SECRET_KEY=
TAP_LIVE_SECRET_KEY=
TAP_MERCHANT_ID=
TAP_ACCOUNT_ID=
TAP_API_KEY=
TAP_GOSELL_USERNAME=
TAP_GOSELL_PASSWORD=
TAP_WEBHOOK_SECRET=

# Client-safe public keys (used for card tokenization in browser)
NEXT_PUBLIC_TAP_TEST_PUBLIC_KEY=
NEXT_PUBLIC_TAP_LIVE_PUBLIC_KEY=

# Webhook configuration
TAP_WEBHOOK_MAX_BYTES=64000
TAP_WEBHOOK_RATE_LIMIT=60
TAP_WEBHOOK_RATE_WINDOW_MS=60000
TAP_WEBHOOK_IDEMPOTENCY_TTL_MS=300000

# Legacy Payment Gateways (Deprecated - use Tap instead)
# Mada (Saudi debit cards)
MADA_MERCHANT_ID=
MADA_API_KEY=
MADA_WEBHOOK_SECRET=

# STC Pay
STC_PAY_MERCHANT_ID=
STC_PAY_API_KEY=
STC_PAY_WEBHOOK_SECRET=

# Apple Pay
APPLE_PAY_MERCHANT_ID=
APPLE_PAY_CERTIFICATE=
APPLE_PAY_KEY=

# === CARRIER INTEGRATIONS (Shipping) ===
# Aramex
ARAMEX_ACCOUNT_NUMBER=
ARAMEX_USERNAME=
ARAMEX_PASSWORD=
ARAMEX_ACCOUNT_PIN=
ARAMEX_ACCOUNT_ENTITY=
ARAMEX_ACCOUNT_COUNTRY_CODE=SA
ARAMEX_API_URL=https://ws.aramex.net/ShippingAPI.V2/Shipping/Service_1_0.svc

# SMSA Express
SMSA_USERNAME=
SMSA_PASSWORD=
SMSA_API_URL=https://api.smsa.com.sa

# SPL (Saudi Post Logistics)
SPL_API_KEY=
SPL_API_URL=https://api.spl.com.sa

# === ZATCA E-INVOICING (Saudi VAT Compliance) ===
ZATCA_API_URL=https://api.zatca.gov.sa
ZATCA_OTP=
ZATCA_CERTIFICATE=
ZATCA_PRIVATE_KEY=

# === NOTIFICATIONS ===
# Smoke test recipient (for qa/notifications/run-smoke.ts)
NOTIFICATIONS_SMOKE_USER_ID=
NOTIFICATIONS_SMOKE_NAME=
NOTIFICATIONS_SMOKE_EMAIL=
NOTIFICATIONS_SMOKE_PHONE=

# Email (SendGrid, AWS SES, Mailgun)
# The codebase supports multiple aliases for Vercel naming conventions:
# - SENDGRID_API_KEY (preferred)
# - SEND_GRID (Vercel legacy)
# - SEND_GRID_EMAIL_FIXZIT_TOKEN (Vercel custom)
SENDGRID_API_KEY=
FROM_EMAIL=noreply@fixzit.sa

# === SMS PROVIDER CONFIGURATION ===
# Fixzit uses Taqnyat as the ONLY SMS provider (CITC-compliant for Saudi Arabia)
# Other providers (Twilio, Unifonic) have been removed for compliance.
# Get credentials from: https://taqnyat.sa

# Taqnyat API Bearer Token (required for production SMS)
TAQNYAT_BEARER_TOKEN=

# Taqnyat Sender Name/ID (must be registered with CITC)
TAQNYAT_SENDER_NAME=FIXZIT

# Optional: Webhook secret for delivery status verification
TAQNYAT_WEBHOOK_SECRET=

# Development mode: set to true to mock SMS locally without sending
# Default: true in development, false in production
SMS_DEV_MODE=true

# Optional webhook to stream notification metrics to dashboards (e.g., Datadog, PagerDuty Events API)
NOTIFICATIONS_TELEMETRY_WEBHOOK=
# Notification persistence retention (days)
NOTIFICATION_LOG_TTL_DAYS=90
NOTIFICATION_DLQ_TTL_DAYS=30

# === HEALTH CHECKS & MONITORING TOKENS ===
# Token for authenticating health check requests from load balancers/monitors.
# When set, health endpoints expose detailed diagnostics only to authorized callers.
# Without this token, health endpoints return minimal status (safe for public probes).
# Generate: openssl rand -hex 32
# Used by: /api/health, /api/health/sms, /api/health/auth
HEALTH_CHECK_TOKEN=

# === MONITORING & OBSERVABILITY ===
# Prometheus
PROMETHEUS_PORT=9090
# Disable default Node metrics collection (leave false unless scraping elsewhere)
PROM_METRICS_DISABLE_DEFAULTS=false

# Grafana
GRAFANA_URL=http://localhost:3001
GRAFANA_API_KEY=

# Sentry (Error tracking)
SENTRY_DSN=
SENTRY_ORG=fixzit
SENTRY_PROJECT=fixzit-marketplace

# === AI / COPILOT ===
# OpenAI API key for AI Copilot features
# Get from: https://platform.openai.com/api-keys
OPENAI_API_KEY=

# OpenAI model to use (gpt-4o-mini, gpt-4o, gpt-4-turbo)
COPILOT_MODEL=gpt-4o-mini

# Enforce business hours for AI features (true/false)
ENFORCE_AI_BUSINESS_HOURS=false

# Internal API secret for server-to-server authentication
# This should be DIFFERENT from NEXTAUTH_SECRET (security best practice)
# Generate: openssl rand -base64 32
INTERNAL_API_SECRET=

# NextAuth URL (application base URL)
NEXTAUTH_URL=http://localhost:3000

# Google OAuth credentials (get from Google Cloud Console)
# The codebase supports multiple aliases for Vercel naming conventions:
# - GOOGLE_CLIENT_ID (preferred)
# - GOOGLE_CLIENT_SECRET (preferred)
# - OAUTH_CLIENT_GOOGLE (Vercel legacy - maps to GOOGLE_CLIENT_SECRET)
GOOGLE_CLIENT_ID=your_google_client_id_here.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your_google_client_secret_here

# === SECURITY - EMAIL HASHING ===
# Salt for hashing email addresses in logs (privacy protection)
# This prevents rainbow table attacks on hashed email addresses
# Generate: openssl rand -hex 32
LOG_HASH_SALT=

# Salt for hashing identifiers in security monitoring keys
# Prevents dictionary reversal attacks if monitoring data is leaked
# If not set, falls back to LOG_HASH_SALT, then to no salt (dev only)
# Generate: openssl rand -hex 32
MONITORING_HASH_SALT=

# === SECURITY - PII ENCRYPTION ===
# Required for encrypting sensitive financial data (bank accounts, salary info, etc.)
# The codebase supports multiple aliases for Vercel naming conventions:
# - ENCRYPTION_KEY (preferred)
# - PII_ENCRYPTION_KEY (Vercel alternative)
# Generate: openssl rand -hex 32 (must be exactly 64 hex characters = 32 bytes)
ENCRYPTION_KEY=
# PII_ENCRYPTION_KEY= (alias, only set one)

# === OAUTH CONFIGURATION ===
# Comma-separated list of allowed email domains for OAuth sign-in
# Example: OAUTH_ALLOWED_DOMAINS="fixzit.com,fixzit.co,example.com"
# Default: fixzit.com,fixzit.co
OAUTH_ALLOWED_DOMAINS=fixzit.com,fixzit.co

# === SESSION MANAGEMENT ===
# Session duration in seconds
# Default: 86400 (24 hours)
# Options: 3600 (1 hour), 86400 (1 day), 604800 (7 days), 2592000 (30 days)
SESSION_DURATION=86400
SESSION_REMEMBER_DURATION=2592000

# =============================================================================
# MAPS & LOCATION (Google Maps)
# =============================================================================
NEXT_PUBLIC_GOOGLE_MAPS_API_KEY=your_google_maps_api_key_here
GOOGLE_MAPS_API_KEY=your_server_side_google_maps_key

# =============================================================================
# ZATCA E-INVOICING (Saudi Arabia Compliance)
# =============================================================================
ZATCA_TAXPAYER_ID=300000000000003
ZATCA_API_URL=https://gw-fatoora.zatca.gov.sa/e-invoicing/core
ZATCA_CERTIFICATE_PATH=/path/to/zatca-cert.pem
ZATCA_PRIVATE_KEY_PATH=/path/to/zatca-private-key.pem
ZATCA_OTP=your_otp_from_zatca

# ZATCA Phase 2 Clearance (for payment callback)
ZATCA_SELLER_NAME=Your Company Name
ZATCA_VAT_NUMBER=300000000000000
ZATCA_SELLER_ADDRESS=Saudi Arabia
ZATCA_CLEARANCE_API_URL=https://gw-fatoora.zatca.gov.sa/e-invoicing/core/invoices/clearance/single
ZATCA_API_KEY=your_zatca_api_key
ZATCA_TIMEOUT_MS=10000

# =============================================================================
# AWS SERVICES (S3, SES, CloudWatch)
# =============================================================================
AWS_ACCESS_KEY_ID=your_aws_access_key_id
AWS_SECRET_ACCESS_KEY=your_aws_secret_access_key
AWS_REGION=me-south-1
AWS_S3_BUCKET=fixzit-uploads
AWS_SES_FROM_EMAIL=noreply@yourdomain.com

# =============================================================================
# EMAIL SERVICE (SendGrid OR AWS SES)
# =============================================================================
# Option 1: SendGrid (RECOMMENDED for Production)
SENDGRID_API_KEY=your_sendgrid_api_key
SENDGRID_FROM_EMAIL=noreply@yourdomain.com
SENDGRID_FROM_NAME=Fixzit
SENDGRID_REPLY_TO_EMAIL=support@yourdomain.com
SENDGRID_REPLY_TO_NAME=Fixzit Support

# SendGrid Advanced Features (Optional)
SENDGRID_UNSUBSCRIBE_GROUP_ID=your_unsubscribe_group_id
SENDGRID_IP_POOL_NAME=your_ip_pool_name
SENDGRID_WEBHOOK_VERIFICATION_KEY=your_webhook_key

# SendGrid Dynamic Templates (Optional - use Template IDs instead of HTML)
SENDGRID_TEMPLATE_WELCOME=d-your_welcome_template_id
SENDGRID_TEMPLATE_PASSWORD_RESET=d-your_password_reset_template_id
SENDGRID_TEMPLATE_NOTIFICATION=d-your_notification_template_id
SENDGRID_TEMPLATE_INVOICE=d-your_invoice_template_id

# NOTE: FROM_EMAIL is defined in the core Email section above (noreply@fixzit.sa)
# Do not redefine here to avoid conflicts

# Option 2: SMTP (Gmail, Office365, etc.)
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USER=your_email@yourdomain.com
EMAIL_PASS=your_app_specific_password
EMAIL_FROM=noreply@yourdomain.com

# =============================================================================
# AI & EMBEDDINGS (OpenAI)
# =============================================================================
# Optional: Enables higher quality answers in Help Q&A and Copilot
OPENAI_API_KEY=your_openai_api_key

# =============================================================================
# MONITORING & LOGGING (Optional but Recommended for Production)
# =============================================================================
# Sentry (Error Tracking) - NEXT_PUBLIC_ prefix required for client-side error capture
# NOTE: SENTRY_DSN, SENTRY_ORG, SENTRY_PROJECT are defined in the Sentry section above (lines ~360)
NEXT_PUBLIC_SENTRY_DSN=your_sentry_dsn
SENTRY_AUTH_TOKEN=your_sentry_auth_token

# Datadog (APM & Monitoring)
DATADOG_API_KEY=your_datadog_api_key
DATADOG_APP_KEY=your_datadog_app_key
DATADOG_SITE=datadoghq.com

# =============================================================================
# CACHING (Redis - Optional for Distributed Rate Limiting)
# =============================================================================
# =============================================================================
# MODULE CONTROL (Dynamic Import System)
# =============================================================================
# Set to 'false' or remove to disable specific modules
# Disabled modules return HTTP 501 with clear error messages
WO_ENABLED=true              # Work Orders module
INVOICE_ENABLED=true         # Invoicing module  
PROPERTY_ENABLED=true        # Property Management (Aqar) module
ASSET_ENABLED=true           # Asset Tracking module
VENDOR_ENABLED=true          # Vendor Management module
RFQ_ENABLED=true             # Request for Quote module
SUPPORT_ENABLED=true         # Support Tickets module
# Support public org for anonymous incident reporting (requires ENABLE_ANONYMOUS_INCIDENTS=true)
# Must be a valid MongoDB ObjectId for an org that handles anonymous/public tickets
SUPPORT_PUBLIC_ORG_ID=
# Enable anonymous incident reporting (unauthenticated users can submit diagnostics)
ENABLE_ANONYMOUS_INCIDENTS=false
MARKETPLACE_ENABLED=true     # Marketplace module
ATS_ENABLED=true             # Applicant Tracking System module

# =============================================================================
# FEATURE FLAGS
# =============================================================================
ENABLE_PAYMENT_GATEWAY=true
ENABLE_SMS_OTP=false
ENABLE_EMAIL_NOTIFICATIONS=true
ENABLE_GOOGLE_MAPS=true
ENABLE_ZATCA_INTEGRATION=true
ENABLE_AQAR_MODULE=true
ENABLE_ATS_MODULE=true

# =============================================================================
# AQAR (PROPERTY) PRICING CONFIGURATION
# =============================================================================
# Platform commission on bookings (percentage, default: 15)
PLATFORM_FEE_PERCENTAGE=15

# Booking refund policy (days before check-in)
BOOKING_FULL_REFUND_DAYS=7        # Full refund if cancelled 7+ days before
BOOKING_PARTIAL_REFUND_DAYS=3     # Partial refund if cancelled 3-6 days before
BOOKING_PARTIAL_REFUND_PERCENT=50 # Percentage of partial refund (default: 50%)

# Boost pricing (SAR per day)
BOOST_FEATURED_PRICE_PER_DAY=100      # Featured listing (top of search)
BOOST_PINNED_PRICE_PER_DAY=50         # Pinned listing (stays at top)
BOOST_HIGHLIGHTED_PRICE_PER_DAY=25    # Highlighted listing (visual emphasis)

# =============================================================================
# RATE LIMITING
# =============================================================================
# Override default rate limits (requests per window)
KB_SEARCH_MAX_RATE_PER_MIN=60

# =============================================================================
# FILE STORAGE
# =============================================================================
STORAGE_TYPE=local           # Options: local, s3
MAX_FILE_SIZE=10485760       # 10MB in bytes

# =============================================================================
# SESSION & SECURITY
# =============================================================================
# Note: Session management is handled by NextAuth with NEXTAUTH_SECRET above
COOKIE_DOMAIN=.yourdomain.com
COOKIE_SECURE=false          # Set to true in production (requires HTTPS). False for local dev over http://localhost

# =============================================================================
# BUILD & PERFORMANCE
# =============================================================================
NODE_OPTIONS=--max-old-space-size=8192  # Match VS Code/Next.js 8GB cap; lower only if hardware constrained

# =============================================================================
# DEVELOPMENT TOOLS
# =============================================================================
# Enable detailed logging in development
DEBUG=false
LOG_LEVEL=info               # Options: error, warn, info, verbose, debug

# =============================================================================
# E2E TEST CREDENTIALS (RBAC VALIDATION)
# =============================================================================
# Credentials for E2E tests validating RBAC (Role-Based Access Control).
#
# ⚠️  IMPORTANT: NO FALLBACK CREDENTIALS EXIST
# Tests FAIL-FAST if these are not configured. This is intentional:
# - RBAC tests MUST use real credentials to validate role-based access
# - Fake/dummy credentials would mask permission regressions
# - Fork PRs automatically skip E2E tests (secrets unavailable)
#
# SETUP INSTRUCTIONS:
# 1. Create test users in your database with appropriate roles
# 2. Configure credentials in .env.local (never commit to git)
# 3. For CI, configure GitHub Actions Secrets
#
# SECURITY: Never commit actual credentials. Use:
# - .env.local for local testing (already in .gitignore)
# - GitHub Actions Secrets for CI
#
# Create test users in your database with these roles:
# - FINANCE_OFFICER: TEAM_MEMBER role + subRole: 'FINANCE_OFFICER'
# - HR_OFFICER: TEAM_MEMBER role + subRole: 'HR_OFFICER'
# - SUPPORT_AGENT: TEAM_MEMBER role + subRole: 'SUPPORT_AGENT'
# - OPERATIONS_MANAGER: TEAM_MEMBER role + subRole: 'OPERATIONS_MANAGER'
# - TEAM_MEMBER: TEAM_MEMBER role with no subRole
# - ADMIN: ADMIN role

# Finance Officer (access to finance module APIs)
TEST_FINANCE_OFFICER_EMAIL=
TEST_FINANCE_OFFICER_PASSWORD=
TEST_FINANCE_OFFICER_EMPLOYEE=

# HR Officer (access to HR module APIs)
TEST_HR_OFFICER_EMAIL=
TEST_HR_OFFICER_PASSWORD=
TEST_HR_OFFICER_EMPLOYEE=

# Support Agent (access to support/tickets APIs)
TEST_SUPPORT_AGENT_EMAIL=
TEST_SUPPORT_AGENT_PASSWORD=
TEST_SUPPORT_AGENT_EMPLOYEE=
# REQUIRED for row-level RBAC: MongoDB _id of SUPPORT_AGENT test user
# Used to verify agent only sees tickets assigned to them (not all org tickets)
TEST_SUPPORT_AGENT_USER_ID=

# Operations Manager (access to work orders, properties, marketplace APIs)
TEST_OPERATIONS_MANAGER_EMAIL=
TEST_OPERATIONS_MANAGER_PASSWORD=
TEST_OPERATIONS_MANAGER_EMPLOYEE=

# Team Member without sub-role (limited access, used for negative tests)
TEST_TEAM_MEMBER_EMAIL=
TEST_TEAM_MEMBER_PASSWORD=
TEST_TEAM_MEMBER_EMPLOYEE=
# REQUIRED for row-level RBAC: MongoDB _id of TEAM_MEMBER test user
# Used to verify member only sees work orders assigned to them (not all org work orders)
TEST_TEAM_MEMBER_USER_ID=

# Admin user (full access to all modules)
TEST_ADMIN_EMAIL=
TEST_ADMIN_PASSWORD=
# Admin employee number (required for employee-number login test in auth.spec.ts)
TEST_ADMIN_EMPLOYEE=

# =============================================================================
# MULTI-TENANCY VALIDATION
# =============================================================================
# Required for tenant-scoped E2E tests to verify data isolation
# Set this to your test organization's MongoDB ObjectId
# Used by expectAllowedWithBodyCheck() to validate org_id in API responses
# This catches cross-tenant data leaks that status-only checks miss
TEST_ORG_ID=

# ⚠️ REQUIRED FOR PUBLIC AUTH ROUTES (signup, forgot-password, reset-password, etc.)
# Create a dedicated "Public" organization in your database for unauthenticated users.
# This isolates public user data from internal tenant data.
# The signup route WILL FAIL with 500 error if these are not set.
PUBLIC_ORG_ID=
DEFAULT_ORG_ID=
# Used by /api/support/incidents when ENABLE_ANONYMOUS_INCIDENTS=true to file tickets
# under a safe public org scope. Set to the orgId of your "Public" org.
SUPPORT_PUBLIC_ORG_ID=

# Optional: Bypass TEST_ORG_ID requirement for local development
# When running E2E tests locally without TEST_ORG_ID, tests will fail by default
# Set this to 'true' to acknowledge the skip and continue without tenant validation
# WARNING: This should NEVER be enabled in CI - it's for local DX only
# 
# Used by: auth.spec.ts, subrole-api-access.spec.ts, work-orders-flow.spec.ts, marketplace-flow.spec.ts
ALLOW_MISSING_TEST_ORG_ID=false

# =============================================================================
# NOTES
# =============================================================================
# 1. Copy this file to .env.local for development
# 2. Never commit .env.local to git (already in .gitignore)
# 3. For production, set these in your hosting platform environment variables
# 4. Generate strong secrets: openssl rand -hex 32
# 5. See PRODUCTION_DEPLOYMENT_GUIDE.md for detailed setup instructions
