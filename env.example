# =============================================================================
# FIXZIT ENVIRONMENT CONFIGURATION
# =============================================================================
# Copy this file to .env.local for development
# For production, configure these in your hosting platform (Vercel, AWS, etc.)
# =============================================================================

# === NODE ENVIRONMENT ===
NODE_ENV=development

# === APPLICATION URLS ===
NEXT_PUBLIC_APP_URL=http://localhost:3000
# NOTE: No separate backend on port 5000 - Next.js handles everything on port 3000

# Base URL for generating links (referrals, email templates, etc.)
# Production: https://fixzit.sa
# Staging: https://staging.fixzit.sa
# Development: http://localhost:3000
BASE_URL=http://localhost:3000
NEXT_PUBLIC_BASE_URL=http://localhost:3000

# =============================================================================
# CRITICAL: REQUIRED FOR PRODUCTION
# =============================================================================

# === DATABASE (MongoDB) ===
# Development (Docker): mongodb://admin:fixzit2024@localhost:27017/fixzit?authSource=admin
# Production: Use MongoDB Atlas connection string
MONGODB_URI=mongodb://localhost:27017/fixzit
MONGODB_DB=fixzit

# === JWT AUTHENTICATION ===
# MUST be 32+ characters, cryptographically random
# Generate: openssl rand -hex 32
# Production: Use AWS Secrets Manager, HashiCorp Vault, or environment variables
# NEVER commit the actual secret to git!
JWT_SECRET=

# === NEXTAUTH (OAuth Authentication) ===
# Multiple secrets strategy (security best practice):
# - JWT_SECRET: Used by custom auth.ts functions for API tokens
# - NEXTAUTH_SECRET: Used by NextAuth.js for OAuth session signing
# - INTERNAL_API_SECRET: Used for server-to-server authentication
# Each secret should be DIFFERENT to limit blast radius if one is compromised

# NextAuth secret for JWT signing (MUST be 32+ characters)
# Generate: openssl rand -base64 32
NEXTAUTH_SECRET=

# Internal API secret for server-to-server authentication
# This should be DIFFERENT from NEXTAUTH_SECRET (security best practice)

# =============================================================================
# SOUQ MARKETPLACE CONFIGURATION
# =============================================================================

# === FEATURE FLAGS (Souq Marketplace) ===
# Enable/disable marketplace features (gradual rollout)
SOUQ_FEATURE_ADS=false
SOUQ_FEATURE_DEALS=false
SOUQ_FEATURE_BUY_BOX=false
SOUQ_FEATURE_SETTLEMENT=false
SOUQ_FEATURE_RETURNS_CENTER=false
SOUQ_FEATURE_BRAND_REGISTRY=false
SOUQ_FEATURE_ACCOUNT_HEALTH=false
SOUQ_FEATURE_FULFILLMENT_BY_FIXZIT=false
SOUQ_FEATURE_A_TO_Z_CLAIMS=false
SOUQ_FEATURE_SPONSORED_PRODUCTS=false
SOUQ_FEATURE_AUTO_REPRICER=false
SOUQ_FEATURE_REVIEWS_QA=false

# === REDIS (Caching & Job Queues) ===
# Development: redis://localhost:6379
# Production: Use managed Redis (AWS ElastiCache, Redis Cloud)
REDIS_URL=redis://localhost:6379
REDIS_PASSWORD=
REDIS_TTL=300

# === BULLMQ (Background Jobs) ===
# Uses Redis for queue storage
BULLMQ_REDIS_HOST=localhost
BULLMQ_REDIS_PORT=6379
BULLMQ_REDIS_PASSWORD=

# === SEARCH ENGINE (Meilisearch) ===
# Development (Docker): http://localhost:7700
# Production: Use managed Meilisearch Cloud or self-hosted
MEILI_HOST=http://localhost:7700
MEILI_MASTER_KEY=fixzit_search_master_key_2025_secure

# Legacy (Deprecated - migrating to Meilisearch)
OPENSEARCH_URL=
OPENSEARCH_USERNAME=
OPENSEARCH_PASSWORD=
MEILISEARCH_HOST=http://localhost:7700
MEILISEARCH_API_KEY=

# === S3-COMPATIBLE STORAGE (Media & Documents) ===
# AWS S3, Cloudflare R2, MinIO, etc.
S3_ENDPOINT=
S3_ACCESS_KEY_ID=
S3_SECRET_ACCESS_KEY=
S3_BUCKET_NAME=fixzit-marketplace
S3_REGION=us-east-1

# === EVENT BUS (NATS or Kafka) ===
# NATS (Recommended for simpler setup)
NATS_URL=nats://localhost:4222
NATS_TOKEN=

# Kafka (Alternative for high-scale deployments)
KAFKA_BROKERS=localhost:9092
KAFKA_CLIENT_ID=fixzit-souq
KAFKA_GROUP_ID=fixzit-souq-group

# === PAYMENT GATEWAYS ===
# Tap Payments (Primary - Mada, Apple Pay, Credit Cards, STC Pay)
# Official Docs: https://developers.tap.company
# Dashboard: https://dashboard.tap.company
TAP_SECRET_KEY=sk_test_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
TAP_PUBLIC_KEY=pk_test_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
TAP_WEBHOOK_SECRET=whsec_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

# Legacy Payment Gateways (Deprecated - use Tap instead)
# Mada (Saudi debit cards)
MADA_MERCHANT_ID=
MADA_API_KEY=
MADA_WEBHOOK_SECRET=

# STC Pay
STC_PAY_MERCHANT_ID=
STC_PAY_API_KEY=
STC_PAY_WEBHOOK_SECRET=

# Apple Pay
APPLE_PAY_MERCHANT_ID=
APPLE_PAY_CERTIFICATE=
APPLE_PAY_KEY=

# === CARRIER INTEGRATIONS (Shipping) ===
# Aramex
ARAMEX_ACCOUNT_NUMBER=
ARAMEX_USERNAME=
ARAMEX_PASSWORD=
ARAMEX_ACCOUNT_PIN=
ARAMEX_ACCOUNT_ENTITY=
ARAMEX_ACCOUNT_COUNTRY_CODE=SA
ARAMEX_API_URL=https://ws.aramex.net/ShippingAPI.V2/Shipping/Service_1_0.svc

# SMSA Express
SMSA_USERNAME=
SMSA_PASSWORD=
SMSA_API_URL=https://api.smsa.com.sa

# SPL (Saudi Post Logistics)
SPL_API_KEY=
SPL_API_URL=https://api.spl.com.sa

# === ZATCA E-INVOICING (Saudi VAT Compliance) ===
ZATCA_API_URL=https://api.zatca.gov.sa
ZATCA_OTP=
ZATCA_CERTIFICATE=
ZATCA_PRIVATE_KEY=

# === NOTIFICATIONS ===
# Email (SendGrid, AWS SES, Mailgun)
SENDGRID_API_KEY=
FROM_EMAIL=noreply@fixzit.sa

# SMS (Twilio, Unifonic)
TWILIO_ACCOUNT_SID=
TWILIO_AUTH_TOKEN=
TWILIO_PHONE_NUMBER=
# SMS_DEV_MODE=true   # Mock SMS locally when Twilio not configured (set false to force real SMS)

# Optional webhook to stream notification metrics to dashboards (e.g., Datadog, PagerDuty Events API)
NOTIFICATIONS_TELEMETRY_WEBHOOK=

# === MONITORING & OBSERVABILITY ===
# Prometheus
PROMETHEUS_PORT=9090

# Grafana
GRAFANA_URL=http://localhost:3001
GRAFANA_API_KEY=

# Sentry (Error tracking)
SENTRY_DSN=
SENTRY_ORG=fixzit
SENTRY_PROJECT=fixzit-marketplace

# Internal API secret for server-to-server authentication
# This should be DIFFERENT from NEXTAUTH_SECRET (security best practice)
# Generate: openssl rand -base64 32
INTERNAL_API_SECRET=

# NextAuth URL (application base URL)
NEXTAUTH_URL=http://localhost:3000

# Google OAuth credentials (get from Google Cloud Console)
GOOGLE_CLIENT_ID=your_google_client_id_here.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your_google_client_secret_here

# === SECURITY - EMAIL HASHING ===
# Salt for hashing email addresses in logs (privacy protection)
# This prevents rainbow table attacks on hashed email addresses
# Generate: openssl rand -hex 32
LOG_HASH_SALT=

# === OAUTH CONFIGURATION ===
# Comma-separated list of allowed email domains for OAuth sign-in
# Example: OAUTH_ALLOWED_DOMAINS="fixzit.com,fixzit.co,example.com"
# Default: fixzit.com,fixzit.co
OAUTH_ALLOWED_DOMAINS=fixzit.com,fixzit.co

# === SESSION MANAGEMENT ===
# Session duration in seconds
# Default: 86400 (24 hours)
# Options: 3600 (1 hour), 86400 (1 day), 604800 (7 days), 2592000 (30 days)
SESSION_DURATION=86400
SESSION_REMEMBER_DURATION=2592000

# =============================================================================
# PAYMENT GATEWAY (PayTabs - Saudi Arabia)
# =============================================================================
PAYTABS_PROFILE_ID=your_profile_id_here
PAYTABS_SERVER_KEY=your_server_key_here
PAYTABS_CLIENT_KEY=your_client_key_here
PAYTABS_REGION=SAU
PAYTABS_CURRENCY=SAR
PAYTABS_BASE_URL=https://secure.paytabs.sa
PAYTABS_PAYOUT_ENABLED=false
ENABLE_SADAD_PAYOUTS=false

# =============================================================================
# MAPS & LOCATION (Google Maps)
# =============================================================================
NEXT_PUBLIC_GOOGLE_MAPS_API_KEY=your_google_maps_api_key_here
GOOGLE_MAPS_API_KEY=your_server_side_google_maps_key

# =============================================================================
# ZATCA E-INVOICING (Saudi Arabia Compliance)
# =============================================================================
ZATCA_TAXPAYER_ID=300000000000003
ZATCA_API_URL=https://gw-fatoora.zatca.gov.sa/e-invoicing/core
ZATCA_CERTIFICATE_PATH=/path/to/zatca-cert.pem
ZATCA_PRIVATE_KEY_PATH=/path/to/zatca-private-key.pem
ZATCA_OTP=your_otp_from_zatca

# ZATCA Phase 2 Clearance (for PayTabs callback)
ZATCA_SELLER_NAME=Your Company Name
ZATCA_VAT_NUMBER=300000000000000
ZATCA_SELLER_ADDRESS=Saudi Arabia
ZATCA_CLEARANCE_API_URL=https://gw-fatoora.zatca.gov.sa/e-invoicing/core/invoices/clearance/single
ZATCA_API_KEY=your_zatca_api_key

# =============================================================================
# AWS SERVICES (S3, SES, CloudWatch)
# =============================================================================
AWS_ACCESS_KEY_ID=your_aws_access_key_id
AWS_SECRET_ACCESS_KEY=your_aws_secret_access_key
AWS_REGION=me-south-1
AWS_S3_BUCKET=fixzit-uploads
AWS_SES_FROM_EMAIL=noreply@yourdomain.com

# =============================================================================
# EMAIL SERVICE (SendGrid OR AWS SES)
# =============================================================================
# Option 1: SendGrid (RECOMMENDED for Production)
SENDGRID_API_KEY=your_sendgrid_api_key
SENDGRID_FROM_EMAIL=noreply@yourdomain.com
SENDGRID_FROM_NAME=Fixzit
SENDGRID_REPLY_TO_EMAIL=support@yourdomain.com
SENDGRID_REPLY_TO_NAME=Fixzit Support

# SendGrid Advanced Features (Optional)
SENDGRID_UNSUBSCRIBE_GROUP_ID=your_unsubscribe_group_id
SENDGRID_IP_POOL_NAME=your_ip_pool_name
SENDGRID_WEBHOOK_VERIFICATION_KEY=your_webhook_key

# SendGrid Dynamic Templates (Optional - use Template IDs instead of HTML)
SENDGRID_TEMPLATE_WELCOME=d-your_welcome_template_id
SENDGRID_TEMPLATE_PASSWORD_RESET=d-your_password_reset_template_id
SENDGRID_TEMPLATE_NOTIFICATION=d-your_notification_template_id
SENDGRID_TEMPLATE_INVOICE=d-your_invoice_template_id

# Legacy Support (backward compatibility)
FROM_EMAIL=noreply@yourdomain.com

# Option 2: SMTP (Gmail, Office365, etc.)
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USER=your_email@yourdomain.com
EMAIL_PASS=your_app_specific_password
EMAIL_FROM=noreply@yourdomain.com

# =============================================================================
# SMS SERVICE (Twilio)
# =============================================================================
TWILIO_ACCOUNT_SID=your_twilio_account_sid
TWILIO_AUTH_TOKEN=your_twilio_auth_token
TWILIO_PHONE_NUMBER=+966xxxxxxxxx
TWILIO_VERIFY_SERVICE_SID=your_verify_service_sid

# =============================================================================
# AI & EMBEDDINGS (OpenAI)
# =============================================================================
# Optional: Enables higher quality answers in Help Q&A and Copilot
OPENAI_API_KEY=your_openai_api_key

# =============================================================================
# MONITORING & LOGGING (Optional but Recommended for Production)
# =============================================================================
# Sentry (Error Tracking)
SENTRY_DSN=your_sentry_dsn
SENTRY_ORG=your_org
SENTRY_PROJECT=your_project

# Datadog (APM & Monitoring)
DATADOG_API_KEY=your_datadog_api_key
DATADOG_APP_KEY=your_datadog_app_key
DATADOG_SITE=datadoghq.com

# =============================================================================
# CACHING (Redis - Optional for Distributed Rate Limiting)
# =============================================================================
REDIS_URL=redis://username:password@host:port
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=your_redis_password

# =============================================================================
# MODULE CONTROL (Dynamic Import System)
# =============================================================================
# Set to 'false' or remove to disable specific modules
# Disabled modules return HTTP 501 with clear error messages
WO_ENABLED=true              # Work Orders module
INVOICE_ENABLED=true         # Invoicing module  
PROPERTY_ENABLED=true        # Property Management (Aqar) module
ASSET_ENABLED=true           # Asset Tracking module
VENDOR_ENABLED=true          # Vendor Management module
RFQ_ENABLED=true             # Request for Quote module
SUPPORT_ENABLED=true         # Support Tickets module
MARKETPLACE_ENABLED=true     # Marketplace module
ATS_ENABLED=true             # Applicant Tracking System module

# =============================================================================
# FEATURE FLAGS
# =============================================================================
ENABLE_PAYMENT_GATEWAY=true
ENABLE_SMS_OTP=false
ENABLE_EMAIL_NOTIFICATIONS=true
ENABLE_GOOGLE_MAPS=true
ENABLE_ZATCA_INTEGRATION=true
ENABLE_AQAR_MODULE=true
ENABLE_ATS_MODULE=true

# =============================================================================
# AQAR (PROPERTY) PRICING CONFIGURATION
# =============================================================================
# Platform commission on bookings (percentage, default: 15)
PLATFORM_FEE_PERCENTAGE=15

# Booking refund policy (days before check-in)
BOOKING_FULL_REFUND_DAYS=7        # Full refund if cancelled 7+ days before
BOOKING_PARTIAL_REFUND_DAYS=3     # Partial refund if cancelled 3-6 days before
BOOKING_PARTIAL_REFUND_PERCENT=50 # Percentage of partial refund (default: 50%)

# Boost pricing (SAR per day)
BOOST_FEATURED_PRICE_PER_DAY=100      # Featured listing (top of search)
BOOST_PINNED_PRICE_PER_DAY=50         # Pinned listing (stays at top)
BOOST_HIGHLIGHTED_PRICE_PER_DAY=25    # Highlighted listing (visual emphasis)

# =============================================================================
# RATE LIMITING
# =============================================================================
# Override default rate limits (requests per window)
KB_SEARCH_MAX_RATE_PER_MIN=60

# =============================================================================
# FILE STORAGE
# =============================================================================
STORAGE_TYPE=local           # Options: local, s3
MAX_FILE_SIZE=10485760       # 10MB in bytes

# =============================================================================
# SESSION & SECURITY
# =============================================================================
# Note: Session management is handled by NextAuth with NEXTAUTH_SECRET above
COOKIE_DOMAIN=.yourdomain.com
COOKIE_SECURE=false          # Set to true in production (requires HTTPS). False for local dev over http://localhost

# =============================================================================
# BUILD & PERFORMANCE
# =============================================================================
NODE_OPTIONS=--max-old-space-size=4096  # Required for production build

# =============================================================================
# DEVELOPMENT TOOLS
# =============================================================================
# Enable detailed logging in development
DEBUG=false
LOG_LEVEL=info               # Options: error, warn, info, verbose, debug

# =============================================================================
# NOTES
# =============================================================================
# 1. Copy this file to .env.local for development
# 2. Never commit .env.local to git (already in .gitignore)
# 3. For production, set these in your hosting platform environment variables
# 4. Generate strong secrets: openssl rand -hex 32
# 5. See PRODUCTION_DEPLOYMENT_GUIDE.md for detailed setup instructions
