"use strict";(()=>{var t={};t.id=470,t.ids=[470],t.modules={399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},866:(t,e,r)=>{r.r(e),r.d(e,{originalPathname:()=>E,patchFetch:()=>m,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>w,staticGenerationAsyncStorage:()=>l});var a={};r.r(a),r.d(a,{PATCH:()=>u});var n=r(9303),i=r(8716),o=r(670),s=r(7070),d=r(7478);async function u(t,{params:e}){let{tenantId:r,actorId:a,ip:n}={tenantId:t.headers.get("x-tenant-id")||"",actorId:t.headers.get("x-user-id")||void 0,ip:t.ip??""};if(!r)return s.NextResponse.json({error:"Missing tenant"},{status:400});let i=await t.json();try{let t=await d.Vx(e.id,i,r,a,n);return s.NextResponse.json({data:t})}catch(t){return s.NextResponse.json({error:t.message},{status:400})}}let p=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/work-orders/[id]/route",pathname:"/api/work-orders/[id]",filename:"route",bundlePath:"app/api/work-orders/[id]/route"},resolvedPagePath:"C:\\Users\\Geekay\\OneDrive\\Documents\\GitHub\\Fixzit-1\\app\\api\\work-orders\\[id]\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:c,staticGenerationAsyncStorage:l,serverHooks:w}=p,E="/api/work-orders/[id]/route";function m(){return(0,o.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:l})}},9851:(t,e,r)=>{r.d(e,{_:()=>n});let a=require("@prisma/client"),n=global.__prisma??new a.PrismaClient;global.__prisma||(global.__prisma=n)},2:(t,e,r)=>{r.d(e,{a:()=>n});let a=new Map;function n(t,e){if(a.has(t))return a.get(t);let r=(async()=>await e())();return a.set(t,r),r}},1165:(t,e,r)=>{r.d(e,{U:()=>n});var a=r(9851);async function n(t,e,r,n,i,o){await a._.auditLog.create({data:{tenantId:t,actorId:e,action:r,entity:n,payload:i,ip:o}})}},7478:(t,e,r)=>{r.d(e,{Ue:()=>_,pb:()=>f,Vx:()=>O});var a=r(8879);let n=a.KmV(["LOW","MEDIUM","HIGH","CRITICAL"]),i=a.KmV(["NEW","ASSIGNED","IN_PROGRESS","ON_HOLD","COMPLETED","CANCELLED"]),o=a.Ryn({tenantId:a.Z_8().cuid(),title:a.Z_8().min(3),description:a.Z_8().min(3),priority:n.default("MEDIUM"),propertyId:a.Z_8().cuid().optional(),requesterId:a.Z_8().cuid().optional(),slaHours:a.Rxh().int().min(1).max(720).default(72)}),s=a.Ryn({title:a.Z_8().min(3).optional(),description:a.Z_8().min(3).optional(),priority:n.optional(),status:i.optional(),assigneeId:a.Z_8().cuid().optional(),scheduledAt:a.oQ2.date().optional(),startedAt:a.oQ2.date().optional(),completedAt:a.oQ2.date().optional(),slaHours:a.Rxh().int().min(1).max(720).optional()});var d=r(9851);async function u(t){let e=await d._.workOrder.count({where:{tenantId:t.tenantId}}),r=`WO-${function(t,e=6){return String(t).padStart(e,"0")}(e+1)}`;return d._.workOrder.create({data:{...t,code:r}})}async function p(t,e){return d._.workOrder.update({where:{id:t},data:e})}async function c(t){return d._.workOrder.findUnique({where:{id:t}})}async function l(t,e,r){return d._.workOrder.findMany({where:{tenantId:t,AND:[e?{OR:[{title:{contains:e,mode:"insensitive"}},{description:{contains:e,mode:"insensitive"}}]}:{},r?{status:r}:{}]},orderBy:{createdAt:"desc"},take:200})}var w=r(1165),E=r(2);let m={NEW:["ASSIGNED","CANCELLED"],ASSIGNED:["IN_PROGRESS","ON_HOLD","CANCELLED"],IN_PROGRESS:["ON_HOLD","COMPLETED","CANCELLED"],ON_HOLD:["IN_PROGRESS","CANCELLED"],COMPLETED:[],CANCELLED:[]};async function _(t,e,r){let a=o.parse(t),n=await (0,E.a)(`wo:create:${a.tenantId}:${a.title}`,()=>u(a));return await (0,w.U)(a.tenantId,e,"wo.create",`workOrder:${n.code}`,{wo:n},r),n}async function O(t,e,r,a,n){let i=s.parse(e);if(i.status){let e=await c(t);if(!e||e.tenantId!==r)throw Error("Not found");if(!(m[e.status]||[]).includes(i.status))throw Error(`Invalid transition ${e.status} -> ${i.status}`)}let o=await p(t,i);return await (0,w.U)(r,a,"wo.update",`workOrder:${o.code}`,{patch:i},n),o}async function f(t,e,r){return l(t,e,r)}}};var e=require("../../../../webpack-runtime.js");e.C(t);var r=t=>e(e.s=t),a=e.X(0,[948,877],()=>r(866));module.exports=a})();