{
  "issues": [
    {
      "key": "FIX-ZATCA-001-type-validation",
      "title": "ZATCA submit route missing runtime type validation",
      "category": "security",
      "priority": "P1",
      "status": "resolved",
      "effort": "S",
      "location": "app/api/finance/zatca/submit/route.ts:17",
      "sourcePath": "agent-session-2026-01-04",
      "sourceRef": "[AGENT-0008] Session 2026-01-04",
      "evidenceSnippet": "type field cast to union but not validated at runtime",
      "description": "Added runtime check that confirms type is exactly 'clearance' or 'reporting', returns 400 for invalid type."
    },
    {
      "key": "FIX-UI-001-analytics-selectvalue",
      "title": "SelectValue placeholder missing in analytics page",
      "category": "ui",
      "priority": "P2",
      "status": "resolved",
      "effort": "S",
      "location": "app/superadmin/analytics/page.tsx:123",
      "sourcePath": "agent-session-2026-01-04",
      "sourceRef": "[AGENT-0008] Session 2026-01-04",
      "evidenceSnippet": "placeholder prop on Select instead of SelectValue",
      "description": "Moved placeholder from Select to SelectValue, className to SelectTrigger."
    },
    {
      "key": "FIX-UI-002-import-export-selectvalue",
      "title": "SelectValue placeholder missing in import-export page",
      "category": "ui",
      "priority": "P2",
      "status": "resolved",
      "effort": "S",
      "location": "app/superadmin/import-export/page.tsx:188",
      "sourcePath": "agent-session-2026-01-04",
      "sourceRef": "[AGENT-0008] Session 2026-01-04",
      "evidenceSnippet": "placeholder prop on Select instead of SelectValue",
      "description": "Moved placeholder from Select to SelectValue, className to SelectTrigger."
    },
    {
      "key": "FIX-UI-003-cardlist-selectvalue",
      "title": "CardList SelectTrigger missing SelectValue",
      "category": "ui",
      "priority": "P2",
      "status": "resolved",
      "effort": "S",
      "location": "components/tables/CardList.tsx:192",
      "sourcePath": "agent-session-2026-01-04",
      "sourceRef": "[AGENT-0008] Session 2026-01-04",
      "evidenceSnippet": "SelectTrigger empty, SelectValue missing",
      "description": "Added SelectValue import and component with placeholder inside SelectTrigger."
    },
    {
      "key": "FIX-DOC-001-duplicate-scan-entry",
      "title": "Duplicate scan entry in incomplete-code-scan JSON",
      "category": "documentation",
      "priority": "P3",
      "status": "resolved",
      "effort": "S",
      "location": "docs/artifacts/incomplete-code-scan-post-patch-2026-01-04-104511.json:120",
      "sourcePath": "agent-session-2026-01-04",
      "sourceRef": "[AGENT-0008] Session 2026-01-04",
      "evidenceSnippet": "duplicate key 501-not-implemented-feature-app-api-support-welcome-email-route-ts-315",
      "description": "Removed duplicate entry with incorrect location (line 78), kept correct one (line 315)."
    },
    {
      "key": "FIX-OCR-001-polling-timeout",
      "title": "OCR polling timeout too short (10s)",
      "category": "bug",
      "priority": "P1",
      "status": "resolved",
      "effort": "M",
      "location": "jobs/onboarding-ocr-worker.ts:91",
      "sourcePath": "agent-session-2026-01-04",
      "sourceRef": "[AGENT-0008] Session 2026-01-04",
      "evidenceSnippet": "10 attempts x 1s = 10s total wait, too short for Azure Read OCR",
      "description": "Implemented exponential backoff (1s->10s cap), 12 attempts, ~60s total wait time, detailed error messages."
    },
    {
      "key": "FIX-GRAPHQL-001-softdelete-guard",
      "title": "GraphQL scopedQuery missing soft-delete guard",
      "category": "security",
      "priority": "P1",
      "status": "resolved",
      "effort": "S",
      "location": "lib/graphql/index.ts:1177",
      "sourcePath": "agent-session-2026-01-04",
      "sourceRef": "[AGENT-0008] Session 2026-01-04",
      "evidenceSnippet": "scopedQuery allows updates to soft-deleted work orders",
      "description": "Added deletedAt: null guard to both update and delete scopedQuery instances."
    },
    {
      "key": "FIX-ZATCA-002-json-parse-safety",
      "title": "fatoora-client response.json() unsafe",
      "category": "security",
      "priority": "P1",
      "status": "resolved",
      "effort": "M",
      "location": "lib/zatca/fatoora-client.ts:20",
      "sourcePath": "agent-session-2026-01-04",
      "sourceRef": "[AGENT-0008] Session 2026-01-04",
      "evidenceSnippet": "response.json() called directly, throws on non-JSON",
      "description": "Added safeParseJson() with content-type check and text fallback."
    },
    {
      "key": "FIX-ZATCA-003-uuid-validation",
      "title": "extractUuidFromXml returns empty string silently",
      "category": "security",
      "priority": "P1",
      "status": "resolved",
      "effort": "S",
      "location": "lib/zatca/fatoora-client.ts:13",
      "sourcePath": "agent-session-2026-01-04",
      "sourceRef": "[AGENT-0008] Session 2026-01-04",
      "evidenceSnippet": "returns empty string when UUID element missing",
      "description": "Added UUID validation with pattern check, throws descriptive error."
    },
    {
      "key": "FIX-ZATCA-004-fetch-timeout",
      "title": "ZATCA fetch calls ignore timeout config",
      "category": "bug",
      "priority": "P1",
      "status": "resolved",
      "effort": "M",
      "location": "lib/zatca/fatoora-client.ts:15",
      "sourcePath": "agent-session-2026-01-04",
      "sourceRef": "[AGENT-0008] Session 2026-01-04",
      "evidenceSnippet": "fetch ignores endpoints.timeouts.clearanceMs",
      "description": "Added fetchWithTimeout() using AbortController for all ZATCA API calls."
    },
    {
      "key": "FIX-ZATCA-005-compliance-url",
      "title": "submitComplianceInvoice manually appends /invoices",
      "category": "refactor",
      "priority": "P2",
      "status": "resolved",
      "effort": "S",
      "location": "lib/zatca/fatoora-client.ts:57",
      "sourcePath": "agent-session-2026-01-04",
      "sourceRef": "[AGENT-0008] Session 2026-01-04",
      "evidenceSnippet": "appends /invoices to complianceApiUrl instead of using complianceInvoicesApiUrl",
      "description": "Changed to use endpoints.complianceInvoicesApiUrl directly."
    },
    {
      "key": "FIX-ZATCA-006-types-formatting",
      "title": "fatoora-types.ts interfaces on single lines",
      "category": "refactor",
      "priority": "P3",
      "status": "resolved",
      "effort": "M",
      "location": "lib/zatca/fatoora-types.ts:11",
      "sourcePath": "agent-session-2026-01-04",
      "sourceRef": "[AGENT-0008] Session 2026-01-04",
      "evidenceSnippet": "all interfaces written as single long lines",
      "description": "Refactored all interfaces to multi-line format for readability."
    },
    {
      "key": "FIX-ZATCA-007-xml-injection",
      "title": "XML injection risk in xml-builder",
      "category": "security",
      "priority": "P0",
      "status": "resolved",
      "effort": "M",
      "location": "lib/zatca/xml-builder.ts:25",
      "sourcePath": "agent-session-2026-01-04",
      "sourceRef": "[AGENT-0008] Session 2026-01-04",
      "evidenceSnippet": "unescaped user values (item.name, sellerName, sellerVat) interpolated into XML",
      "description": "Added escapeXml() function, applied to all user-controlled strings."
    },
    {
      "key": "FIX-SIMAH-001-score-clamp",
      "title": "SIMAH normalization can produce <0 or >100",
      "category": "bug",
      "priority": "P1",
      "status": "resolved",
      "effort": "S",
      "location": "services/aqar/tenant-screening.ts:830",
      "sourcePath": "agent-session-2026-01-04",
      "sourceRef": "[AGENT-0008] Session 2026-01-04",
      "evidenceSnippet": "normalization math can produce out-of-range values",
      "description": "Added Math.max(0, Math.min(100, ...)) clamping and NaN validation."
    },
    {
      "key": "FIX-SIMAH-002-fetch-timeout",
      "title": "SIMAH fetch has no timeout",
      "category": "bug",
      "priority": "P1",
      "status": "resolved",
      "effort": "S",
      "location": "services/aqar/tenant-screening.ts:795",
      "sourcePath": "agent-session-2026-01-04",
      "sourceRef": "[AGENT-0008] Session 2026-01-04",
      "evidenceSnippet": "fetch to SIMAH API can hang indefinitely",
      "description": "Added AbortController with 10s timeout, specific error handling for AbortError."
    },
    {
      "key": "FIX-PAYOUT-001-pending-status",
      "title": "TAP PENDING transfers treated as success",
      "category": "bug",
      "priority": "P0",
      "status": "resolved",
      "effort": "S",
      "location": "services/souq/settlements/payout-processor.ts:728",
      "sourcePath": "agent-session-2026-01-04",
      "sourceRef": "[AGENT-0008] Session 2026-01-04",
      "evidenceSnippet": "PENDING status returns success: true, prematurely releasing escrow",
      "description": "Changed to return success: false with TRANSFER_PENDING errorCode, await webhook confirmation."
    },
    {
      "key": "FIX-TEST-001-preset-props-leak",
      "title": "PropertiesList test capturedPresetProps state leak",
      "category": "test",
      "priority": "P2",
      "status": "resolved",
      "effort": "S",
      "location": "tests/unit/components/aqar/PropertiesList.query.test.tsx:94",
      "sourcePath": "agent-session-2026-01-04",
      "sourceRef": "[AGENT-0008] Session 2026-01-04",
      "evidenceSnippet": "capturedPresetProps not reset between tests",
      "description": "Added capturedPresetProps = undefined reset before test."
    },
    {
      "key": "FIX-TEST-002-preset-props-leak",
      "title": "ProductsList test capturedPresetProps state leak",
      "category": "test",
      "priority": "P2",
      "status": "resolved",
      "effort": "S",
      "location": "tests/unit/components/marketplace/ProductsList.query.test.tsx:90",
      "sourcePath": "agent-session-2026-01-04",
      "sourceRef": "[AGENT-0008] Session 2026-01-04",
      "evidenceSnippet": "capturedPresetProps not reset between tests",
      "description": "Added capturedPresetProps = undefined reset before test."
    }
  ]
}
