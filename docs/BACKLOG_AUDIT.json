{
  "extracted_at": "2025-12-16T15:15:00+03:00",
  "source_file": "docs/PENDING_MASTER.md",
  "counts": {
    "total": 22,
    "pending": 22,
    "resolved": 0,
    "by_priority": { "P0": 1, "P1": 3, "P2": 12, "P3": 6 },
    "by_category": {
      "ops": 1,
      "security": 1,
      "bug": 2,
      "efficiency": 2,
      "tests": 6,
      "documentation": 10
    }
  },
  "issues": [
    {
      "key": "OPS-OTP-BYPASS",
      "externalId": "OPS-OTP-BYPASS",
      "category": "ops",
      "priority": "P0",
      "status": "open",
      "title": "Production blocked by OTP bypass env var",
      "location": "lib/config/env-guards.ts",
      "sourceRef": "code-review:lib/config/env-guards.ts:81-108",
      "evidenceSnippet": "message: `${varName} must not be set in ${env} environment`",
      "riskTags": ["AUTH", "PRODUCTION"],
      "effort": "XS"
    },
    {
      "key": "SEC-002",
      "externalId": "SEC-002",
      "category": "security",
      "priority": "P1",
      "status": "in_progress",
      "title": "Tenant scope missing across DB queries",
      "location": "app/api/**/route.ts",
      "sourceRef": "docs/PENDING_MASTER.md:399-404",
      "evidenceSnippet": "50+ DB queries missing tenant scope validation | app/api/**/route.ts | Potential cross-tenant data leaks (IDOR)",
      "riskTags": ["MULTI_TENANT", "SECURITY"],
      "effort": "L",
      "resolution": {
        "status": "in_progress",
        "progressAt": "2025-12-17T04:30:00+03:00",
        "progressBy": "eng.sultan",
        "commitHash": "76636053a",
        "notes": "Batch 1 complete - fixed 8 confirmed IDOR vulnerabilities: payments/tap/webhook (Payment.findById), checkout/complete (Subscription.findById), ats/applications GET/PATCH (Application.findById), ats/jobs/publish (Job.findById), aqar/listings GET/PATCH/DELETE (AqarListing.findById), onboarding/documents/review (VerificationDocument.findById). All now use findOne with orgId filter and super admin bypass. Pattern: Replace findById with findOne+orgId at query level. Validation: TypeCheck 0 errors, ESLint clean. Remaining: ~44 queries from audit scan (requires manual review for false positives)."
      }
    },
    {
      "key": "BUG-001",
      "externalId": "BUG-001",
      "category": "bug",
      "priority": "P1",
      "status": "resolved",
      "title": "process.env accessed directly in client code",
      "location": "app/**/*.tsx",
      "sourceRef": "docs/PENDING_MASTER.md:403-404",
      "evidenceSnippet": "40+ direct process.env accesses in client code | SSR/hydration breaks, secret exposure risk",
      "riskTags": ["CONFIG", "HYDRATION"],
      "effort": "M",
      "resolution": {
        "status": "resolved",
        "resolvedAt": "2025-12-17T03:15:00+03:00",
        "resolvedBy": "eng.sultan",
        "commitHash": "af8d10937",
        "notes": "FALSE POSITIVE. Created scripts/audit-client-env.mjs to detect unsafe process.env usage in client code. Audit found 0 unsafe accesses - all client components properly use NEXT_PUBLIC_ prefix or NODE_ENV. Issue based on incorrect premise. Validated with grep/ripgrep + manual review. No code changes required."
      }
    },
    {
      "key": "PERF-001",
      "externalId": "PERF-001",
      "category": "efficiency",
      "priority": "P2",
      "status": "open",
      "title": "N+1 BuyBoxService calls in auto-repricer",
      "location": "services/souq/pricing/auto-repricer.ts",
      "sourceRef": "docs/PENDING_MASTER.md:4938-4942",
      "evidenceSnippet": "PERF-001 | N+1 in auto-repricer (BuyBoxService in loop) | High latency/DB churn | Pending",
      "riskTags": ["PERFORMANCE"],
      "effort": "M"
    },
    {
      "key": "PERF-002",
      "externalId": "PERF-002",
      "category": "efficiency",
      "priority": "P3",
      "status": "open",
      "title": "Sequential updates in fulfillment/claims",
      "location": "services/souq/fulfillment-service.ts; services/souq/returns/claim-service.ts",
      "sourceRef": "docs/PENDING_MASTER.md:17118-17120",
      "evidenceSnippet": "PERF-002 | Sequential updates in fulfillment/claims | services/souq/fulfillment-service.ts, services/souq/returns/claim-service.ts | Latency, DB load",
      "riskTags": ["PERFORMANCE"],
      "effort": "M"
    },
    {
      "key": "TEST-001",
      "externalId": "TEST-001",
      "category": "tests",
      "priority": "P3",
      "status": "open",
      "title": "Increase Souq test coverage (checkout, fulfillment, repricer)",
      "location": "tests/api/souq/*",
      "sourceRef": "docs/PENDING_MASTER.md:512-513",
      "evidenceSnippet": "TEST-001 — Increase Souq test coverage (checkout, fulfillment, repricer) [P3, XL effort]",
      "riskTags": ["TEST-GAP"],
      "effort": "XL"
    },
    {
      "key": "TEST-002",
      "externalId": "TEST-002",
      "category": "tests",
      "priority": "P2",
      "status": "open",
      "title": "Create HR module tests (employees CRUD, payroll)",
      "location": "tests/api/hr/*",
      "sourceRef": "docs/PENDING_MASTER.md:509-510",
      "evidenceSnippet": "TEST-002 — Create HR module tests (employees CRUD, payroll) [P2, M effort]",
      "riskTags": ["TEST-GAP"],
      "effort": "M"
    },
    {
      "key": "TEST-003",
      "externalId": "TEST-003",
      "category": "tests",
      "priority": "P2",
      "status": "open",
      "title": "Create Finance module tests (invoices, payments, billing)",
      "location": "tests/api/finance/*",
      "sourceRef": "docs/PENDING_MASTER.md:509-510",
      "evidenceSnippet": "TEST-003 — Create Finance module tests (invoices, payments, billing) [P2, L effort]",
      "riskTags": ["TEST-GAP", "FINANCIAL"],
      "effort": "L"
    },
    {
      "key": "TEST-004",
      "externalId": "TEST-004",
      "category": "tests",
      "priority": "P2",
      "status": "open",
      "title": "Increase CRM module test coverage",
      "location": "tests/api/crm/*",
      "sourceRef": "docs/PENDING_MASTER.md:612-612",
      "evidenceSnippet": "P3 Pending | 3 | TEST-001 (Souq), TEST-004 (CRM routes), BUG-011",
      "riskTags": ["TEST-GAP"],
      "effort": "M"
    },
    {
      "key": "TEST-005",
      "externalId": "TEST-005",
      "category": "tests",
      "priority": "P3",
      "status": "in_progress",
      "title": "Increase Aqar module test coverage",
      "location": "tests/api/aqar/*",
      "sourceRef": "docs/PENDING_MASTER.md:591-603",
      "evidenceSnippet": "TEST-005 — Aqar test coverage (5 new files pending commit)",
      "riskTags": ["TEST-GAP"],
      "effort": "S"
    },
    {
      "key": "REF-001",
      "externalId": "REF-001",
      "category": "tests",
      "priority": "P2",
      "status": "open",
      "title": "Create CRM route handler tests",
      "location": "tests/unit/api/crm/*",
      "sourceRef": "docs/PENDING_MASTER.md:509-511",
      "evidenceSnippet": "REF-001 — Create CRM route handler tests [P2, M effort]",
      "riskTags": ["TEST-GAP"],
      "effort": "M"
    },
    {
      "key": "BUG-011",
      "externalId": "BUG-011",
      "category": "bug",
      "priority": "P3",
      "status": "open",
      "title": "Add .catch() to notification chains",
      "location": "lib/notifications/*",
      "sourceRef": "docs/PENDING_MASTER.md:607-612",
      "evidenceSnippet": "P3 Pending | 3 | TEST-001 (Souq), TEST-004 (CRM routes), BUG-011",
      "riskTags": [],
      "effort": "S"
    },
    {
      "key": "DOC-101",
      "externalId": "DOC-101",
      "category": "documentation",
      "priority": "P2",
      "status": "open",
      "title": "Missing JSDoc for 7 API route handlers",
      "location": "app/api/superadmin/issues/route.ts; app/api/admin/*",
      "sourceRef": "docs/PENDING_MASTER.md:275-279",
      "evidenceSnippet": "DOC-101 — Missing JSDoc for 7 API route handlers (superadmin, admin, user, checkout) — P2, Effort: S",
      "riskTags": ["CODE-QUALITY"],
      "effort": "S"
    },
    {
      "key": "DOC-102",
      "externalId": "DOC-102",
      "category": "documentation",
      "priority": "P1",
      "status": "open",
      "title": "Missing JSDoc for 51 lib utility modules",
      "location": "lib/**",
      "sourceRef": "docs/PENDING_MASTER.md:279-284",
      "evidenceSnippet": "DOC-102 — Missing JSDoc for 51 lib utility modules (auth, payments, storage, middleware) — P1, Effort: M",
      "riskTags": ["SECURITY", "CODE-QUALITY"],
      "effort": "M"
    },
    {
      "key": "DOC-103",
      "externalId": "DOC-103",
      "category": "documentation",
      "priority": "P2",
      "status": "open",
      "title": "Missing JSDoc for 124 Mongoose model schemas",
      "location": "server/models/**",
      "sourceRef": "docs/PENDING_MASTER.md:284-289",
      "evidenceSnippet": "DOC-103 — Missing JSDoc for 124 Mongoose model schemas (server/models) — P2, Effort: L",
      "riskTags": ["DATA", "CODE-QUALITY"],
      "effort": "L"
    },
    {
      "key": "DOC-104",
      "externalId": "DOC-104",
      "category": "documentation",
      "priority": "P2",
      "status": "open",
      "title": "Missing function-level JSDoc for superadmin issues CRUD",
      "location": "app/api/superadmin/issues/route.ts",
      "sourceRef": "docs/PENDING_MASTER.md:289-293",
      "evidenceSnippet": "DOC-104 — Missing function-level JSDoc for superadmin issues CRUD endpoints — P2, Effort: XS",
      "riskTags": ["CODE-QUALITY"],
      "effort": "XS"
    },
    {
      "key": "DOC-105",
      "externalId": "DOC-105",
      "category": "documentation",
      "priority": "P2",
      "status": "open",
      "title": "Missing inline comments for ZATCA TLV encoding",
      "location": "lib/zatca.ts",
      "sourceRef": "docs/PENDING_MASTER.md:292-296",
      "evidenceSnippet": "DOC-105 — Missing inline comments for ZATCA TLV encoding logic — P2, Effort: S",
      "riskTags": ["FINANCIAL"],
      "effort": "S"
    },
    {
      "key": "DOC-106",
      "externalId": "DOC-106",
      "category": "documentation",
      "priority": "P2",
      "status": "open",
      "title": "Missing README for backlog tracker feature",
      "location": "docs/",
      "sourceRef": "docs/PENDING_MASTER.md:296-299",
      "evidenceSnippet": "DOC-106 — Missing README for backlog tracker feature — P2, Effort: S",
      "riskTags": ["DOCS"],
      "effort": "S"
    },
    {
      "key": "DOC-107",
      "externalId": "DOC-107",
      "category": "documentation",
      "priority": "P3",
      "status": "open",
      "title": "Missing TypeScript interface documentation for BacklogIssue types",
      "location": "server/models/BacklogIssue.ts",
      "sourceRef": "docs/PENDING_MASTER.md:299-302",
      "evidenceSnippet": "DOC-107 — Missing TypeScript interface documentation for BacklogIssue types — P3, Effort: XS",
      "riskTags": ["CODE-QUALITY"],
      "effort": "XS"
    },
    {
      "key": "DOC-108",
      "externalId": "DOC-108",
      "category": "documentation",
      "priority": "P2",
      "status": "open",
      "title": "Missing API endpoint documentation in OpenAPI spec",
      "location": "openapi.yaml",
      "sourceRef": "docs/PENDING_MASTER.md:302-306",
      "evidenceSnippet": "DOC-108 — Missing API endpoint documentation in OpenAPI spec — P2, Effort: M",
      "riskTags": ["API"],
      "effort": "M"
    },
    {
      "key": "DOC-109",
      "externalId": "DOC-109",
      "category": "documentation",
      "priority": "P2",
      "status": "open",
      "title": "Missing error response documentation for API routes",
      "location": "docs/",
      "sourceRef": "docs/PENDING_MASTER.md:306-310",
      "evidenceSnippet": "DOC-109 — Missing error response documentation for API routes — P2, Effort: M",
      "riskTags": ["API"],
      "effort": "M"
    },
    {
      "key": "DOC-110",
      "externalId": "DOC-110",
      "category": "documentation",
      "priority": "P3",
      "status": "open",
      "title": "Missing deployment checklist for backlog tracker",
      "location": "docs/BACKLOG_TRACKER_SUMMARY.md",
      "sourceRef": "docs/PENDING_MASTER.md:299-302",
      "evidenceSnippet": "DOC-110 — Missing deployment checklist for backlog tracker — P3, Effort: XS",
      "riskTags": ["DEPLOYMENT"],
      "effort": "XS"
    }
  ]
}
