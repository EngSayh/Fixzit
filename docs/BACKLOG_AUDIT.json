{
  "extracted_at": "2025-12-14T00:02:00+03:00",
  "source_file": "PENDING_MASTER.md",
  "applied_flags": {
    "format": "both",
    "priority": "all",
    "category": "all"
  },
  "counts": {
    "total": 14,
    "resolved": 5,
    "pending": 9,
    "by_priority": { "P0": 1, "P1": 0, "P2": 4, "P3": 4 },
    "by_category": { "Bugs": 1, "Logic Errors": 0, "Missing Tests": 5, "Efficiency": 0, "Security": 0, "Config": 1 },
    "quick_wins": 0,
    "anomalies": 1
  },
  "anomalies": [
    {
      "type": "Repeated theme",
      "pattern": "test coverage gaps",
      "affected_keys": ["TEST-001", "TEST-002", "TEST-003", "TEST-004", "TEST-005", "TEST-SAFE-FETCH", "create-crm-route-tests"]
    }
  ],
  "file_heat_map": [
    { "rank": 1, "file": "lib/finance/tap-payments.ts", "issues": 1, "category": "Security" },
    { "rank": 2, "file": ".vscode/tasks.json", "issues": 1, "category": "Config" },
    { "rank": 3, "file": "lib/utils/safe-fetch.ts", "issues": 1, "category": "Missing Tests" },
    { "rank": 4, "file": "tests/api/souq/*", "issues": 1, "category": "Missing Tests" },
    { "rank": 5, "file": "tests/api/hr/*", "issues": 1, "category": "Missing Tests" }
  ],
  "issues": [
    {
      "key": "config-002-missing-nextauth-secret",
      "externalId": "CONFIG-002",
      "displayRef": "CONFIG-002",
      "category": "Config",
      "priority": "P0",
      "status": "pending",
      "title": "NEXTAUTH_SECRET missing in Vercel production deployment",
      "issue": "Production site (fixzit.co) throws ConfigurationError on all pages: Required environment variable NEXTAUTH_SECRET is not set",
      "action": "Add NEXTAUTH_SECRET to Vercel project environment variables (production/preview/development)",
      "riskTags": ["PRODUCTION-DOWN", "AUTH", "CRITICAL"],
      "effort": "XS",
      "impact": 10,
      "impactBasis": "P0 base (10) - complete production outage",
      "location": "Vercel environment variables",
      "sourceRef": "code-review:browser-console:2025-12-14",
      "evidenceSnippet": "ConfigurationError: Required environment variable NEXTAUTH_SECRET is not set",
      "sourceHash12": "config002auth",
      "firstSeen": "2025-12-14",
      "lastSeen": "2025-12-14",
      "mentions": 1,
      "sprintBucket": "URGENT"
    },
    {
      "key": "sec-tap-001-timing-attack",
      "externalId": "SEC-TAP-001",
      "displayRef": "SEC-TAP-001",
      "category": "Security",
      "priority": "P0",
      "status": "resolved",
      "title": "Tap Payments webhook uses === instead of timingSafeEqual",
      "issue": "lib/finance/tap-payments.ts:474 uses string equality for signature comparison, vulnerable to timing attacks",
      "action": "Replace `calculatedSignature === signature` with `crypto.timingSafeEqual(Buffer.from(calculatedSignature), Buffer.from(signature))`",
      "resolution": "FIXED in main (commit 2f5c6ed2d): Now uses crypto.timingSafeEqual(calcBuffer, sigBuffer) at line 492",
      "riskTags": ["SECURITY", "TIMING-ATTACK"],
      "effort": "XS",
      "impact": 10,
      "impactBasis": "P0 base (10) + SECURITY (critical)",
      "location": "lib/finance/tap-payments.ts:492",
      "sourceRef": "PR #550 CodeRabbit review",
      "evidenceSnippet": "const isValid = crypto.timingSafeEqual(calcBuffer, sigBuffer);",
      "sourceHash12": "sec001timing",
      "firstSeen": "2025-12-15",
      "lastSeen": "2025-12-15",
      "mentions": 1,
      "sprintBucket": "Resolved"
    },
    {
      "key": "config-001-dangerous-tasks",
      "externalId": "CONFIG-001",
      "displayRef": "CONFIG-001",
      "category": "Config",
      "priority": "P1",
      "status": "resolved",
      "title": "Remove dangerous repo-mutating tasks from .vscode/tasks.json",
      "issue": ".vscode/tasks.json contains 5+ tasks with --no-verify, --force-with-lease, and hardcoded branch names",
      "action": "Remove or move dangerous tasks to personal settings; remove hardcoded branch names",
      "resolution": "FIXED in main (commit 2f5c6ed2d): Removed 'Commit No Verify', 'Push Changes', 'Commit and Push' tasks",
      "riskTags": ["CONFIG", "GIT-SAFETY"],
      "effort": "XS",
      "impact": 8,
      "impactBasis": "P1 base (8) + potential repo corruption",
      "location": ".vscode/tasks.json",
      "sourceRef": "PR #550 CodeRabbit review",
      "evidenceSnippet": "Removed tasks with --no-verify and hardcoded branches",
      "sourceHash12": "config001tasks",
      "firstSeen": "2025-12-15",
      "lastSeen": "2025-12-15",
      "mentions": 1,
      "sprintBucket": "Resolved"
    },
    {
      "key": "test-safe-fetch-coverage",
      "externalId": "TEST-SAFE-FETCH",
      "displayRef": "TEST-SAFE-FETCH",
      "category": "Missing Tests",
      "priority":resolved",
      "title": "Add tests for safe-fetch.ts utilities",
      "issue": "lib/utils/safe-fetch.ts fetchWithCancel utility has no test coverage",
      "action": "Create tests/unit/lib/utils/safe-fetch.test.ts with timeout, abort, and error handling tests",
      "resolution": "FIXED: tests/unit/utils/safe-fetch.test.ts now exists and provides coverage",
      "riskTags": ["TEST-GAP"],
      "effort": "S",
      "impact": 6,
      "impactBasis": "P2 base (5) + TEST-GAP (+1)",
      "location": "tests/unit/utils/safe-fetch.test.ts",
      "sourceRef": "PR #550 CodeRabbit review",
      "evidenceSnippet": "tests/unit/utils/safe-fetch.test.ts exists",
      "sourceHash12": "testsafefetch",
      "firstSeen": "2025-12-15",
      "lastSeen": "2025-12-15",
      "mentions": 1,
      "sprintBucket": "Resolved
      "sprintBucket": "Next Sprint"
    },
    {
      "key": "eff-004-pm-rate-limiting",
      "externalId": "EFF-004",
      "displayRef": "EFF-004",
      "category": "Efficiency",
      "priority":resolved",
      "title": "Add rate limiting to PM routes (plans/[id])",
      "issue": "PM routes at 60% rate limit coverage; plans/[id] missing enforceRateLimit",
      "action": "Add enforceRateLimit to PM routes",
      "resolution": "FIXED: Added enforceRateLimit to PATCH (30 req/min) and DELETE (10 req/min) in app/api/pm/plans/[id]/route.ts",
      "riskTags": ["SECURITY"],
      "effort": "S",
      "impact": 7,
      "impactBasis": "P2 base (5) + SECURITY (+2)",
      "location": "app/api/pm/plans/[id]/route.ts:87,177",
      "sourceRef": "v65.23 Remaining Priority Items",
      "evidenceSnippet": "enforceRateLimit(request, { requests: 30, windowMs: 60_000, keyPrefix: pm:plans:patch })",
      "sourceHash12": "a1b2c3d4e5f6",
      "firstSeen": "2025-12-13",
      "lastSeen": "2025-12-15",
      "mentions": 3,
      "sprintBucket": "Resolved
      "sprintBucket": "Next Sprint"
    },
    {
      "key": "test-002-hr-coverage",
      "externalId": "TEST-002",
      "displayRef": "TEST-002",
      "category": "Missing Tests",
      "priority": "P2",
      "status": "pending",
      "title": "Increase HR module test coverage (14% → 50%)",
      "issue": "HR module has 7 routes, 1 test file; employees CRUD, payroll need coverage",
      "action": "Create HR module tests for employees CRUD, payroll",
      "riskTags": ["TEST-GAP"],
      "effort": "M",
      "impact": 6,
      "impactBasis": "P2 base (5) + TEST-GAP (+1)",
      "location": "tests/api/hr/*",
      "sourceRef": "v65.22 Missing Tests table",
      "evidenceSnippet": "hr | 7 | 1 | 6 | P2 — employees CRUD, payroll",
      "sourceHash12": "b2c3d4e5f6a7",
      "firstSeen": "2025-12-13",
      "lastSeen": "2025-12-14",
      "mentions": 4,
      "sprintBucket": "Next Sprint"
    },
    {
      "key": "test-003-finance-coverage",
      "externalId": "TEST-003",
      "displayRef": "TEST-003",
      "category": "Missing Tests",
      "priority": "P2",
      "status": "pending",
      "title": "Increase Finance module test coverage",
      "issue": "Finance module has 19 routes, 4 tests; invoices, payments, billing need coverage",
      "action": "Create tests for invoices, payments, billing routes",
      "riskTags": ["TEST-GAP", "FINANCIAL"],
      "effort": "L",
      "impact": 7,
      "impactBasis": "P2 base (5) + TEST-GAP (+1) + FINANCIAL (+1)",
      "location": "tests/api/finance/*",
      "sourceRef": "v65.22 Missing Tests table",
      "evidenceSnippet": "finance | 19 | 4 | 15 | P2 — invoices, payments, billing",
      "sourceHash12": "e5f6a7b8c9d0",
      "firstSeen": "2025-12-13",
      "lastSeen": "2025-12-14",
      "mentions": 1,
      "sprintBucket": "Next Sprint"
    },
    {
      "key": "create-crm-route-tests",
      "externalId": null,
      "displayRef": "REF-001",
      "category": "Missing Tests",
      "priority": "P2",
      "status": "pending",
      "title": "Create CRM route handler tests",
      "issue": "tests/unit/api/crm/crm.test.ts only asserts role sets; CRM route handlers still untested",
      "action": "Add actual handler tests (current tests only assert role sets)",
      "riskTags": ["TEST-GAP"],
      "effort": "M",
      "impact": 6,
      "impactBasis": "P2 base (5) + TEST-GAP (+1)",
      "location": "tests/unit/api/crm/*",
      "sourceRef": "v65.25 Next Steps",
      "evidenceSnippet": "create-crm-route-tests — Add actual handler tests (current tests only assert role sets)",
      "sourceHash12": "b8c9d0e1f2a3",
      "firstSeen": "2025-12-13",
      "lastSeen": "2025-12-14",
      "mentions": 3,
      "sprintBucket": "Next Sprint"
    },
    {
      "key": "eff-fork-safe-mongo-guard",
      "externalId": null,
      "displayRef": "REF-002",
      "category":resolved",
      "title": "Add fork-safe Mongo guard to build-sourcemaps.yml",
      "issue": "build-sourcemaps.yml:53-56 attempts Mongo index creation with localhost fallback; can fail on forks",
      "action": "Add if: env.MONGODB_URI != '' and remove localhost fallback",
      "resolution": "FIXED: Added if: ${{ secrets.MONGODB_URI != '' }} guard and removed localhost fallback",
      "riskTags": ["INTEGRATION"],
      "effort": "XS",
      "impact": 5,
      "impactBasis": "P2 base (5)",
      "location": ".github/workflows/build-sourcemaps.yml:54-56",
      "sourceRef": "v65.21 CI Lint Hardening",
      "evidenceSnippet": "if: ${{ secrets.MONGODB_URI != '' }}, removed localhost:27017 fallback",
      "sourceHash12": "c9d0e1f2a3b4",
      "firstSeen": "2025-12-13",
      "lastSeen": "2025-12-15",
      "mentions": 1,
      "sprintBucket": "Resolved
      "mentions": 1,
      "sprintBucket": "Next Sprint"
    },
    {
      "key": "test-001-souq-coverage",
      "externalId": "TEST-001",
      "displayRef": "TEST-001",
      "category": "Missing Tests",
      "priority": "P3",
      "status": "pending",
      "title": "Increase Souq test coverage (35% → 50%)",
      "issue": "Souq has 75 routes, 26 tests; checkout, fulfillment, repricer need coverage",
      "action": "Create tests for checkout, fulfillment, repricer routes",
      "riskTags": ["TEST-GAP"],
      "effort": "XL",
      "impact": 4,
      "impactBasis": "P3 base (3) + TEST-GAP (+1)",
      "location": "tests/api/souq/*",
      "sourceRef": "v65.22 Missing Tests table",
      "evidenceSnippet": "souq | 75 | 26 | 49 | P2 — checkout, fulfillment, repricer",
      "sourceHash12": "c3d4e5f6a7b8",
      "firstSeen": "2025-12-13",
      "lastSeen": "2025-12-14",
      "mentions": 5,
      "sprintBucket": "Backlog"
    },
    {
      "key": "test-004-crm-coverage",
      "externalId": "TEST-004",
      "displayRef": "TEST-004",
      "category": "Missing Tests",
      "priority": "P3",
      "status": "pending",
      "title": "Increase CRM module test coverage",
      "issue": "CRM module has 4 routes, 1 test; leads, contacts, activities need coverage",
      "action": "Create tests for leads, contacts, activities routes",
      "riskTags": ["TEST-GAP"],
      "effort": "M",
      "impact": 4,
      "impactBasis": "P3 base (3) + TEST-GAP (+1)",
      "location": "tests/api/crm/*",
      "sourceRef": "v65.22 Missing Tests table",
      "evidenceSnippet": "crm | 4 | 1 | 3 | P3 — leads, contacts, activities",
      "sourceHash12": "f6a7b8c9d0e1",
      "firstSeen": "2025-12-13",
      "lastSeen": "2025-12-14",
      "mentions": 2,
      "sprintBucket": "Backlog"
    },
    {
      "key": "test-005-aqar-coverage",
      "externalId": "TEST-005",
      "displayRef": "TEST-005",
      "category": "Missing Tests",
      "priority": "P3",
      "status": "pending",
      "title": "Increase Aqar module test coverage",
      "issue": "Aqar module has 16 routes, 12 tests; property listings need coverage",
      "action": "Create tests for remaining property listing routes",
      "riskTags": ["TEST-GAP"],
      "effort": "S",
      "impact": 4,
      "impactBasis": "P3 base (3) + TEST-GAP (+1)",
      "location": "tests/api/aqar/*",
      "sourceRef": "v65.22 Missing Tests table",
      "evidenceSnippet": "aqar | 16 | 12 | 4 | P3 — property listings",
      "sourceHash12": "a7b8c9d0e1f2",
      "firstSeen": "2025-12-13",
      "lastSeen": "2025-12-14",
      "mentions": 1,
      "sprintBucket": "Backlog"
    },
    {
      "key": "bug-011-notification-catch",
      "externalId": "BUG-011",
      "displayRef": "BUG-011",
      "category": "Bugs",
      "priority": "P3",
      "status": "pending",
      "title": "Add .catch() to notification .then() chains",
      "issue": "Unhandled .then() chains in notification handlers cause silent failures",
      "action": "Add .catch() to notification handlers",
      "riskTags": [],
      "effort": "S",
      "impact": 3,
      "impactBasis": "P3 base (3)",
      "location": "lib/notifications/*",
      "sourceRef": "v65.22 Identified Bugs table",
      "evidenceSnippet": "Unhandled .then() chains | Silent failures | Add .catch()",
      "sourceHash12": "d4e5f6a7b8c9",
      "firstSeen": "2025-12-13",
      "lastSeen": "2025-12-14",
      "mentions": 2,
      "sprintBucket": "Backlog"
    },
    {
      "key": "eff-actionlint-workflow",
      "externalId": null,
      "displayRef": "REF-003",
      "category": "Efficiency",
      "priority": "P3",
      "status": "pending",
      "title": "Add actionlint/workflow validation job",
      "issue": "No automated checks enforce fork-safety/secret guards in workflows",
      "action": "Add actionlint or a reusable composite check for workflows touching secrets",
      "riskTags": ["INTEGRATION"],
      "effort": "S",
      "impact": 3,
      "impactBasis": "P3 base (3)",
      "location": ".github/workflows/*",
      "sourceRef": "v65.21 CI Lint Hardening",
      "evidenceSnippet": "Add actionlint/workflow validation job | Backlog | Prevent future schema warnings",
      "sourceHash12": "d0e1f2a3b4c5",
      "firstSeen": "2025-12-13",
      "lastSeen": "2025-12-14",
      "mentions": 1,
      "sprintBucket": "Backlog"
    }
  ],
  "open_questions": []
}
