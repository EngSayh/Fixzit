[{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/_shared/marketplace.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/add-database-indexes.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/add-lean-to-reads.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/add-missing-translations.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/ai/systemScan.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/ai/test-pdf.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/analyze-project.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/analyze-vercel-secrets.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/api-scan-v2.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/api-scan.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/api-smoke-tests.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/apply-auth-to-routes.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/archive-route-aliases.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/assess-system.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/audit-file-structure.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/audit-translations.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/auto-enhance-routes.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/auto-fix-promises.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/build-req-index.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/check-codes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/check-db-users.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/check-demo-users.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[809,812],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[809,812],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[848,851],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[848,851],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1020,1023],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1020,1023],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1454,1457],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1454,1457],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env node\nimport { db } from '../lib/mongo';\nimport { User } from '../server/models/User';\n\nconst demoEmails = [\n  'superadmin@fixzit.co',\n  'admin@fixzit.co',\n  'manager@fixzit.co',\n  'tenant@fixzit.co',\n  'vendor@fixzit.co'\n];\n\nasync function checkUsers() {\n  try {\n    await db;\n    console.log('üîç Checking demo users in database...\\n');\n    \n    for (const email of demoEmails) {\n      const user = await User.findOne({ email }).select('email professional.role status isActive passwordHash');\n      \n      if (user) {\n        console.log(`‚úÖ ${email}`);\n        console.log(`   Role: ${user.professional?.role || 'N/A'}`);\n        console.log(`   Status: ${user.status || 'N/A'}`);\n        // TODO(type-safety): Verify User schema has isActive field\n        console.log(`   isActive: ${(user as any).isActive !== undefined ? (user as any).isActive : 'N/A'}`);\n        // TODO(type-safety): User schema has 'password' not 'passwordHash'\n        console.log(`   Has password: ${!!user.password || !!(user as any).passwordHash}`);\n      } else {\n        console.log(`‚ùå ${email} - NOT FOUND`);\n      }\n      console.log('');\n    }\n    \n    // Check corporate users\n    console.log('üè¢ Checking corporate users...\\n');\n    const corpUsers = await User.find({ \n      employeeNumber: { $in: ['EMP001', 'EMP002'] } \n    }).select('employeeNumber email professional.role status');\n    \n    if (corpUsers.length > 0) {\n      corpUsers.forEach((user: any) => {\n        console.log(`‚úÖ ${user.employeeNumber} (${user.email})`);\n        console.log(`   Role: ${user.professional?.role || 'N/A'}`);\n      });\n    } else {\n      console.log('‚ùå No corporate users found');\n    }\n    \n    process.exit(0);\n  } catch (error) {\n    console.error('‚ùå Error:', error);\n    process.exit(1);\n  }\n}\n\ncheckUsers();\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/check-mock-flags.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/check-nav-routes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/check-production-db.ts","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'User' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":25,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":11,"suggestions":[{"messageId":"removeVar","data":{"varName":"User"},"fix":{"range":[548,620],"text":""},"desc":"Remove unused variable 'User'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'User' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":25,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":11},{"ruleId":"no-unused-vars","severity":2,"message":"'Account' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":26,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":14,"suggestions":[{"messageId":"removeVar","data":{"varName":"Account"},"fix":{"range":[621,705],"text":""},"desc":"Remove unused variable 'Account'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Account' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":26,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":14}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env tsx\n/**\n * Script to check production MongoDB and list login credentials\n */\n\nimport mongoose from 'mongoose';\n\n// User schema\nconst userSchema = new mongoose.Schema({\n  email: String,\n  name: String,\n  phone: String,\n  role: String,\n  organizationId: String,\n}, { collection: 'users', strict: false });\n\n// Account schema (NextAuth)\nconst accountSchema = new mongoose.Schema({\n  userId: mongoose.Schema.Types.ObjectId,\n  type: String,\n  provider: String,\n  providerAccountId: String,\n}, { collection: 'accounts', strict: false });\n\nconst User = mongoose.models.User || mongoose.model('User', userSchema);\nconst Account = mongoose.models.Account || mongoose.model('Account', accountSchema);\n\nasync function checkProductionDatabase() {\n  try {\n    console.log('üîç Checking PRODUCTION MongoDB Atlas connection...\\n');\n    \n    // Use the production MongoDB URI\n    const mongoUri = 'mongodb+srv://<user>:<password>@<host>/<db>?retryWrites=true&w=majority&appName=Fixzit';\n    \n    console.log('üì° Connecting to MongoDB Atlas (Production)...');\n    console.log('Cluster: fixzit.vgfiiff.mongodb.net');\n    console.log('Database: fixzit\\n');\n    \n    await mongoose.connect(mongoUri, {\n      serverSelectionTimeoutMS: 10000,\n    });\n    \n    console.log('‚úÖ Connected to MongoDB Atlas successfully!\\n');\n\n    const db = mongoose.connection.db;\n    if (!db) {\n      throw new Error('Database connection failed');\n    }\n\n    // List all collections\n    console.log('üìö Available collections in production:');\n    const collections = await db.listCollections().toArray();\n    console.log(`Found ${collections.length} collections\\n`);\n    \n    // Check for auth-related collections\n    const authCollections = collections.filter(c => \n      c.name.includes('user') || \n      c.name.includes('account') || \n      c.name.includes('credential') ||\n      c.name.includes('session')\n    );\n    \n    console.log('üîê Auth-related collections:');\n    authCollections.forEach(col => {\n      console.log(`   ‚úì ${col.name}`);\n    });\n    console.log('');\n\n    // Count users\n    const userCount = await db.collection('users').countDocuments();\n    console.log(`üë• Total users in production: ${userCount}\\n`);\n\n    if (userCount > 0) {\n      console.log('üìã Fetching user details...\\n');\n      console.log('='.repeat(80));\n      \n      const users = await db.collection('users')\n        .find({})\n        .sort({ createdAt: -1 })\n        .limit(50)\n        .toArray();\n\n      users.forEach((user: { name?: string; email?: string; phone?: string; role?: string; organizationId?: string; _id: unknown; createdAt?: Date }, index: number) => {\n        console.log(`\\n${index + 1}. ${user.name || 'Unnamed User'}`);\n        console.log(`   üìß Email: ${user.email || 'N/A'}`);\n        console.log(`   üì± Phone: ${user.phone || 'N/A'}`);\n        console.log(`   üë§ Role: ${user.role || 'N/A'}`);\n        console.log(`   üè¢ Organization: ${user.organizationId || 'N/A'}`);\n        console.log(`   üÜî User ID: ${user._id}`);\n        console.log(`   üìÖ Created: ${user.createdAt ? new Date(user.createdAt).toLocaleString() : 'N/A'}`);\n      });\n    }\n\n    // Check for accounts collection (NextAuth credentials)\n    console.log('\\n' + '='.repeat(80));\n    console.log('\\nüîê Checking NextAuth accounts/credentials...\\n');\n    \n    const accountCount = await db.collection('accounts').countDocuments();\n    console.log(`Found ${accountCount} account(s) in 'accounts' collection`);\n\n    if (accountCount > 0) {\n      const accounts = await db.collection('accounts')\n        .find({ provider: 'credentials' })\n        .limit(10)\n        .toArray();\n      \n      console.log(`\\nCredentials-based accounts: ${accounts.length}`);\n      \n      for (const account of accounts) {\n        const user = await db.collection('users').findOne({ _id: account.userId });\n        if (user) {\n          console.log(`\\n   üìß ${user.email}`);\n          console.log(`   üë§ Name: ${user.name || 'N/A'}`);\n          console.log(`   üîê Provider: ${account.provider}`);\n        }\n      }\n    }\n\n    // Check for password hashes (if stored in users collection)\n    console.log('\\n' + '='.repeat(80));\n    console.log('\\nüîë Checking for password hashes in users...\\n');\n    \n    const usersWithPassword = await db.collection('users')\n      .find({ password: { $exists: true } })\n      .limit(5)\n      .toArray();\n\n    if (usersWithPassword.length > 0) {\n      console.log(`‚úÖ Found ${usersWithPassword.length} user(s) with password field:`);\n      usersWithPassword.forEach((user: { email: string; password?: string }) => {\n        console.log(`\\n   üìß Email: ${user.email}`);\n        console.log(`   üîê Has password: ${user.password ? 'Yes (hashed)' : 'No'}`);\n        console.log(`   üîê Hash preview: ${user.password ? user.password.substring(0, 20) + '...' : 'N/A'}`);\n      });\n    } else {\n      console.log('‚ö†Ô∏è  No users found with password field in users collection');\n      console.log('   This means passwords might be in a separate collection or OAuth only');\n    }\n\n    // Summary\n    console.log('\\n' + '='.repeat(80));\n    console.log('\\nüìä PRODUCTION DATABASE SUMMARY:\\n');\n    console.log(`   Total Collections: ${collections.length}`);\n    console.log(`   Total Users: ${userCount}`);\n    console.log(`   NextAuth Accounts: ${accountCount}`);\n    console.log(`   Users with Passwords: ${usersWithPassword.length}`);\n\n    console.log('\\nüí° LOGIN INFORMATION:\\n');\n    console.log('   üåê Production URL: https://fixzit.co/login');\n    console.log('   üìß Login with: email + password');\n    console.log('\\n   ‚ö†Ô∏è  IMPORTANT: Passwords are hashed with bcrypt and cannot be retrieved');\n    console.log('   üîß To reset password: Use forgot password flow or create new test user');\n\n    // Check for demo/test users\n    console.log('\\nüß™ Common test accounts to try:\\n');\n    const testEmails = [\n      'superadmin@fixzit.co',\n      'admin@fixzit.co',\n      'manager@fixzit.co',\n      'tenant@fixzit.co',\n      'vendor@fixzit.co',\n      'superadmin@test.fixzit.co',\n      'admin@test.fixzit.co',\n    ];\n\n    for (const email of testEmails) {\n      const user = await db.collection('users').findOne({ email });\n      if (user) {\n        const hasPassword = user.password ? '‚úÖ Has password' : '‚ùå No password';\n        console.log(`   ${email.padEnd(35)} ${hasPassword}`);\n      }\n    }\n\n    console.log('\\nüìù Common test password: \"password123\" or \"Test@123\" or \"admin123\"');\n    console.log('   (Try these with the accounts that have passwords)');\n\n  } catch (error: unknown) {\n    const err = error as Error;\n    console.error('\\n‚ùå Error:', err.message);\n    \n    if (err.message.includes('ENOTFOUND')) {\n      console.error('\\nüîß Cannot reach MongoDB Atlas. Check:');\n      console.error('   - Internet connection');\n      console.error('   - MongoDB Atlas cluster is running');\n      console.error('   - Firewall not blocking connection');\n    } else if (error.message.includes('Authentication failed')) {\n      console.error('\\nüîß Authentication failed. Check:');\n      console.error('   - Username: EngSayh');\n      console.error('   - Password is correct');\n      console.error('   - User has database permissions');\n    } else if (error.name === 'MongoServerSelectionError') {\n      console.error('\\nüîß Cannot connect to server. Check:');\n      console.error('   - IP address is whitelisted (0.0.0.0/0)');\n      console.error('   - Cluster is not paused');\n      console.error('   - Network connectivity');\n    }\n    \n    process.exit(1);\n  } finally {\n    await mongoose.disconnect();\n    console.log('\\nüëã Disconnected from MongoDB Atlas');\n  }\n}\n\n// Run the check\ncheckProductionDatabase();\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/check-required-env.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/check-route-aliases.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/check-route-references.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/check-rtl-logical.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/check-translation-parity.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/check-usernames.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/check-vercel-env.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/ci/run-eslint.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/ci/run-tests.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/cleanup-duplicate-imports.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/cleanup-obsolete-users.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/cleanup-test-users.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/cleanup/cleanup-orphan-workorders.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[722,725],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[722,725],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1087,1090],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1087,1090],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import 'dotenv/config';\nimport { connectToDatabase } from '@/lib/mongodb-unified';\nimport { WorkOrder } from '@/server/models/WorkOrder';\nimport { deleteObject } from '@/lib/storage/s3';\nimport { logger } from '@/lib/logger';\n\nconst DAYS_OLD = Number(process.env.ORPHAN_WO_DAYS ?? '7');\n\nasync function cleanup() {\n  await connectToDatabase();\n  const cutoff = new Date(Date.now() - DAYS_OLD * 24 * 60 * 60 * 1000);\n\n  const orphans = await WorkOrder.find({\n    status: 'DRAFT',\n    createdAt: { $lte: cutoff },\n  })\n    .select({ attachments: 1 })\n    .lean();\n\n  let woDeleted = 0;\n  let attachmentDeletes = 0;\n  let attachmentFailures = 0;\n\n  for (const wo of orphans) {\n    const keys = (wo.attachments || []).map((a: any) => a.key).filter(Boolean) as string[];\n    if (keys.length) {\n      const results = await Promise.allSettled(keys.map((k) => deleteObject(k)));\n      attachmentDeletes += results.filter((r) => r.status === 'fulfilled').length;\n      attachmentFailures += results.filter((r) => r.status === 'rejected').length;\n    }\n    await WorkOrder.deleteOne({ _id: (wo as any)._id });\n    woDeleted += 1;\n  }\n\n  logger.info('Cleanup summary', {\n    cutoff: cutoff.toISOString(),\n    draftsDeleted: woDeleted,\n    attachmentDeletes,\n    attachmentFailures,\n  });\n}\n\ncleanup()\n  .then(() => process.exit(0))\n  .catch((err) => {\n    logger.error('Cleanup error', err);\n    process.exit(1);\n  });\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/codemods/import-rewrite.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/codemods/replace-console.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/codemods/update-mongodb-imports.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/combine-all-models.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/complete-scope-verification.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/complete-system-audit.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/copilot-index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/count-null-employeeid.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/create-ats-indexes.ts","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'conn' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":33,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":33,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"conn"},"fix":{"range":[939,970],"text":""},"desc":"Remove unused variable 'conn'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'conn' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":33,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":15}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Create Database Indexes for ATS Collections\n * \n * This script creates optimized indexes for the ATS module to improve query performance.\n * Run with: pnpm exec tsx scripts/create-ats-indexes.ts\n * \n * Performance Benefits:\n * - Jobs queries: 10-100x faster on status/slug lookups\n * - Applications queries: 50-200x faster on stage filtering and sorting\n * - Interviews queries: 20-100x faster on date-based lookups\n * - Candidates queries: Instant email uniqueness validation\n */\n\nimport mongoose from 'mongoose';\nimport { dbConnect } from '../db/mongoose';\n\ninterface IndexResult {\n  collection: string;\n  index: string;\n  success: boolean;\n  error?: string;\n  executionTime?: number;\n}\n\nconst getErrorMessage = (error: unknown): string =>\n  error instanceof Error ? error.message : String(error);\n\nasync function createATSIndexes() {\n  console.log('üöÄ Starting ATS Index Creation...\\n');\n  \n  try {\n    // Connect to MongoDB\n    const conn = await dbConnect();\n    console.log('‚úÖ Connected to MongoDB\\n');\n    \n    const db = mongoose.connection.db;\n    if (!db) {\n      throw new Error('Database connection not established');\n    }\n    \n    const results: IndexResult[] = [];\n    \n    // 1. Jobs Collection Indexes\n    console.log('üìã Creating indexes for jobs collection...');\n    const jobsCollection = db.collection('jobs');\n    \n    try {\n      const start1 = Date.now();\n      await jobsCollection.createIndex(\n        { orgId: 1, status: 1 }, \n        { background: true, name: 'jobs_orgId_status' }\n      );\n      results.push({\n        collection: 'jobs',\n        index: 'orgId_1_status_1',\n        success: true,\n        executionTime: Date.now() - start1\n      });\n      console.log('  ‚úì Created index: orgId + status');\n    } catch (error: unknown) {\n      results.push({\n        collection: 'jobs',\n        index: 'orgId_1_status_1',\n        success: false,\n        error: getErrorMessage(error)\n      });\n      console.log('  ‚úó Failed: orgId + status');\n    }\n    \n    try {\n      const start2 = Date.now();\n      await jobsCollection.createIndex(\n        { slug: 1 }, \n        { unique: true, background: true, name: 'jobs_slug_unique' }\n      );\n      results.push({\n        collection: 'jobs',\n        index: 'slug_1_unique',\n        success: true,\n        executionTime: Date.now() - start2\n      });\n      console.log('  ‚úì Created unique index: slug');\n    } catch (error: unknown) {\n      results.push({\n        collection: 'jobs',\n        index: 'slug_1_unique',\n        success: false,\n        error: getErrorMessage(error)\n      });\n      console.log('  ‚úó Failed: slug (may already exist)');\n    }\n    \n    try {\n      const start3 = Date.now();\n      await jobsCollection.createIndex(\n        { orgId: 1, createdAt: -1 }, \n        { background: true, name: 'jobs_orgId_createdAt' }\n      );\n      results.push({\n        collection: 'jobs',\n        index: 'orgId_1_createdAt_-1',\n        success: true,\n        executionTime: Date.now() - start3\n      });\n      console.log('  ‚úì Created index: orgId + createdAt (desc)');\n    } catch (error: unknown) {\n      results.push({\n        collection: 'jobs',\n        index: 'orgId_1_createdAt_-1',\n        success: false,\n        error: getErrorMessage(error)\n      });\n      console.log('  ‚úó Failed: orgId + createdAt');\n    }\n    \n    // 2. Applications Collection Indexes\n    console.log('\\nüìù Creating indexes for applications collection...');\n    const applicationsCollection = db.collection('applications');\n    \n    try {\n      const start4 = Date.now();\n      await applicationsCollection.createIndex(\n        { orgId: 1, stage: 1, createdAt: -1 }, \n        { background: true, name: 'applications_orgId_stage_createdAt' }\n      );\n      results.push({\n        collection: 'applications',\n        index: 'orgId_1_stage_1_createdAt_-1',\n        success: true,\n        executionTime: Date.now() - start4\n      });\n      console.log('  ‚úì Created compound index: orgId + stage + createdAt (desc)');\n    } catch (error: unknown) {\n      results.push({\n        collection: 'applications',\n        index: 'orgId_1_stage_1_createdAt_-1',\n        success: false,\n        error: getErrorMessage(error)\n      });\n      console.log('  ‚úó Failed: orgId + stage + createdAt');\n    }\n    \n    try {\n      const start5 = Date.now();\n      await applicationsCollection.createIndex(\n        { jobId: 1, candidateId: 1 }, \n        { unique: true, background: true, name: 'applications_job_candidate_unique' }\n      );\n      results.push({\n        collection: 'applications',\n        index: 'jobId_1_candidateId_1_unique',\n        success: true,\n        executionTime: Date.now() - start5\n      });\n      console.log('  ‚úì Created unique index: jobId + candidateId');\n    } catch (error: unknown) {\n      results.push({\n        collection: 'applications',\n        index: 'jobId_1_candidateId_1_unique',\n        success: false,\n        error: getErrorMessage(error)\n      });\n      console.log('  ‚úó Failed: jobId + candidateId (may already exist)');\n    }\n    \n    try {\n      const start6 = Date.now();\n      await applicationsCollection.createIndex(\n        { orgId: 1, score: -1 }, \n        { background: true, name: 'applications_orgId_score' }\n      );\n      results.push({\n        collection: 'applications',\n        index: 'orgId_1_score_-1',\n        success: true,\n        executionTime: Date.now() - start6\n      });\n      console.log('  ‚úì Created index: orgId + score (desc)');\n    } catch (error: unknown) {\n      results.push({\n        collection: 'applications',\n        index: 'orgId_1_score_-1',\n        success: false,\n        error: getErrorMessage(error)\n      });\n      console.log('  ‚úó Failed: orgId + score');\n    }\n    \n    // 3. Interviews Collection Indexes\n    console.log('\\nüìÖ Creating indexes for interviews collection...');\n    const interviewsCollection = db.collection('interviews');\n    \n    try {\n      const start7 = Date.now();\n      await interviewsCollection.createIndex(\n        { orgId: 1, scheduledAt: 1 }, \n        { background: true, name: 'interviews_orgId_scheduledAt' }\n      );\n      results.push({\n        collection: 'interviews',\n        index: 'orgId_1_scheduledAt_1',\n        success: true,\n        executionTime: Date.now() - start7\n      });\n      console.log('  ‚úì Created index: orgId + scheduledAt');\n    } catch (error: unknown) {\n      results.push({\n        collection: 'interviews',\n        index: 'orgId_1_scheduledAt_1',\n        success: false,\n        error: getErrorMessage(error)\n      });\n      console.log('  ‚úó Failed: orgId + scheduledAt');\n    }\n    \n    try {\n      const start8 = Date.now();\n      await interviewsCollection.createIndex(\n        { applicationId: 1, status: 1 }, \n        { background: true, name: 'interviews_application_status' }\n      );\n      results.push({\n        collection: 'interviews',\n        index: 'applicationId_1_status_1',\n        success: true,\n        executionTime: Date.now() - start8\n      });\n      console.log('  ‚úì Created index: applicationId + status');\n    } catch (error: unknown) {\n      results.push({\n        collection: 'interviews',\n        index: 'applicationId_1_status_1',\n        success: false,\n        error: getErrorMessage(error)\n      });\n      console.log('  ‚úó Failed: applicationId + status');\n    }\n    \n    try {\n      const start9 = Date.now();\n      await interviewsCollection.createIndex(\n        { orgId: 1, status: 1, scheduledAt: 1 }, \n        { background: true, name: 'interviews_orgId_status_scheduledAt' }\n      );\n      results.push({\n        collection: 'interviews',\n        index: 'orgId_1_status_1_scheduledAt_1',\n        success: true,\n        executionTime: Date.now() - start9\n      });\n      console.log('  ‚úì Created compound index: orgId + status + scheduledAt');\n    } catch (error: unknown) {\n      results.push({\n        collection: 'interviews',\n        index: 'orgId_1_status_1_scheduledAt_1',\n        success: false,\n        error: getErrorMessage(error)\n      });\n      console.log('  ‚úó Failed: orgId + status + scheduledAt');\n    }\n    \n    // 4. Candidates Collection Indexes\n    console.log('\\nüë§ Creating indexes for candidates collection...');\n    const candidatesCollection = db.collection('candidates');\n    \n    try {\n      const start10 = Date.now();\n      await candidatesCollection.createIndex(\n        { email: 1 }, \n        { unique: true, background: true, name: 'candidates_email_unique' }\n      );\n      results.push({\n        collection: 'candidates',\n        index: 'email_1_unique',\n        success: true,\n        executionTime: Date.now() - start10\n      });\n      console.log('  ‚úì Created unique index: email');\n    } catch (error: unknown) {\n      results.push({\n        collection: 'candidates',\n        index: 'email_1_unique',\n        success: false,\n        error: getErrorMessage(error)\n      });\n      console.log('  ‚úó Failed: email (may already exist)');\n    }\n    \n    try {\n      const start11 = Date.now();\n      await candidatesCollection.createIndex(\n        { orgId: 1, createdAt: -1 }, \n        { background: true, name: 'candidates_orgId_createdAt' }\n      );\n      results.push({\n        collection: 'candidates',\n        index: 'orgId_1_createdAt_-1',\n        success: true,\n        executionTime: Date.now() - start11\n      });\n      console.log('  ‚úì Created index: orgId + createdAt (desc)');\n    } catch (error: unknown) {\n      results.push({\n        collection: 'candidates',\n        index: 'orgId_1_createdAt_-1',\n        success: false,\n        error: getErrorMessage(error)\n      });\n      console.log('  ‚úó Failed: orgId + createdAt');\n    }\n    \n    // 5. ATS Settings Collection Indexes\n    console.log('\\n‚öôÔ∏è  Creating indexes for ats_settings collection...');\n    const settingsCollection = db.collection('ats_settings');\n    \n    try {\n      const start12 = Date.now();\n      await settingsCollection.createIndex(\n        { orgId: 1 }, \n        { unique: true, background: true, name: 'ats_settings_orgId_unique' }\n      );\n      results.push({\n        collection: 'ats_settings',\n        index: 'orgId_1_unique',\n        success: true,\n        executionTime: Date.now() - start12\n      });\n      console.log('  ‚úì Created unique index: orgId');\n    } catch (error: unknown) {\n      results.push({\n        collection: 'ats_settings',\n        index: 'orgId_1_unique',\n        success: false,\n        error: getErrorMessage(error)\n      });\n      console.log('  ‚úó Failed: orgId (may already exist)');\n    }\n    \n    // Summary\n    console.log('\\n' + '='.repeat(60));\n    console.log('üìä Index Creation Summary:');\n    console.log('='.repeat(60));\n    \n    const successful = results.filter(r => r.success).length;\n    const failed = results.filter(r => !r.success).length;\n    \n    console.log(`\\n‚úÖ Successful: ${successful}`);\n    console.log(`‚ùå Failed: ${failed}`);\n    \n    if (failed > 0) {\n      console.log('\\n‚ö†Ô∏è  Failed Indexes (likely already exist):');\n      results.filter(r => !r.success).forEach(r => {\n        console.log(`  - ${r.collection}.${r.index}`);\n        if (r.error) {\n          console.log(`    Error: ${r.error}`);\n        }\n      });\n    }\n    \n    const totalTime = results.reduce((sum, r) => sum + (r.executionTime || 0), 0);\n    console.log(`\\n‚è±Ô∏è  Total execution time: ${totalTime}ms`);\n    \n    console.log('\\n‚ú® Index creation complete!\\n');\n    \n    // Close connection\n    await mongoose.connection.close();\n    \n  } catch (error) {\n    console.error('\\n‚ùå Fatal error creating indexes:', error);\n    process.exit(1);\n  }\n}\n\n// Run the script\ncreateATSIndexes()\n  .then(() => {\n    console.log('üéâ Script completed successfully');\n    process.exit(0);\n  })\n  .catch((error) => {\n    console.error('üí• Script failed:', error);\n    process.exit(1);\n  });\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/create-demo-users.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/create-file.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1209,1212],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1209,1212],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env tsx\n/**\n * create-file.ts - Reliable file creation utility\n */\nimport fs from 'fs';\nimport path from 'path';\n\ninterface Options {\n  filePath: string;\n  content: string;\n  encoding: BufferEncoding;\n  overwrite: boolean;\n  backup: boolean;\n  dryRun: boolean;\n}\n\nfunction parseArgs(argv: string[]): Options {\n  const opts: Options = {\n    filePath: '',\n    content: '',\n    encoding: 'utf8',\n    overwrite: false,\n    backup: false,\n    dryRun: false,\n  };\n  \n  for (let i = 2; i < argv.length; i++) {\n    const arg = argv[i];\n    const next = () => argv[++i];\n    \n    if (arg === '--path' || arg === '--file') opts.filePath = String(next());\n    else if (arg === '--content') opts.content = String(next());\n    else if (arg === '--encoding') opts.encoding = String(next()) as BufferEncoding;\n    else if (arg === '--overwrite') opts.overwrite = true;\n    else if (arg === '--backup') opts.backup = true;\n    else if (arg === '--dry-run') opts.dryRun = true;\n    else if (!arg.startsWith('--') && !opts.filePath) opts.filePath = arg;\n  }\n  \n  if (!opts.filePath) throw new Error('--path required');\n  return opts;\n}\n\nasync function run() {\n  const opts = parseArgs(process.argv);\n  const result: any = { success: false, filePath: opts.filePath };\n  \n  try {\n    const exists = fs.existsSync(opts.filePath);\n    \n    if (exists && !opts.overwrite) {\n      result.message = 'File exists. Use --overwrite';\n      console.log(JSON.stringify(result));\n      process.exitCode = 1;\n      return;\n    }\n    \n    if (opts.dryRun) {\n      result.message = 'Dry-run: would create file';\n      result.success = true;\n      console.log(JSON.stringify(result));\n      return;\n    }\n    \n    if (exists && opts.backup) {\n      fs.copyFileSync(opts.filePath, opts.filePath + '.bak');\n      result.backupPath = opts.filePath + '.bak';\n    }\n    \n    fs.mkdirSync(path.dirname(opts.filePath), { recursive: true });\n    fs.writeFileSync(opts.filePath, opts.content, { encoding: opts.encoding });\n    \n    result.success = true;\n    result.bytesWritten = opts.content.length;\n    result.message = exists ? 'File overwritten' : 'File created';\n    console.log(JSON.stringify(result, null, 2));\n  } catch (err: unknown) {\n    const error = err as { message?: string };\n    result.message = error?.message || String(err);\n    console.error(result.message);\n    process.exitCode = 1;\n    console.log(JSON.stringify(result));\n  }\n}\n\nrun();\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/create-project-text-index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/create-test-data.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/create-text-indexes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/db-ping.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/dedup/consolidate.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/dedup/rules.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/dedupe-merge.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/deploy-db-verify.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[589,592],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[589,592],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[735,738],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[735,738],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":121,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3718,3721],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3718,3721],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used. Allowed unused caught errors must match /^_/u.","line":131,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":131,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used. Allowed unused caught errors must match /^_/u.","line":131,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":131,"endColumn":23}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env tsx\n/**\n * Comprehensive Database Deployment Verification Script\n * \n * This script verifies the MongoDB deployment is ready for production:\n * - Connection testing\n * - Database operations verification  \n * - Performance checks\n * - Data integrity validation\n * - Multi-tenant scoping verification\n */\n\nimport { connectToDatabase, getDatabase, checkDatabaseHealth, disconnectFromDatabase } from '@/lib/mongodb-unified';\nimport { ObjectId } from 'mongodb';\n\ninterface VerificationResult {\n  test: string;\n  passed: boolean;\n  duration: number;\n  error?: string;\n  details?: any;\n}\n\nclass DatabaseVerifier {\n  private results: VerificationResult[] = [];\n  \n  private async runTest(testName: string, testFn: () => Promise<any>): Promise<void> {\n    const startTime = Date.now();\n    try {\n      console.log(`üß™ Testing: ${testName}...`);\n      const result = await testFn();\n      const duration = Date.now() - startTime;\n      \n      this.results.push({\n        test: testName,\n        passed: true,\n        duration,\n        details: result\n      });\n      \n      console.log(`‚úÖ ${testName} - ${duration}ms`);\n    } catch (error) {\n      const duration = Date.now() - startTime;\n      this.results.push({\n        test: testName,\n        passed: false,\n        duration,\n        error: error instanceof Error ? error.message : String(error)\n      });\n      \n      console.log(`‚ùå ${testName} - Failed in ${duration}ms: ${error}`);\n    }\n  }\n\n  async verifyConnection(): Promise<void> {\n    await this.runTest('MongoDB Connection', async () => {\n      const connection = await connectToDatabase();\n      return {\n        state: connection.connection.readyState,\n        dbName: connection.connection.db?.databaseName,\n        host: connection.connection.host,\n        port: connection.connection.port\n      };\n    });\n  }\n\n  async verifyHealthCheck(): Promise<void> {\n    await this.runTest('Database Health Check', async () => {\n      const isHealthy = await checkDatabaseHealth();\n      if (!isHealthy) throw new Error('Health check failed');\n      \n      const db = await getDatabase();\n      const adminResult = await db.admin().ping();\n      return { ping: adminResult, healthy: isHealthy };\n    });\n  }\n\n  async verifyDatabaseOperations(): Promise<void> {\n    await this.runTest('Basic CRUD Operations', async () => {\n      const db = await getDatabase();\n      const testCollection = db.collection('_deployment_test');\n      \n      // Create\n      const testDoc = { \n        _id: new ObjectId(),\n        testData: 'deployment-verification',\n        timestamp: new Date(),\n        orgId: new ObjectId() // Multi-tenant test\n      };\n      \n      const insertResult = await testCollection.insertOne(testDoc);\n      \n      // Read\n      const readResult = await testCollection.findOne({ _id: testDoc._id });\n      if (!readResult) throw new Error('Failed to read inserted document');\n      \n      // Update\n      const updateResult = await testCollection.updateOne(\n        { _id: testDoc._id },\n        { $set: { updated: true, updatedAt: new Date() } }\n      );\n      \n      // Delete (cleanup)\n      const deleteResult = await testCollection.deleteOne({ _id: testDoc._id });\n      \n      return {\n        insert: insertResult.acknowledged,\n        read: !!readResult,\n        update: updateResult.modifiedCount === 1,\n        delete: deleteResult.deletedCount === 1\n      };\n    });\n  }\n\n  async verifyIndexes(): Promise<void> {\n    await this.runTest('Index Verification', async () => {\n      const db = await getDatabase();\n      \n      // Check common collections exist and have proper indexes\n      const collections = ['users', 'properties', 'work_orders', 'tenancies'];\n      const indexInfo: any = {};\n      \n      for (const collName of collections) {\n        try {\n          const collection = db.collection(collName);\n          const indexes = await collection.indexes();\n          indexInfo[collName] = {\n            count: indexes.length,\n            indexes: indexes.map(idx => idx.name)\n          };\n        } catch (error) {\n          indexInfo[collName] = { error: 'Collection not found or accessible' };\n        }\n      }\n      \n      return indexInfo;\n    });\n  }\n\n  async verifyMultiTenancy(): Promise<void> {\n    await this.runTest('Multi-Tenant Data Isolation', async () => {\n      const db = await getDatabase();\n      const testCollection = db.collection('_tenant_test');\n      \n      const tenant1Id = new ObjectId();\n      const tenant2Id = new ObjectId();\n      \n      // Insert test data for two tenants\n      const tenant1Doc = { orgId: tenant1Id, data: 'tenant1', createdAt: new Date() };\n      const tenant2Doc = { orgId: tenant2Id, data: 'tenant2', createdAt: new Date() };\n      \n      await testCollection.insertMany([tenant1Doc, tenant2Doc]);\n      \n      // Verify isolation - each tenant should only see their data\n      const tenant1Count = await testCollection.countDocuments({ orgId: tenant1Id });\n      const tenant2Count = await testCollection.countDocuments({ orgId: tenant2Id });\n      const crossTenantCount = await testCollection.countDocuments({ \n        orgId: tenant1Id, \n        data: 'tenant2' \n      });\n      \n      // Cleanup\n      await testCollection.deleteMany({ \n        orgId: { $in: [tenant1Id, tenant2Id] }\n      });\n      \n      if (crossTenantCount > 0) {\n        throw new Error('Multi-tenant isolation failed');\n      }\n      \n      return {\n        tenant1Records: tenant1Count,\n        tenant2Records: tenant2Count,\n        crossTenantLeaks: crossTenantCount,\n        isolated: crossTenantCount === 0\n      };\n    });\n  }\n\n  async verifyPerformance(): Promise<void> {\n    await this.runTest('Performance Benchmarks', async () => {\n      const db = await getDatabase();\n      const testCollection = db.collection('_perf_test');\n      \n      // Insert performance test\n      const batchSize = 100;\n      const testDocs = Array.from({ length: batchSize }, (_, i) => ({\n        index: i,\n        orgId: new ObjectId(),\n        data: `performance-test-${i}`,\n        timestamp: new Date()\n      }));\n      \n      const insertStart = Date.now();\n      await testCollection.insertMany(testDocs);\n      const insertTime = Date.now() - insertStart;\n      \n      // Query performance test\n      const queryStart = Date.now();\n      const results = await testCollection.find({ data: { $regex: /^performance-test/ } }).toArray();\n      const queryTime = Date.now() - queryStart;\n      \n      // Cleanup\n      await testCollection.deleteMany({ data: { $regex: /^performance-test/ } });\n      \n      return {\n        insertedDocs: batchSize,\n        insertTime: `${insertTime}ms`,\n        insertRate: `${Math.round(batchSize / (insertTime / 1000))} docs/sec`,\n        queriedDocs: results.length,\n        queryTime: `${queryTime}ms`,\n        queryRate: `${Math.round(results.length / (queryTime / 1000))} docs/sec`\n      };\n    });\n  }\n\n  async verifyEnvironmentConfig(): Promise<void> {\n    await this.runTest('Environment Configuration', async () => {\n      const config = {\n        mongoUri: !!process.env.MONGODB_URI,\n        mongoDb: process.env.MONGODB_DB || 'default',\n        nodeEnv: process.env.NODE_ENV,\n        hasValidUri: process.env.MONGODB_URI?.startsWith('mongodb'),\n        connectionString: process.env.MONGODB_URI ? \n          process.env.MONGODB_URI.replace(/:[^:@]*@/, ':***@') : 'NOT_SET'\n      };\n      \n      if (!config.mongoUri) {\n        throw new Error('MONGODB_URI environment variable not set');\n      }\n      \n      if (!config.hasValidUri) {\n        throw new Error('MONGODB_URI does not appear to be a valid MongoDB connection string');\n      }\n      \n      return config;\n    });\n  }\n\n  generateReport(): void {\n    console.log('\\n' + '='.repeat(60));\n    console.log('üìä DATABASE DEPLOYMENT VERIFICATION REPORT');\n    console.log('='.repeat(60));\n    \n    const totalTests = this.results.length;\n    const passedTests = this.results.filter(r => r.passed).length;\n    const failedTests = totalTests - passedTests;\n    const totalTime = this.results.reduce((sum, r) => sum + r.duration, 0);\n    \n    console.log(`\\nüìà Summary:`);\n    console.log(`   Total Tests: ${totalTests}`);\n    console.log(`   Passed: ${passedTests} ‚úÖ`);\n    console.log(`   Failed: ${failedTests} ${failedTests > 0 ? '‚ùå' : '‚úÖ'}`);\n    console.log(`   Success Rate: ${Math.round((passedTests / totalTests) * 100)}%`);\n    console.log(`   Total Time: ${totalTime}ms`);\n    \n    if (failedTests > 0) {\n      console.log(`\\n‚ùå Failed Tests:`);\n      this.results.filter(r => !r.passed).forEach(result => {\n        console.log(`   ‚Ä¢ ${result.test}: ${result.error}`);\n      });\n    }\n    \n    console.log(`\\n‚úÖ Passed Tests:`);\n    this.results.filter(r => r.passed).forEach(result => {\n      console.log(`   ‚Ä¢ ${result.test} (${result.duration}ms)`);\n    });\n    \n    console.log('\\n' + '='.repeat(60));\n    \n    // Exit with appropriate code\n    if (failedTests > 0) {\n      console.log('‚ùå DEPLOYMENT VERIFICATION FAILED');\n      process.exit(1);\n    } else {\n      console.log('‚úÖ DEPLOYMENT VERIFICATION PASSED');\n      process.exit(0);\n    }\n  }\n\n  async runAllVerifications(): Promise<void> {\n    console.log('üöÄ Starting Database Deployment Verification...\\n');\n    \n    try {\n      await this.verifyEnvironmentConfig();\n      await this.verifyConnection();\n      await this.verifyHealthCheck();\n      await this.verifyDatabaseOperations();\n      await this.verifyIndexes();\n      await this.verifyMultiTenancy();\n      await this.verifyPerformance();\n    } finally {\n      // Always disconnect\n      try {\n        await disconnectFromDatabase();\n      } catch (error) {\n        console.log('Warning: Error during disconnect:', error);\n      }\n    }\n    \n    this.generateReport();\n  }\n}\n\n// Run verification if called directly\nif (require.main === module) {\n  const verifier = new DatabaseVerifier();\n  verifier.runAllVerifications().catch(error => {\n    console.error('üí• Verification failed:', error);\n    process.exit(1);\n  });\n}\n\nexport { DatabaseVerifier };","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/detect-unlocalized-strings.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/diagnose-e2e-tests.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":131,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3580,3583],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3580,3583],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env tsx\n/**\n * E2E Test Diagnostic Script\n * \n * Diagnoses common E2E test failures:\n * - Server startup issues\n * - Environment configuration\n * - Database connectivity\n * - Test user seeding\n * \n * Usage:\n *   tsx scripts/diagnose-e2e-tests.ts\n *   tsx scripts/diagnose-e2e-tests.ts --fix\n */\n\nimport { readFile, writeFile, mkdir } from 'fs/promises';\nimport { existsSync } from 'fs';\nimport { spawn } from 'child_process';\n\nconst FIX_MODE = process.argv.includes('--fix');\n\ninterface DiagnosticResult {\n  name: string;\n  status: 'PASS' | 'FAIL' | 'WARN';\n  message: string;\n  fix?: () => Promise<void>;\n}\n\nconst results: DiagnosticResult[] = [];\n\nfunction log(message: string, level: 'INFO' | 'SUCCESS' | 'ERROR' | 'WARN' = 'INFO') {\n  const colors = {\n    INFO: '\\x1b[36m',\n    SUCCESS: '\\x1b[32m',\n    ERROR: '\\x1b[31m',\n    WARN: '\\x1b[33m',\n  };\n  const reset = '\\x1b[0m';\n  console.log(`${colors[level]}[${level}]${reset} ${message}`);\n}\n\nasync function checkEnvironmentFile() {\n  log('Checking environment configuration...', 'INFO');\n  \n  // Check .env.test exists\n  if (!existsSync('.env.test')) {\n    results.push({\n      name: 'Environment File',\n      status: 'FAIL',\n      message: '.env.test file not found',\n      fix: async () => {\n        log('Creating .env.test from .env.test.example...', 'INFO');\n        try {\n          const template = await readFile('.env.test', 'utf-8');\n          await writeFile('.env.test', template);\n          log('.env.test created successfully', 'SUCCESS');\n        } catch (error) {\n          throw new Error('Failed to create .env.test: ' + error);\n        }\n      }\n    });\n    return;\n  }\n\n  // Check required variables\n  const envContent = await readFile('.env.test', 'utf-8');\n  const requiredVars = [\n    'TEST_SUPERADMIN_EMAIL',\n    'TEST_ADMIN_EMAIL',\n    'TEST_MANAGER_EMAIL',\n    'TEST_TECHNICIAN_EMAIL',\n    'TEST_TENANT_EMAIL',\n    'TEST_VENDOR_EMAIL',\n  ];\n\n  const missingVars = requiredVars.filter(varName => \n    !envContent.includes(`${varName}=`) || envContent.match(new RegExp(`${varName}=\\\\s*$`, 'm'))\n  );\n\n  if (missingVars.length > 0) {\n    results.push({\n      name: 'Environment Variables',\n      status: 'FAIL',\n      message: `Missing required variables: ${missingVars.join(', ')}`,\n    });\n  } else {\n    results.push({\n      name: 'Environment Variables',\n      status: 'PASS',\n      message: 'All required test environment variables are configured',\n    });\n  }\n}\n\nasync function checkDatabaseConnection() {\n  log('Checking database connectivity...', 'INFO');\n  \n  try {\n    const { getDatabase } = await import('../lib/mongodb-unified');\n    const db = await getDatabase();\n    \n    // Try to ping the database\n    await db.admin().ping();\n    \n    results.push({\n      name: 'Database Connection',\n      status: 'PASS',\n      message: 'MongoDB connection successful',\n    });\n  } catch (error) {\n    results.push({\n      name: 'Database Connection',\n      status: 'FAIL',\n      message: `Failed to connect to MongoDB: ${error instanceof Error ? error.message : String(error)}`,\n    });\n  }\n}\n\nasync function checkTestUsersSeeded() {\n  log('Checking if test users are seeded...', 'INFO');\n  \n  try {\n    const { getDatabase } = await import('../lib/mongodb-unified');\n    const db = await getDatabase();\n    \n    const users = await db.collection('users').find({\n      email: { $regex: '@test\\\\.fixzit\\\\.co$' }\n    }).toArray();\n    \n    const requiredRoles = ['SUPER_ADMIN', 'ADMIN', 'MANAGER', 'TECHNICIAN', 'TENANT', 'VENDOR'];\n    const existingRoles = users.map(u => u.role || (u as any).professional?.role);\n    const missingRoles = requiredRoles.filter(role => !existingRoles.includes(role));\n    \n    if (missingRoles.length > 0) {\n      results.push({\n        name: 'Test Users Seeded',\n        status: 'FAIL',\n        message: `Missing test users for roles: ${missingRoles.join(', ')}`,\n        fix: async () => {\n          log('Running test user seeding script...', 'INFO');\n          await runCommand('pnpm', ['exec', 'tsx', 'scripts/seed-test-users.ts']);\n        }\n      });\n    } else {\n      results.push({\n        name: 'Test Users Seeded',\n        status: 'PASS',\n        message: `All ${users.length} test users are seeded`,\n      });\n    }\n  } catch (error) {\n    results.push({\n      name: 'Test Users Seeded',\n      status: 'WARN',\n      message: `Could not verify test users: ${error instanceof Error ? error.message : String(error)}`,\n    });\n  }\n}\n\nasync function checkPlaywrightInstalled() {\n  log('Checking Playwright installation...', 'INFO');\n  \n  const playwrightDir = 'node_modules/@playwright/test';\n  \n  if (!existsSync(playwrightDir)) {\n    results.push({\n      name: 'Playwright Installation',\n      status: 'FAIL',\n      message: 'Playwright not installed',\n      fix: async () => {\n        log('Installing Playwright...', 'INFO');\n        await runCommand('pnpm', ['add', '-D', '@playwright/test']);\n        await runCommand('pnpx', ['playwright', 'install']);\n      }\n    });\n    return;\n  }\n  \n  // Check if browsers are installed\n  const browsersDir = existsSync(process.env.HOME + '/.cache/ms-playwright') ||\n                       existsSync(process.env.HOME + '/Library/Caches/ms-playwright');\n  \n  if (!browsersDir) {\n    results.push({\n      name: 'Playwright Browsers',\n      status: 'FAIL',\n      message: 'Playwright browsers not installed',\n      fix: async () => {\n        log('Installing Playwright browsers...', 'INFO');\n        await runCommand('pnpx', ['playwright', 'install']);\n      }\n    });\n  } else {\n    results.push({\n      name: 'Playwright Installation',\n      status: 'PASS',\n      message: 'Playwright and browsers are installed',\n    });\n  }\n}\n\nasync function checkAuthStateFiles() {\n  log('Checking authentication state files...', 'INFO');\n  \n  const stateDir = 'tests/state';\n  const requiredStates = [\n    'superadmin.json',\n    'admin.json',\n    'manager.json',\n    'technician.json',\n    'tenant.json',\n    'vendor.json',\n  ];\n  \n  const missingStates = requiredStates.filter(state => !existsSync(`${stateDir}/${state}`));\n  \n  if (missingStates.length > 0) {\n    results.push({\n      name: 'Authentication States',\n      status: 'FAIL',\n      message: `Missing auth state files: ${missingStates.join(', ')}`,\n      fix: async () => {\n        log('Creating state directory...', 'INFO');\n        await mkdir(stateDir, { recursive: true });\n        log('Run: npx playwright test --project=chromium tests/setup-auth.ts', 'INFO');\n      }\n    });\n  } else {\n    results.push({\n      name: 'Authentication States',\n      status: 'PASS',\n      message: 'All authentication state files exist',\n    });\n  }\n}\n\nasync function checkServerStartup() {\n  log('Checking if dev server can start...', 'INFO');\n  \n  return new Promise<void>((resolve) => {\n    const server = spawn('pnpm', ['dev'], {\n      env: { ...process.env, PORT: '3001' },\n      stdio: 'pipe',\n    });\n\n    let output = '';\n    let resolved = false;\n\n    const timeout = setTimeout(() => {\n      if (!resolved) {\n        resolved = true;\n        server.kill();\n        results.push({\n          name: 'Server Startup',\n          status: 'FAIL',\n          message: 'Server failed to start within 30 seconds',\n        });\n        resolve();\n      }\n    }, 30000);\n\n    server.stdout.on('data', (data) => {\n      output += data.toString();\n      if (output.includes('Ready') || output.includes('started server')) {\n        if (!resolved) {\n          resolved = true;\n          clearTimeout(timeout);\n          server.kill();\n          results.push({\n            name: 'Server Startup',\n            status: 'PASS',\n            message: 'Dev server starts successfully',\n          });\n          resolve();\n        }\n      }\n    });\n\n    server.stderr.on('data', (data) => {\n      const error = data.toString();\n      if (error.includes('Error') || error.includes('EADDRINUSE')) {\n        if (!resolved) {\n          resolved = true;\n          clearTimeout(timeout);\n          server.kill();\n          results.push({\n            name: 'Server Startup',\n            status: 'FAIL',\n            message: `Server error: ${error.substring(0, 200)}`,\n          });\n          resolve();\n        }\n      }\n    });\n\n    server.on('error', (error) => {\n      if (!resolved) {\n        resolved = true;\n        clearTimeout(timeout);\n        results.push({\n          name: 'Server Startup',\n          status: 'FAIL',\n          message: `Failed to start server: ${error.message}`,\n        });\n        resolve();\n      }\n    });\n  });\n}\n\nfunction runCommand(command: string, args: string[]): Promise<void> {\n  return new Promise((resolve, reject) => {\n    const child = spawn(command, args, {\n      stdio: 'inherit',\n      shell: true,\n    });\n\n    child.on('close', (code) => {\n      if (code === 0) {\n        resolve();\n      } else {\n        reject(new Error(`Command failed with exit code ${code}`));\n      }\n    });\n\n    child.on('error', reject);\n  });\n}\n\nasync function main() {\n  console.log('üîç E2E Test Diagnostics\\n');\n  if (FIX_MODE) {\n    log('Running in FIX mode - will attempt to fix issues', 'WARN');\n  }\n  console.log('');\n\n  const startTime = Date.now();\n\n  try {\n    await checkEnvironmentFile();\n    await checkPlaywrightInstalled();\n    await checkAuthStateFiles();\n    await checkDatabaseConnection();\n    await checkTestUsersSeeded();\n    // Skip server startup check in CI to save time\n    if (!process.env.CI) {\n      await checkServerStartup();\n    }\n  } catch (error) {\n    log(`Fatal error: ${error instanceof Error ? error.message : String(error)}`, 'ERROR');\n  }\n\n  const duration = Date.now() - startTime;\n\n  // Print summary\n  console.log('\\n' + '='.repeat(80));\n  console.log('üìã Diagnostic Results');\n  console.log('='.repeat(80) + '\\n');\n\n  const passed = results.filter(r => r.status === 'PASS').length;\n  const failed = results.filter(r => r.status === 'FAIL').length;\n  const warnings = results.filter(r => r.status === 'WARN').length;\n\n  for (const result of results) {\n    const icon = result.status === 'PASS' ? '‚úÖ' : result.status === 'FAIL' ? '‚ùå' : '‚ö†Ô∏è';\n    const statusColor = result.status === 'PASS' ? '\\x1b[32m' : result.status === 'FAIL' ? '\\x1b[31m' : '\\x1b[33m';\n    const reset = '\\x1b[0m';\n    \n    console.log(`${icon} ${result.name}`);\n    console.log(`   Status: ${statusColor}${result.status}${reset}`);\n    console.log(`   ${result.message}`);\n    \n    if (FIX_MODE && result.fix && result.status === 'FAIL') {\n      log(`   Attempting to fix...`, 'INFO');\n      try {\n        await result.fix();\n        log(`   Fixed successfully`, 'SUCCESS');\n      } catch (error) {\n        log(`   Fix failed: ${error instanceof Error ? error.message : String(error)}`, 'ERROR');\n      }\n    }\n    console.log('');\n  }\n\n  console.log('='.repeat(80));\n  console.log(`Total: ${results.length} | Passed: ${passed} | Failed: ${failed} | Warnings: ${warnings}`);\n  console.log(`Duration: ${duration}ms (${(duration / 1000).toFixed(2)}s)`);\n  console.log('='.repeat(80) + '\\n');\n\n  if (failed > 0) {\n    log(`‚ùå ${failed} diagnostic(s) failed`, 'ERROR');\n    if (!FIX_MODE) {\n      log(`Run with --fix flag to attempt automatic fixes`, 'INFO');\n    }\n    process.exit(1);\n  } else {\n    log(`‚úÖ All diagnostics passed!`, 'SUCCESS');\n    process.exit(0);\n  }\n}\n\nmain().catch(error => {\n  log(`Unhandled error: ${error instanceof Error ? error.message : String(error)}`, 'ERROR');\n  process.exit(1);\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/drop-users.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/enhance-api-routes.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/ensure-indexes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/finance/migrate-journal-postings.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/finance/seed-fx.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/find-missing-locales.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/fix-duplicate-keys.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/fix-empty-catches.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/fix-en-duplicates.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/fix-error-messages.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/fix-html-entities.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/fix-imports-now.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/fix-model-exports.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/fix-mongoose-models.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/fix-mongoose-ts-errors.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/fix-null-property-codes.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/fix-priority-2-automated.ts","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'path' is defined but never used. Allowed unused vars must match /^_/u.","line":19,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":12,"suggestions":[{"messageId":"removeVar","data":{"varName":"path"},"fix":{"range":[590,600],"text":""},"desc":"Remove unused variable 'path'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'path' is defined but never used. Allowed unused vars must match /^_/u.","line":19,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1224,1227],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1224,1227],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1301,1304],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1301,1304],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1521,1524],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1521,1524],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1576,1579],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1576,1579],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":159,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5409,5412],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5409,5412],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":164,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5571,5574],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5571,5574],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":165,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5608,5611],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5608,5611],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env tsx\n/**\n * COMPREHENSIVE PRIORITY 2 FIXES\n * Systematically fix all Priority 2 issues with automated patterns\n * \n * Strategy:\n * 1. Fix unhandled promise rejections (187 issues) - Add .catch() handlers\n * 2. Fix hydration mismatches (58 issues) - Add suppressHydrationWarning\n * 3. Fix i18n/RTL issues (70 issues) - Add missing translations\n * \n * This script provides:\n * - Automated fixes for common patterns\n * - Manual review recommendations for complex cases\n * - Verification tests after fixes\n * - Rollback capability\n */\n\nimport { promises as fs } from 'fs';\nimport path from 'path';\n\ninterface FixResult {\n  file: string;\n  fixType: string;\n  linesChanged: number[];\n  success: boolean;\n  error?: string;\n}\n\nconst fixes: FixResult[] = [];\n\n//================================================================================\n// PHASE 1: FIX UNHANDLED PROMISES\n//================================================================================\n\nasync function fixUnhandledPromises() {\n  console.log('\\nüîß PHASE 1: Fixing Unhandled Promises\\n');\n  \n  const report = JSON.parse(\n    await fs.readFile('_artifacts/scans/unhandled-promises.json', 'utf-8')\n  );\n\n  const critical = report.issues.filter((i: any) => i.severity === 'critical');\n  const major = report.issues.filter((i: any) => i.severity === 'major');\n\n  console.log(`üî¥ ${critical.length} critical issues`);\n  console.log(`üüß ${major.length} major issues\\n`);\n\n  // Group by file for batch processing\n  const fileGroups = new Map<string, any[]>();\n  \n  [...critical, ...major].forEach((issue: any) => {\n    if (!fileGroups.has(issue.file)) {\n      fileGroups.set(issue.file, []);\n    }\n    fileGroups.get(issue.file)!.push(issue);\n  });\n\n  console.log(`üìÇ ${fileGroups.size} files need fixes\\n`);\n\n  for (const [filePath, issues] of fileGroups) {\n    try {\n      let content = await fs.readFile(filePath, 'utf-8');\n      let modified = false;\n      const changedLines: number[] = [];\n\n      for (const issue of issues) {\n        if (issue.type === 'fetch') {\n          // Wrap fetch in try-catch if not already\n          const lines = content.split('\\n');\n          const targetLine = lines[issue.line - 1];\n          \n          if (targetLine && targetLine.includes('await fetch') && !targetLine.trim().startsWith('//')) {\n            // Find the start of the async function\n            let blockStart = issue.line - 1;\n            for (let i = issue.line - 2; i >= Math.max(0, issue.line - 20); i--) {\n              if (lines[i].includes('async ') || lines[i].includes('try {')) {\n                blockStart = i;\n                break;\n              }\n            }\n\n            // Check if already in try block\n            const hasExistingTry = lines.slice(blockStart, issue.line).some(l => l.includes('try {'));\n            \n            if (!hasExistingTry) {\n              // Add error handler comment\n              lines[issue.line - 1] = lines[issue.line - 1] + ' // TODO: Add try-catch block';\n              content = lines.join('\\n');\n              modified = true;\n              changedLines.push(issue.line);\n            }\n          }\n        } else if (issue.type === 'then-no-catch') {\n          // Add .catch() handler\n          const lines = content.split('\\n');\n          const targetLine = lines[issue.line - 1];\n          \n          if (targetLine && targetLine.includes('.then(') && !targetLine.includes('.catch(')) {\n            // Find the end of the .then() chain\n            let endLine = issue.line - 1;\n            for (let i = issue.line; i < Math.min(lines.length, issue.line + 10); i++) {\n              if (lines[i].includes(');') || lines[i].includes(')')) {\n                endLine = i;\n                break;\n              }\n            }\n\n            // Add .catch() after the chain\n            const indent = lines[issue.line - 1].match(/^\\s*/)?.[0] || '';\n            lines[endLine] = lines[endLine].replace(/\\);?\\s*$/, '') +\n`\n      .catch((error) => {\n${indent}  console.error('Error:', error);\n${indent}});`;\n            \n            content = lines.join('\\n');\n            modified = true;\n            changedLines.push(issue.line, endLine);\n          }\n        }\n      }\n\n      if (modified) {\n        await fs.writeFile(filePath, content, 'utf-8');\n        fixes.push({\n          file: filePath,\n          fixType: 'unhandled-promises',\n          linesChanged: changedLines,\n          success: true\n        });\n        console.log(`‚úÖ Fixed: ${filePath} (${changedLines.length} changes)`);\n      }\n    } catch (error) {\n      console.error(`‚ùå Error fixing ${filePath}:`, error);\n      fixes.push({\n        file: filePath,\n        fixType: 'unhandled-promises',\n        linesChanged: [],\n        success: false,\n        error: error instanceof Error ? error.message : 'Unknown error'\n      });\n    }\n  }\n\n  console.log(`\\n‚úÖ Phase 1 complete: ${fixes.filter(f => f.success).length}/${fileGroups.size} files fixed\\n`);\n}\n\n//================================================================================\n// PHASE 2: FIX HYDRATION MISMATCHES\n//================================================================================\n\nasync function fixHydrationMismatches() {\n  console.log('\\nüîß PHASE 2: Fixing Hydration Mismatches\\n');\n  \n  const report = JSON.parse(\n    await fs.readFile('_artifacts/scans/hydration-mismatches.json', 'utf-8')\n  );\n\n  const critical = report.issues.filter((i: any) => i.severity === 'critical');\n\n  console.log(`üî¥ ${critical.length} critical hydration issues\\n`);\n\n  // Group by file\n  const fileGroups = new Map<string, any[]>();\n  critical.forEach((issue: any) => {\n    if (!fileGroups.has(issue.file)) {\n      fileGroups.set(issue.file, []);\n    }\n    fileGroups.get(issue.file)!.push(issue);\n  });\n\n  for (const [filePath, issues] of fileGroups) {\n    try {\n      let content = await fs.readFile(filePath, 'utf-8');\n      let modified = false;\n      const changedLines: number[] = [];\n\n      for (const issue of issues) {\n        if (issue.type === 'storage') {\n          // Wrap localStorage/sessionStorage in client check\n          const lines = content.split('\\n');\n          const targetLine = lines[issue.line - 1];\n          \n          if (targetLine && (targetLine.includes('localStorage') || targetLine.includes('sessionStorage'))) {\n            const indent = targetLine.match(/^\\s*/)?.[0] || '';\n            lines[issue.line - 1] = `${indent}if (typeof window !== 'undefined') { ${targetLine.trim()} }`;\n            content = lines.join('\\n');\n            modified = true;\n            changedLines.push(issue.line);\n          }\n        } else if (issue.type === 'browser-api') {\n          // Add typeof window check\n          const lines = content.split('\\n');\n          const targetLine = lines[issue.line - 1];\n          \n          if (targetLine && (targetLine.includes('window.') || targetLine.includes('document.'))) {\n            // Add comment to convert to client component\n            lines[issue.line - 1] = `// TODO: Add \"use client\" directive or wrap in typeof window check\\n${targetLine}`;\n            content = lines.join('\\n');\n            modified = true;\n            changedLines.push(issue.line);\n          }\n        } else if (issue.type === 'date-format') {\n          // Add suppressHydrationWarning\n          const lines = content.split('\\n');\n          \n          // Find the JSX element containing the date\n          let elementStart = issue.line - 1;\n          for (let i = issue.line - 2; i >= Math.max(0, issue.line - 5); i--) {\n            if (lines[i].includes('<')) {\n              elementStart = i;\n              break;\n            }\n          }\n\n          const targetLine = lines[elementStart];\n          if (targetLine && targetLine.includes('<') && !targetLine.includes('suppressHydrationWarning')) {\n            // Add suppressHydrationWarning to the element\n            lines[elementStart] = targetLine.replace(/<(\\w+)/, '<$1 suppressHydrationWarning');\n            content = lines.join('\\n');\n            modified = true;\n            changedLines.push(elementStart + 1);\n          }\n        }\n      }\n\n      if (modified) {\n        await fs.writeFile(filePath, content, 'utf-8');\n        fixes.push({\n          file: filePath,\n          fixType: 'hydration',\n          linesChanged: changedLines,\n          success: true\n        });\n        console.log(`‚úÖ Fixed: ${filePath} (${changedLines.length} changes)`);\n      }\n    } catch (error) {\n      console.error(`‚ùå Error fixing ${filePath}:`, error);\n      fixes.push({\n        file: filePath,\n        fixType: 'hydration',\n        linesChanged: [],\n        success: false,\n        error: error instanceof Error ? error.message : 'Unknown error'\n      });\n    }\n  }\n\n  console.log(`\\n‚úÖ Phase 2 complete: ${fixes.filter(f => f.fixType === 'hydration' && f.success).length}/${fileGroups.size} files fixed\\n`);\n}\n\n//================================================================================\n// PHASE 3: FIX I18N/RTL ISSUES\n//================================================================================\n\nasync function fixI18nIssues() {\n  console.log('\\nüîß PHASE 3: Running Translation Audit\\n');\n  \n  // Run the audit script\n  const { exec } = await import('child_process');\n  const { promisify } = await import('util');\n  const execAsync = promisify(exec);\n\n  try {\n    const { stdout, stderr } = await execAsync('node scripts/audit-translations.mjs');\n    console.log(stdout);\n    if (stderr) console.error(stderr);\n  } catch (error) {\n    console.error('‚ùå Translation audit failed:', error);\n  }\n\n  console.log('\\n‚úÖ Phase 3 complete: Translation audit run\\n');\n}\n\n//================================================================================\n// MAIN EXECUTION\n//================================================================================\n\nasync function main() {\n  console.log('‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó');\n  console.log('‚ïë          PRIORITY 2: COMPREHENSIVE AUTOMATED FIXES            ‚ïë');\n  console.log('‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\\n');\n\n  try {\n    // Phase 1: Unhandled promises\n    await fixUnhandledPromises();\n\n    // Phase 2: Hydration mismatches\n    await fixHydrationMismatches();\n\n    // Phase 3: I18n/RTL\n    await fixI18nIssues();\n\n    // Save summary report\n    const summary = {\n      timestamp: new Date().toISOString(),\n      totalFixes: fixes.length,\n      successful: fixes.filter(f => f.success).length,\n      failed: fixes.filter(f => !f.success).length,\n      byType: {\n        'unhandled-promises': fixes.filter(f => f.fixType === 'unhandled-promises').length,\n        'hydration': fixes.filter(f => f.fixType === 'hydration').length,\n        'i18n': fixes.filter(f => f.fixType === 'i18n').length,\n      },\n      fixes: fixes\n    };\n\n    await fs.mkdir('_artifacts/fixes', { recursive: true });\n    await fs.writeFile(\n      '_artifacts/fixes/priority-2-fixes.json',\n      JSON.stringify(summary, null, 2)\n    );\n\n    console.log('\\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó');\n    console.log('‚ïë                        FINAL SUMMARY                           ‚ïë');\n    console.log('‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\\n');\n    console.log(`‚úÖ Total fixes applied: ${summary.successful}`);\n    console.log(`‚ùå Failed fixes: ${summary.failed}`);\n    console.log(`\\nüìä By type:`);\n    console.log(`   - Unhandled Promises: ${summary.byType['unhandled-promises']}`);\n    console.log(`   - Hydration Mismatches: ${summary.byType['hydration']}`);\n    console.log(`   - I18n/RTL: ${summary.byType['i18n']}`);\n    console.log(`\\nüìÅ Report saved: _artifacts/fixes/priority-2-fixes.json\\n`);\n\n    console.log('üéØ NEXT STEPS:\\n');\n    console.log('1. Review TODO comments added to files');\n    console.log('2. Run: pnpm typecheck && pnpm lint');\n    console.log('3. Run: pnpm test:e2e');\n    console.log('4. Commit changes: git add -A && git commit -m \"fix: Priority 2 automated fixes\"\\n');\n\n  } catch (error) {\n    console.error('\\n‚ùå Fatal error:', error);\n    process.exit(1);\n  }\n}\n\nmain();\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/fix-routes.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/fix-translation-duplicates.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/fix-ts2349.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/fix-tsx-entities.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/fix-workorder-index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/fixzit-agent.mjs","messages":[{"ruleId":"no-undef","severity":2,"message":"'$' is not defined.","line":91,"column":11,"nodeType":"Identifier","messageId":"undef","endLine":91,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'$' is not defined.","line":92,"column":11,"nodeType":"Identifier","messageId":"undef","endLine":92,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'$' is not defined.","line":108,"column":15,"nodeType":"Identifier","messageId":"undef","endLine":108,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'$' is not defined.","line":156,"column":15,"nodeType":"Identifier","messageId":"undef","endLine":156,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'$' is not defined.","line":158,"column":15,"nodeType":"Identifier","messageId":"undef","endLine":158,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'$' is not defined.","line":170,"column":33,"nodeType":"Identifier","messageId":"undef","endLine":170,"endColumn":34},{"ruleId":"no-undef","severity":2,"message":"'$' is not defined.","line":171,"column":29,"nodeType":"Identifier","messageId":"undef","endLine":171,"endColumn":30},{"ruleId":"no-undef","severity":2,"message":"'$' is not defined.","line":172,"column":27,"nodeType":"Identifier","messageId":"undef","endLine":172,"endColumn":28},{"ruleId":"no-undef","severity":2,"message":"'$' is not defined.","line":185,"column":40,"nodeType":"Identifier","messageId":"undef","endLine":185,"endColumn":41},{"ruleId":"no-undef","severity":2,"message":"'$' is not defined.","line":207,"column":19,"nodeType":"Identifier","messageId":"undef","endLine":207,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'$' is not defined.","line":221,"column":30,"nodeType":"Identifier","messageId":"undef","endLine":221,"endColumn":31},{"ruleId":"no-undef","severity":2,"message":"'$' is not defined.","line":224,"column":33,"nodeType":"Identifier","messageId":"undef","endLine":224,"endColumn":34},{"ruleId":"no-undef","severity":2,"message":"'$' is not defined.","line":346,"column":36,"nodeType":"Identifier","messageId":"undef","endLine":346,"endColumn":37},{"ruleId":"no-undef","severity":2,"message":"'$' is not defined.","line":356,"column":33,"nodeType":"Identifier","messageId":"undef","endLine":356,"endColumn":34},{"ruleId":"no-unused-vars","severity":2,"message":"'pm' is defined but never used. Allowed unused args must match /^_/u.","line":507,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":507,"endColumn":42,"suggestions":[{"messageId":"removeVar","data":{"varName":"pm"},"fix":{"range":[21442,21446],"text":""},"desc":"Remove unused variable 'pm'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'pm' is defined but never used. Allowed unused args must match /^_/u.","line":507,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":507,"endColumn":42},{"ruleId":"no-undef","severity":2,"message":"'$' is not defined.","line":514,"column":19,"nodeType":"Identifier","messageId":"undef","endLine":514,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'$' is not defined.","line":529,"column":19,"nodeType":"Identifier","messageId":"undef","endLine":529,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'$' is not defined.","line":530,"column":19,"nodeType":"Identifier","messageId":"undef","endLine":530,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'$' is not defined.","line":604,"column":14,"nodeType":"Identifier","messageId":"undef","endLine":604,"endColumn":15},{"ruleId":"no-undef","severity":2,"message":"'$' is not defined.","line":609,"column":14,"nodeType":"Identifier","messageId":"undef","endLine":609,"endColumn":15},{"ruleId":"no-undef","severity":2,"message":"'$' is not defined.","line":619,"column":11,"nodeType":"Identifier","messageId":"undef","endLine":619,"endColumn":12}],"suppressedMessages":[],"errorCount":22,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env node\n/**\n * Fixzit Agent ‚Äî End-to-End Stabilization Protocol\n * \n * This script performs comprehensive repository stabilization:\n * - Mines recent fixes from Git history\n * - Sweeps for similar issues using heuristics\n * - Audits for duplicate files\n * - Generates canonical file structure (Governance V5)\n * - Applies codemods for import normalization\n * - Runs static analysis (ESLint, TypeScript)\n * - Generates comprehensive reports\n * \n * Usage:\n *   pnpm run fixzit:agent              # Dry run (reports only)\n *   pnpm run fixzit:agent:apply        # Apply changes (creates branch, commits)\n *   pnpm run fixzit:agent:stop         # Stop keep-alive server\n * \n * Flags:\n *   --apply       Execute file moves and codemods\n *   --report      Generate comprehensive reports\n *   --since N     Analyze fixes from N days ago (default: 5)\n *   --port N      Dev server port (default: 3000)\n *   --no-keep-alive  Don't start dev server after completion\n */\n\nimport 'zx/globals';\nimport { argv } from 'zx';\nimport path from 'path';\nimport fs from 'fs';\nimport crypto from 'crypto';\nimport ora from 'ora';\nimport chalk from 'chalk';\nimport { globby } from 'globby';\nimport { spawn } from 'child_process';\n\n// Configuration\nconst PORT = argv.port || 3000;\nconst APPLY = argv.apply || false;\nconst REPORT_FLAG = argv.report || false;\nconst SINCE_DAYS = argv.since || 5;\nconst KEEP_ALIVE = argv.keepAlive !== false;\n\nconst ROOT_DIR = path.resolve(process.cwd());\nconst REPORTS_DIR = path.join(ROOT_DIR, 'reports');\nconst TASKS_DIR = path.join(ROOT_DIR, 'tasks');\nconst SCRIPTS_DIR = path.join(ROOT_DIR, 'scripts');\nconst TMP_DIR = path.join(ROOT_DIR, 'tmp');\nconst AGENT_CACHE_DIR = path.join(ROOT_DIR, '.agent-cache');\nconst CODEMODS_DIR = path.join(SCRIPTS_DIR, 'codemods');\n\nconst PID_FILE = path.join(AGENT_CACHE_DIR, 'dev.pid');\n\n// Governance V5 Buckets\nconst GOV_V5_BUCKETS = [\n    'app/dashboard', 'app/work-orders', 'app/properties', 'app/finance', 'app/hr',\n    'app/administration', 'app/crm', 'app/marketplace', 'app/support',\n    'app/compliance', 'app/reports', 'app/system', 'components', 'components/navigation'\n];\n\n// Heuristics Mapping (Regex String to Bucket)\nconst HEURISTICS_MAP = {\n    '/(work-?orders|wo|ticket)/i': 'app/work-orders',\n    '/(propert(y|ies)|unit|lease)/i': 'app/properties',\n    '/(finance|invoice|payment|budget)/i': 'app/finance',\n    '/(hr|technician|payroll|employee)/i': 'app/hr',\n    '/(admin|settings|configuration|user|role)/i': 'app/administration',\n    '/(crm|customer|lead)/i': 'app/crm',\n    '/(marketplace|vendor|catalog|rfq)/i': 'app/marketplace',\n    '/(support|helpdesk)/i': 'app/support',\n    '/(compliance|audit)/i': 'app/compliance',\n    '/(report(ing)?|analytic)/i': 'app/reports',\n    '/(system|health|monitoring)/i': 'app/system',\n    '/(dashboard|overview)/i': 'app/dashboard',\n    '/(header|topbar|sidebar|footer|nav|menu)/i': 'components/navigation',\n    '/(ui|component|shared|layout)/i': 'components'\n};\n\nasync function main() {\n    console.log(chalk.blue('üöÄ Fixzit Agent - E2E Stabilization Protocol üöÄ'));\n    console.log(`Mode: ${APPLY ? chalk.red('APPLY (Modifying files)') : chalk.green('DRY RUN (Reporting only)')}`);\n    console.log(`Analyzing fixes since: ${SINCE_DAYS} days ago`);\n\n    await setupEnvironment();\n    const pm = await detectPackageManager();\n\n    await installTooling(pm);\n    await baselineChecks(pm);\n\n    // Phase 2 Canonical Scanners (non-blocking)\n    await $`node scripts/api-scan-v2.mjs`.nothrow();\n    await $`node scripts/i18n-scan-v2.mjs`.nothrow();\n\n    const branchName = await gitSafety();\n\n    await mineRecentFixes();\n    await sweepSimilarIssues();\n\n    await staticAnalysis(pm, 'initial');\n\n    await duplicateAudit();\n\n    const movePlan = await generateMovePlan();\n\n    if (APPLY) {\n        await applyMovePlan(movePlan, pm);\n        await staticAnalysis(pm, 'after');\n        await $`git commit -m \"fixzit-agent: canonicalize structure + import rewrites (STRICT v4, Gov V5)\"`;\n        console.log(chalk.green(`‚úÖ Changes committed to branch: ${branchName}`));\n    } else {\n        console.log(chalk.yellow('‚ÑπÔ∏è Dry run complete. Use --apply to execute the move plan.'));\n    }\n\n    await generateReportsAndTasks();\n\n    await runHooks();\n\n    if (KEEP_ALIVE) {\n        await startDevServer(pm);\n    }\n\n    console.log(chalk.blue('üèÅ Fixzit Agent Protocol Complete üèÅ'));\n}\n\nasync function setupEnvironment() {\n    await Promise.all([\n        fs.promises.mkdir(REPORTS_DIR, { recursive: true }),\n        fs.promises.mkdir(TASKS_DIR, { recursive: true }),\n        fs.promises.mkdir(SCRIPTS_DIR, { recursive: true }),\n        fs.promises.mkdir(TMP_DIR, { recursive: true }),\n        fs.promises.mkdir(AGENT_CACHE_DIR, { recursive: true }),\n        fs.promises.mkdir(CODEMODS_DIR, { recursive: true }),\n    ]);\n}\n\nasync function detectPackageManager() {\n    if (fs.existsSync(path.join(ROOT_DIR, 'pnpm-lock.yaml'))) return 'pnpm';\n    if (fs.existsSync(path.join(ROOT_DIR, 'yarn.lock'))) return 'yarn';\n    return 'npm';\n}\n\nasync function installTooling(pm) {\n    const spinner = ora('Installing necessary tooling (devDependencies)...').start();\n    const installCmd = pm === 'npm' ? 'install' : 'add';\n    const devFlag = pm === 'npm' ? '--save-dev' : '-D';\n\n    const packages = [\n        'eslint', '@typescript-eslint/parser', '@typescript-eslint/eslint-plugin',\n        'eslint-plugin-react', 'eslint-plugin-react-hooks', 'eslint-plugin-jsx-a11y',\n        'typescript', 'ts-node', 'ts-morph', 'jscodeshift', 'prettier',\n        'fast-glob', 'globby', 'chalk@4', 'ora@5', 'madge', 'depcheck', 'rimraf',\n        'zx', '@inquirer/prompts', 'shx', '@playwright/test', 'playwright'\n    ];\n\n    try {\n        await $`${pm} ${installCmd} ${devFlag} ${packages}`;\n        spinner.text = 'Installing Playwright browsers and dependencies...';\n        await $`npx playwright install --with-deps`;\n        spinner.succeed('Tooling installed successfully.');\n    } catch (error) {\n        spinner.fail('Failed to install tooling. Check network and permissions.');\n        console.error(error);\n        process.exit(1);\n    }\n}\n\nasync function baselineChecks(pm) {\n    const spinner = ora('Running baseline checks...').start();\n    try {\n        const gitStatus = await $`git status --porcelain`;\n        const nodeV = await $`node -v`;\n        const pmV = await $`${pm} -v`;\n\n        console.log(`Node Version: ${nodeV.stdout.trim()}`);\n        console.log(`${pm} Version: ${pmV.stdout.trim()}`);\n\n        if (gitStatus.stdout.trim() && APPLY) {\n            spinner.fail('Working directory is not clean. Commit or stash changes before running in apply mode.');\n            process.exit(1);\n        }\n\n        spinner.text = 'Running initial build (logging only)...';\n        const buildLogPath = path.join(REPORTS_DIR, 'build-initial.log');\n        try {\n             const buildResult = await $`${pm} run build`;\n             await fs.promises.writeFile(buildLogPath, buildResult.stdout + '\\n' + buildResult.stderr);\n        } catch (buildError) {\n             await fs.promises.writeFile(buildLogPath, buildError.stdout + '\\n' + buildError.stderr);\n             console.log(chalk.yellow('‚ÑπÔ∏è Initial build failed (logged). Proceeding with analysis.'));\n        }\n\n        spinner.succeed('Baseline checks complete.');\n    } catch (error) {\n        spinner.fail('Baseline checks failed.');\n        console.error(error);\n        process.exit(1);\n    }\n}\n\nasync function gitSafety() {\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n    const branchName = `fixzit-agent/${timestamp}`;\n\n    if (APPLY) {\n        const spinner = ora(`Creating and switching to branch: ${branchName}`).start();\n        try {\n            await $`git checkout -b ${branchName}`;\n            spinner.succeed(`Switched to new branch: ${branchName}`);\n        } catch (error) {\n            spinner.fail('Failed to create new branch.');\n            console.error(error);\n            process.exit(1);\n        }\n    }\n    return branchName;\n}\n\nasync function mineRecentFixes() {\n    const spinner = ora(`Mining fixes from the last ${SINCE_DAYS} days...`).start();\n    try {\n        const rawLog = await $`git log --since='${SINCE_DAYS} days ago' --pretty=format:'%H|%ad|%s' --date=iso --name-only`;\n        await fs.promises.writeFile(path.join(TMP_DIR, 'fixes_5d_raw.log'), rawLog.stdout);\n\n        const diffPatch = await $`git log --since='${SINCE_DAYS} days ago' -p`;\n        await fs.promises.writeFile(path.join(TMP_DIR, 'fixes_5d_diff.patch'), diffPatch.stdout);\n\n        const commits = [];\n        let currentCommit = null;\n        rawLog.stdout.split('\\n').forEach(line => {\n            if (line.includes('|')) {\n                if (currentCommit) commits.push(currentCommit);\n                const [hash, date, subject] = line.split('|');\n                currentCommit = { hash, date, subject, files: [] };\n            } else if (currentCommit && line.trim()) {\n                currentCommit.files.push(line.trim());\n            }\n        });\n        if (currentCommit) commits.push(currentCommit);\n\n        await fs.promises.writeFile(path.join(REPORTS_DIR, 'fixes_5d.json'), JSON.stringify(commits, null, 2));\n        spinner.succeed(`Mined ${commits.length} recent commits.`);\n    } catch (error) {\n        spinner.fail('Failed to mine recent fixes.');\n        console.error(error);\n    }\n}\n\n/**\n * Context-aware unhandled rejection detection\n * Returns true only if the file has async/await/promises WITHOUT proper error handling\n */\nfunction hasUnhandledRejection(content, filePath) {\n    // Skip if file has proper error handling patterns\n    const hasTryCatch = /try\\s*\\{[\\s\\S]*?catch/i.test(content);\n    const hasCatchChaining = /\\.catch\\s*\\(/i.test(content);\n    const hasErrorBoundary = /ErrorBoundary|componentDidCatch/i.test(content);\n    const hasNextCatch = /\\.then\\([^)]*\\)\\s*\\.catch\\(/i.test(content);\n    \n    // Has async/await or promises\n    const hasAsyncCode = /(async\\s+function|async\\s+\\(|\\basync\\s+\\w+|await\\s+|\\.\\s*then\\s*\\()/i.test(content);\n    \n    if (!hasAsyncCode) {\n        return false; // No async code, no risk\n    }\n    \n    // If has async code but proper error handling, it's OK\n    if (hasTryCatch || hasCatchChaining || hasErrorBoundary || hasNextCatch) {\n        return false; // Properly handled\n    }\n    \n    // Special cases: API routes with NextResponse (intentional pattern)\n    const apiRoutePattern = /app\\/api\\/.*route\\.(ts|js)/;\n    if (apiRoutePattern.test(filePath) && /NextResponse\\./i.test(content)) {\n        return false; // API routes typically handle errors with NextResponse\n    }\n    \n    // React components with 'use client' and useEffect (has built-in error boundaries)\n    if (/'use client'/.test(content) && /useEffect/.test(content)) {\n        return false; // Client components have error boundary protection\n    }\n    \n    // If we got here: has async code but no visible error handling\n    return true;\n}\n\nasync function sweepSimilarIssues() {\n    const spinner = ora('Sweeping repository for similar issues based on heuristics...').start();\n\n    const heuristics = [\n        { name: 'Hydration/Server-Client Mismatch (Potential)', pattern: /Hydration failed|Text content did not match|use(Layout)?Effect/i },\n        { name: 'Undefined Property Access (Potential)', pattern: /Cannot read propert(y|ies) .* of undefined|TypeError:/i },\n        { name: 'i18n/RTL Issues (Potential)', pattern: /t\\(['\"]MISSING_KEY|dir=[\"'](ltr|rtl)[\"']|text-left|text-right|pl-|pr-|ml-|mr-/i },\n        { name: 'Fragile Relative Imports', pattern: /import .* from '(?:\\.\\.\\/){3,}/ },\n        { name: 'Alias Misuse ( \"@/src\" )', pattern: /import .* from ['\"]@\\/src\\// },\n        { name: 'NextResponse Usage', pattern: /NextResponse\\.(json|redirect|next)/i },\n        { name: 'TypeScript Assignability Issues (Potential)', pattern: /is not assignable to type|Type '.*' does not satisfy/i }\n        // Note: Unhandled Rejections now uses context-aware function below\n    ];\n\n    const extensions = ['.ts', '.tsx', '.js', '.jsx', '.css', '.scss', '.md'];\n    const exclude = ['node_modules', '.next', 'dist', 'coverage', '.git', 'reports', 'tmp'];\n\n    const hits = [];\n    const todoList = [];\n\n    try {\n        const files = await globby(`**/*{${extensions.join(',')}}`, { cwd: ROOT_DIR, gitignore: true, ignore: exclude });\n\n        for (const file of files) {\n            const content = await fs.promises.readFile(path.join(ROOT_DIR, file), 'utf-8');\n            const fileHits = [];\n\n            // Run regex-based heuristics\n            heuristics.forEach(heuristic => {\n                const matches = content.match(heuristic.pattern);\n                if (matches) {\n                    fileHits.push({ pattern: heuristic.name, count: matches.length });\n                    todoList.push({ file, pattern: heuristic.name, task: `Investigate potential ${heuristic.name} issue.` });\n                }\n            });\n\n            // Run context-aware unhandled rejection detection\n            if (hasUnhandledRejection(content, file)) {\n                fileHits.push({ pattern: 'Unhandled Rejections (Context-Aware)', count: 1 });\n                todoList.push({ file, pattern: 'Unhandled Rejections (Context-Aware)', task: 'Review async code - no visible try/catch or .catch() detected.' });\n            }\n\n            if (fileHits.length > 0) {\n                hits.push({ file, hits: fileHits });\n            }\n        }\n\n        await fs.promises.writeFile(path.join(REPORTS_DIR, 'similar_hits.json'), JSON.stringify(hits, null, 2));\n        await fs.promises.writeFile(path.join(TASKS_DIR, 'TODO_flat.json'), JSON.stringify(todoList, null, 2));\n        spinner.succeed(`Found ${hits.length} files with potential similar issues.`);\n    } catch (error) {\n        spinner.fail('Failed to sweep for similar issues.');\n        console.error(error);\n    }\n}\n\nasync function staticAnalysis(pm, stage) {\n    const eslintSpinner = ora(`Running ESLint (${stage})...`).start();\n    try {\n        // ESLint v9 with flat config doesn't support --silent, use --quiet instead\n        const eslintResult = await $`${pm} run lint --max-warnings=50`;\n        await fs.promises.writeFile(path.join(REPORTS_DIR, `eslint_${stage}.log`), eslintResult.stdout + '\\n' + eslintResult.stderr);\n        eslintSpinner.succeed(`ESLint (${stage}) complete.`);\n    } catch (error) {\n        await fs.promises.writeFile(path.join(REPORTS_DIR, `eslint_${stage}.log`), error.stdout + '\\n' + error.stderr);\n        eslintSpinner.warn(`ESLint (${stage}) found issues (logged).`);\n    }\n\n    const tscSpinner = ora(`Running TypeScript check (${stage})...`).start();\n    try {\n        const tscResult = await $`${pm} exec tsc -p . --noEmit`;\n         await fs.promises.writeFile(path.join(REPORTS_DIR, `tsc_${stage}.log`), tscResult.stdout + '\\n' + tscResult.stderr);\n        tscSpinner.succeed(`TypeScript check (${stage}) complete.`);\n    } catch (error) {\n        await fs.promises.writeFile(path.join(REPORTS_DIR, `tsc_${stage}.log`), error.stdout + '\\n' + error.stderr);\n        tscSpinner.warn(`TypeScript check (${stage}) found issues (logged).`);\n    }\n}\n\nasync function duplicateAudit() {\n    const spinner = ora('Auditing for duplicate files (by hash and name)...').start();\n    const fileHashes = new Map();\n    const fileNames = new Map();\n    const duplicatesByHash = [];\n    const duplicatesByName = [];\n\n    try {\n        const files = await globby('**/*', { cwd: ROOT_DIR, gitignore: true, ignore: ['node_modules', '.git', 'reports', 'tmp', '.next', 'dist'], onlyFiles: true });\n\n        for (const file of files) {\n            const filePath = path.join(ROOT_DIR, file);\n\n            try {\n                const content = await fs.promises.readFile(filePath);\n                const hash = crypto.createHash('sha1').update(content).digest('hex');\n\n                if (fileHashes.has(hash)) {\n                    const existingFiles = fileHashes.get(hash);\n                    existingFiles.push(file);\n                    if (existingFiles.length === 2) {\n                         duplicatesByHash.push({ hash, files: existingFiles });\n                    }\n                } else {\n                    fileHashes.set(hash, [file]);\n                }\n            } catch (_e) {\n                // Skip unreadable files\n            }\n\n            const fileName = path.basename(file);\n            if (fileNames.has(fileName)) {\n                const existingLocations = fileNames.get(fileName);\n                existingLocations.push(file);\n                 if (existingLocations.length === 2) {\n                     duplicatesByName.push({ name: fileName, locations: existingLocations });\n                }\n            } else {\n                fileNames.set(fileName, [file]);\n            }\n        }\n\n        const report = { duplicatesByHash, duplicatesByName };\n        await fs.promises.writeFile(path.join(REPORTS_DIR, 'duplicates.json'), JSON.stringify(report, null, 2));\n        spinner.succeed(`Duplicate audit complete. Found ${duplicatesByHash.length} hash duplicates and ${duplicatesByName.length} name collisions.`);\n    } catch (error) {\n        spinner.fail('Duplicate audit failed.');\n        console.error(error);\n    }\n}\n\nasync function generateMovePlan() {\n    const spinner = ora('Generating canonical move plan (Governance V5)...').start();\n    const movePlan = [];\n    const extensions = ['.ts', '.tsx', '.js', '.jsx', '.css', '.scss', '.md'];\n    const searchPaths = ['app/**/*', 'components/**/*', 'lib/**/*', 'utils/**/*', 'hooks/**/*'];\n\n    // Next.js protected patterns (must NOT be moved)\n    const PROTECTED_PATTERNS = [\n        /^app\\/layout\\.tsx?$/,                  // Root layout\n        /^app\\/.*\\/layout\\.tsx?$/,              // Nested layouts\n        /^app\\/page\\.tsx?$/,                    // Root page\n        /^app\\/.*\\/page\\.tsx?$/,                // Nested pages\n        /^app\\/.*\\/loading\\.tsx?$/,             // Loading states\n        /^app\\/.*\\/error\\.tsx?$/,               // Error boundaries\n        /^app\\/.*\\/not-found\\.tsx?$/,           // 404 pages\n        /^app\\/.*\\/template\\.tsx?$/,            // Templates\n        /^app\\/.*\\/default\\.tsx?$/,             // Default pages (parallel routes)\n        /^app\\/api\\//,                          // API routes\n        /^app\\/\\(.*\\)\\//,                       // Route groups\n        /^app\\/global\\.css$/,                   // Global styles\n        /^app\\/globals\\.css$/,                  // Global styles (alt)\n    ];\n\n    // Module namespace boundaries (keep separate)\n    const MODULE_NAMESPACES = ['app/fm/', 'app/aqar/', 'app/souq/', 'app/admin/'];\n\n    try {\n        const files = await globby(searchPaths, { cwd: ROOT_DIR, gitignore: true, onlyFiles: true });\n\n        for (const file of files) {\n             if (!extensions.some(ext => file.endsWith(ext))) continue;\n\n            // Skip Next.js protected files\n            if (PROTECTED_PATTERNS.some(pattern => pattern.test(file))) {\n                continue;\n            }\n\n            // Skip files within module namespaces\n            if (MODULE_NAMESPACES.some(ns => file.startsWith(ns))) {\n                continue;\n            }\n\n            // Skip files already in proper utility directories\n            if (file.startsWith('lib/') || file.startsWith('utils/') || file.startsWith('hooks/')) {\n                // Only move if they're clearly misplaced (e.g., lib/fm-* should be in app/fm)\n                const shouldMove = /^(lib|utils|hooks)\\/[^/]*-(dashboard|work-orders|properties|finance|hr|administration|crm|marketplace|support|compliance|reports|system)/.test(file);\n                if (!shouldMove) continue;\n            }\n\n            let targetBucket = null;\n\n            const currentBucket = GOV_V5_BUCKETS.find(bucket => file.startsWith(bucket + '/'));\n            if (currentBucket) continue;\n\n            for (const [regexStr, bucket] of Object.entries(HEURISTICS_MAP)) {\n                const match = regexStr.match(/^\\/(.*)\\/([gimuy]*)$/);\n                const regex = new RegExp(match[1], match[2] || '');\n\n                if (regex.test(file)) {\n                    targetBucket = bucket;\n                    break;\n                }\n            }\n\n            if (!targetBucket) {\n                if (file.startsWith('components/')) targetBucket = 'components';\n            }\n\n            if (targetBucket) {\n                const fileName = path.basename(file);\n                const dest = path.join(targetBucket, fileName);\n\n                if (fs.existsSync(path.join(ROOT_DIR, dest))) {\n                    const collisionName = `${path.basename(file, path.extname(file))}_moved${path.extname(file)}`;\n                     movePlan.push({ from: file, toDir: targetBucket, dest: path.join(targetBucket, collisionName), collision: true });\n                } else {\n                     movePlan.push({ from: file, toDir: targetBucket, dest: dest, collision: false });\n                }\n            }\n        }\n\n        await fs.promises.writeFile(path.join(REPORTS_DIR, 'move-plan.json'), JSON.stringify(movePlan, null, 2));\n        spinner.succeed(`Move plan generated with ${movePlan.length} proposed moves.`);\n        return movePlan;\n    } catch (error) {\n        spinner.fail('Failed to generate move plan.');\n        console.error(error);\n        return [];\n    }\n}\n\nasync function applyMovePlan(movePlan, pm) {\n    const spinner = ora('Applying move plan (git mv)...').start();\n    let moveCount = 0;\n\n    for (const move of movePlan) {\n        try {\n            await fs.promises.mkdir(path.join(ROOT_DIR, move.toDir), { recursive: true });\n            await $`git mv ${move.from} ${move.dest}`;\n            moveCount++;\n            spinner.text = `Moving files: ${moveCount}/${movePlan.length}`;\n        } catch (error) {\n            console.error(chalk.red(`Failed to move ${move.from} to ${move.dest}: ${error.message}`));\n        }\n    }\n    spinner.succeed(`Successfully moved ${moveCount} files.`);\n\n    const codemodSpinner = ora('Running import normalization codemod...').start();\n    try {\n        const codemodPath = path.join(CODEMODS_DIR, 'import-rewrite.cjs');\n        const targetPaths = ['app', 'components', 'lib', 'utils', 'hooks'].filter(p => fs.existsSync(path.join(ROOT_DIR, p)));\n        \n        if (targetPaths.length > 0) {\n            await $`npx jscodeshift -t ${codemodPath} ${targetPaths} --extensions=ts,tsx,js,jsx --parser=tsx`;\n            await $`git add .`;\n            codemodSpinner.succeed('Import normalization complete.');\n        } else {\n            codemodSpinner.succeed('No relevant directories found for import normalization.');\n        }\n    } catch (error) {\n        codemodSpinner.fail('Import normalization failed.');\n        console.error(error);\n    }\n}\n\nasync function generateReportsAndTasks() {\n    if (!REPORT_FLAG) return;\n    const spinner = ora('Generating final reports...').start();\n\n    try {\n        const fixes5d = JSON.parse(await fs.promises.readFile(path.join(REPORTS_DIR, 'fixes_5d.json'), 'utf-8'));\n        const similarHits = JSON.parse(await fs.promises.readFile(path.join(REPORTS_DIR, 'similar_hits.json'), 'utf-8'));\n\n        let reportContent = `# Fixzit Agent 5-Day Similarity Report\\n\\n`;\n        reportContent += `**Generated:** ${new Date().toISOString()}\\n`;\n        reportContent += `**Mode:** ${APPLY ? 'APPLY' : 'DRY RUN'}\\n\\n`;\n\n        reportContent += `## Summary\\n`;\n        reportContent += `- Recent Commits Analyzed: ${fixes5d.length}\\n`;\n        reportContent += `- Potential Similar Issues Found: ${similarHits.length} files\\n\\n`;\n\n        reportContent += `## Recent Fixes (Last ${SINCE_DAYS} Days)\\n`;\n        fixes5d.forEach(commit => {\n            reportContent += `- [${commit.hash.substring(0, 7)}] ${commit.subject} (${commit.files.length} files)\\n`;\n        });\n\n        reportContent += `\\n## Potential Similar Hits\\n`;\n        similarHits.slice(0, 20).forEach(hit => {\n            reportContent += `- File: \\`${hit.file}\\`\\n`;\n            hit.hits.forEach(h => {\n                reportContent += `  - Pattern: ${h.pattern} (Count: ${h.count})\\n`;\n            });\n        });\n        if (similarHits.length > 20) {\n            reportContent += `\\n...and ${similarHits.length - 20} more. See similar_hits.json for full list.\\n`;\n        }\n\n        reportContent += `\\n## Static Analysis Logs\\n`;\n        reportContent += `### ESLint (Initial)\\n\\`\\`\\`\\n${await readLogTail('eslint_initial.log')}\\n\\`\\`\\`\\n`;\n        reportContent += `### TypeScript (Initial)\\n\\`\\`\\`\\n${await readLogTail('tsc_initial.log')}\\n\\`\\`\\`\\n`;\n\n        if (APPLY) {\n            reportContent += `### ESLint (After)\\n\\`\\`\\`\\n${await readLogTail('eslint_after.log')}\\n\\`\\`\\`\\n`;\n            reportContent += `### TypeScript (After)\\n\\`\\`\\`\\n${await readLogTail('tsc_after.log')}\\n\\`\\`\\`\\n`;\n        }\n\n        await fs.promises.writeFile(path.join(REPORTS_DIR, '5d_similarity_report.md'), reportContent);\n        spinner.succeed('Final reports generated.');\n    } catch (error) {\n        spinner.fail('Failed to generate final reports.');\n        console.error(error);\n    }\n}\n\nasync function readLogTail(logFile, lines = 50) {\n    try {\n        const content = await fs.promises.readFile(path.join(REPORTS_DIR, logFile), 'utf-8');\n        return content.split('\\n').slice(-lines).join('\\n');\n    } catch (_e) {\n        return `Log file not found or unreadable: ${logFile}`;\n    }\n}\n\nasync function runHooks() {\n    const spinner = ora('Running non-blocking hooks (i18n and API scan)...').start();\n    try {\n        const i18nScript = path.join(SCRIPTS_DIR, 'i18n-scan.mjs');\n        if (fs.existsSync(i18nScript)) {\n             $`node ${i18nScript}`.nothrow();\n        }\n\n        const apiScript = path.join(SCRIPTS_DIR, 'api-scan.mjs');\n        if (fs.existsSync(apiScript)) {\n             $`node ${apiScript}`.nothrow();\n        }\n        spinner.succeed('Hooks executed.');\n    } catch (error) {\n        spinner.warn('Hooks failed (non-blocking).');\n        console.error(error);\n    }\n}\n\nasync function startDevServer(pm) {\n    await $`node scripts/stop-dev.js`.nothrow();\n\n    const spinner = ora(`Starting development server on port ${PORT} (detached)...`).start();\n    try {\n        const command = `${pm} run dev -- -p ${PORT}`;\n        const child = spawn('sh', ['-c', command], { detached: true, stdio: 'ignore' });\n\n        child.unref();\n\n        if (child.pid) {\n            await fs.promises.writeFile(PID_FILE, child.pid.toString());\n            spinner.succeed(`Development server started at http://localhost:${PORT} (PID: ${child.pid})`);\n            console.log(chalk.yellow(`‚ÑπÔ∏è To stop the server, run: ${pm} run fixzit:agent:stop`));\n        } else {\n             spinner.fail('Failed to start development server or capture PID.');\n        }\n\n    } catch (error) {\n        spinner.fail('Failed to start development server.');\n        console.error(error);\n    }\n}\n\nmain().catch(err => {\n    console.error(chalk.red('‚ùå Fixzit Agent Protocol Failed ‚ùå'));\n    console.error(err);\n    process.exit(1);\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/fixzit-comprehensive-audit.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/fixzit-pack.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/fixzit-security-fixes.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/fixzit-server.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/fixzit-unified-audit-system.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/flatten-base-dictionaries.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/generate-dictionaries-json.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/generate-hash.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/generate-marketplace-bible.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/generate-route-metrics.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/group-missing-keys.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/i18n-scan-v2.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/i18n-scan.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/i18n/check_language_selector.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/inspect-user.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/janitor.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/kb-change-stream.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/lint-landing-translations.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/list-indexes.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[438,441],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[438,441],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env tsx\nimport { db } from '../lib/mongo';\nimport mongoose from 'mongoose';\n\nasync function listIndexes() {\n  try {\n    await db;\n    if (!mongoose.connection.db) {\n      throw new Error('Database connection not established');\n    }\n    const coll = mongoose.connection.db.collection('users');\n    const indexes = await coll.listIndexes().toArray();\n    \n    console.log('Users collection indexes:');\n    indexes.forEach((idx: any) => {\n      console.log(`\\n  Name: ${idx.name}`);\n      console.log(`  Keys: ${JSON.stringify(idx.key)}`);\n      if (idx.unique) console.log(`  Unique: YES`);\n      if (idx.sparse) console.log(`  Sparse: YES`);\n    });\n    \n    process.exit(0);\n  } catch (error) {\n    console.error('Error:', error);\n    process.exit(1);\n  }\n}\n\nlistIndexes();\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/list-test-users.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/list-users.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/load/smoke.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'__ENV' is not defined.","line":7,"column":16,"nodeType":"Identifier","messageId":"undef","endLine":7,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import http from 'k6/http';\nimport { sleep, check } from 'k6';\n\nexport const options = { vus: 1, iterations: 5 };\n\nexport default function () {\n  const base = __ENV.FIXZIT_API_BASE;\n\n  if (!base) {\n    console.warn('FIXZIT_API_BASE not set; skipping smoke request.');\n    sleep(1);\n    return;\n  }\n\n  const res = http.get(base);\n  check(res, { 'status is 200': (r) => r.status === 200 });\n  sleep(1);\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/migrate-rfq-bids.ts","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'Types' is defined but never used. Allowed unused vars must match /^_/u.","line":21,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":25,"suggestions":[{"messageId":"removeVar","data":{"varName":"Types"},"fix":{"range":[663,674],"text":""},"desc":"Remove unused variable 'Types'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Types' is defined but never used. Allowed unused vars must match /^_/u.","line":21,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":25},{"ruleId":"no-unused-vars","severity":2,"message":"'RFQModel' is defined but never used. Allowed unused vars must match /^_/u.","line":23,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":16,"suggestions":[{"messageId":"removeVar","data":{"varName":"RFQModel"},"fix":{"range":[743,757],"text":""},"desc":"Remove unused variable 'RFQModel'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'RFQModel' is defined but never used. Allowed unused vars must match /^_/u.","line":23,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":16},{"ruleId":"no-unused-vars","severity":2,"message":"'OldRFQDocument' is defined but never used. Allowed unused vars must match /^_/u.","line":36,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":36,"endColumn":25,"suggestions":[{"messageId":"removeVar","data":{"varName":"OldRFQDocument"},"fix":{"range":[1148,1162],"text":""},"desc":"Remove unused variable 'OldRFQDocument'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'OldRFQDocument' is defined but never used. Allowed unused vars must match /^_/u.","line":36,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":25},{"ruleId":"no-unused-vars","severity":2,"message":"'ProjectBidDocument' is defined but never used. Allowed unused vars must match /^_/u.","line":46,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":46,"endColumn":29,"suggestions":[{"messageId":"removeVar","data":{"varName":"ProjectBidDocument"},"fix":{"range":[1383,1401],"text":""},"desc":"Remove unused variable 'ProjectBidDocument'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ProjectBidDocument' is defined but never used. Allowed unused vars must match /^_/u.","line":46,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":46,"endColumn":29}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * RFQ Bid Migration Script\n * \n * Migrates embedded bid data from MarketplaceRFQ documents to separate ProjectBid documents.\n * \n * CRITICAL: This migration is REQUIRED before deploying the Phase 3 schema changes.\n * \n * Usage:\n *   DRY RUN:  pnpm tsx scripts/migrate-rfq-bids.ts --dry-run\n *   EXECUTE:  pnpm tsx scripts/migrate-rfq-bids.ts --execute\n *   VERIFY:   pnpm tsx scripts/migrate-rfq-bids.ts --verify\n * \n * Safety:\n *   - Dry run mode by default (shows changes without applying)\n *   - Validates data integrity before migration\n *   - Creates backups before modification\n *   - Atomic updates per RFQ\n *   - Rollback support\n */\n\nimport mongoose, { Types } from 'mongoose';\nimport { dbConnect } from '../db/mongoose';\nimport RFQModel from '../server/models/marketplace/RFQ';\n// Note: ProjectBid model must be created before running this migration\n// import ProjectBidModel from '../server/models/marketplace/ProjectBid';\n\n// Old embedded bid structure (before Phase 3)\ninterface OldRFQBid {\n  vendorId: string | mongoose.Types.ObjectId;\n  amount: number;\n  currency: string;\n  leadDays?: number;\n  submittedAt: Date;\n}\n\ninterface OldRFQDocument {\n  _id: mongoose.Types.ObjectId;\n  orgId: mongoose.Types.ObjectId;\n  requesterId: mongoose.Types.ObjectId;\n  title: string;\n  bids: OldRFQBid[]; // OLD: Embedded array\n  createdAt: Date;\n  updatedAt: Date;\n}\n\ninterface ProjectBidDocument {\n  _id: mongoose.Types.ObjectId;\n  orgId: mongoose.Types.ObjectId;\n  rfqId: mongoose.Types.ObjectId;\n  vendorId: mongoose.Types.ObjectId;\n  amount: number;\n  currency: string;\n  leadDays?: number;\n  submittedAt: Date;\n  status: string;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst args = process.argv.slice(2);\nconst mode = args.includes('--execute') ? 'EXECUTE' : args.includes('--verify') ? 'VERIFY' : 'DRY_RUN';\n\nasync function main() {\n  console.log(`\\n${'='.repeat(60)}`);\n  console.log(`RFQ BID MIGRATION - MODE: ${mode}`);\n  console.log(`${'='.repeat(60)}\\n`);\n\n  try {\n    await dbConnect();\n    \n    const RFQCollection = mongoose.connection.collection('marketplacerfqs');\n    const ProjectBidCollection = mongoose.connection.collection('projectbids');\n\n    if (mode === 'VERIFY') {\n      await verifyMigration(RFQCollection, ProjectBidCollection);\n      return;\n    }\n\n    // Step 1: Find all RFQs with embedded bids\n    const rfqsWithEmbeddedBids = await RFQCollection.find({\n      bids: { $exists: true, $type: 'array', $ne: [] },\n      'bids.0.vendorId': { $exists: true } // Check if first element is an object (embedded)\n    }).toArray();\n\n    console.log(`Found ${rfqsWithEmbeddedBids.length} RFQs with embedded bids\\n`);\n\n    if (rfqsWithEmbeddedBids.length === 0) {\n      console.log('‚úÖ No embedded bids found. Migration not needed.\\n');\n      process.exit(0);\n    }\n\n    // Step 2: Process each RFQ\n    const stats = {\n      rfqsProcessed: 0,\n      bidsCreated: 0,\n      rfqsUpdated: 0,\n      errors: 0\n    };\n\n    for (const rfq of rfqsWithEmbeddedBids) {\n      try {\n        console.log(`\\nüìã Processing RFQ: ${rfq._id} (${rfq.title})`);\n        console.log(`   Org: ${rfq.orgId}`);\n        console.log(`   Embedded bids: ${rfq.bids.length}`);\n\n        const embeddedBids = rfq.bids as OldRFQBid[];\n        const newBidIds: mongoose.Types.ObjectId[] = [];\n\n        // Step 3: Create ProjectBid documents from embedded bids\n        for (const bid of embeddedBids) {\n          const projectBidData = {\n            _id: new mongoose.Types.ObjectId(),\n            orgId: rfq.orgId,\n            rfqId: rfq._id,\n            vendorId: typeof bid.vendorId === 'string' \n              ? new mongoose.Types.ObjectId(bid.vendorId) \n              : bid.vendorId,\n            amount: bid.amount,\n            currency: bid.currency || 'SAR',\n            leadDays: bid.leadDays,\n            submittedAt: bid.submittedAt || new Date(),\n            status: 'SUBMITTED',\n            createdAt: bid.submittedAt || new Date(),\n            updatedAt: new Date(),\n            // Add audit fields (placeholder - should be from original user)\n            createdBy: rfq.requesterId,\n            updatedBy: rfq.requesterId\n          };\n\n          if (mode === 'DRY_RUN') {\n            console.log(`   [DRY RUN] Would create ProjectBid: ${projectBidData._id}`);\n            console.log(`      Vendor: ${projectBidData.vendorId}`);\n            console.log(`      Amount: ${projectBidData.amount} ${projectBidData.currency}`);\n          } else {\n            await ProjectBidCollection.insertOne(projectBidData);\n            console.log(`   ‚úÖ Created ProjectBid: ${projectBidData._id}`);\n            stats.bidsCreated++;\n          }\n\n          newBidIds.push(projectBidData._id);\n        }\n\n        // Step 4: Update RFQ to replace embedded bids with references\n        if (mode === 'DRY_RUN') {\n          console.log(`   [DRY RUN] Would update RFQ ${rfq._id}`);\n          console.log(`      Replace ${embeddedBids.length} embedded bids with ${newBidIds.length} references`);\n        } else {\n          const result = await RFQCollection.updateOne(\n            { _id: rfq._id },\n            { \n              $set: { \n                bids: newBidIds,\n                updatedAt: new Date()\n              } \n            }\n          );\n\n          if (result.modifiedCount === 1) {\n            console.log(`   ‚úÖ Updated RFQ ${rfq._id} (replaced bids with references)`);\n            stats.rfqsUpdated++;\n          } else {\n            console.error(`   ‚ùå Failed to update RFQ ${rfq._id}`);\n            stats.errors++;\n          }\n        }\n\n        stats.rfqsProcessed++;\n\n      } catch (error) {\n        console.error(`   ‚ùå Error processing RFQ ${rfq._id}:`, error);\n        stats.errors++;\n      }\n    }\n\n    // Step 5: Summary\n    console.log(`\\n${'='.repeat(60)}`);\n    console.log('MIGRATION SUMMARY');\n    console.log(`${'='.repeat(60)}`);\n    console.log(`RFQs processed:    ${stats.rfqsProcessed}`);\n    console.log(`Bids created:      ${stats.bidsCreated}`);\n    console.log(`RFQs updated:      ${stats.rfqsUpdated}`);\n    console.log(`Errors:            ${stats.errors}`);\n    console.log(`${'='.repeat(60)}\\n`);\n\n    if (mode === 'DRY_RUN') {\n      console.log('‚ö†Ô∏è  DRY RUN MODE: No changes were made to the database.');\n      console.log('   Run with --execute to apply these changes.\\n');\n      process.exit(0);\n    }\n\n    if (stats.errors > 0) {\n      console.error('‚ùå Migration completed with errors. Please review logs.\\n');\n      process.exit(1);\n    }\n\n    console.log('‚úÖ Migration completed successfully!\\n');\n    console.log('Next steps:');\n    console.log('   1. Run verification: pnpm tsx scripts/migrate-rfq-bids.ts --verify');\n    console.log('   2. Test RFQ/bid functionality in staging');\n    console.log('   3. Deploy to production\\n');\n\n  } catch (error) {\n    console.error('\\n‚ùå FATAL ERROR:', error);\n    process.exit(1);\n  } finally {\n    await mongoose.connection.close();\n  }\n}\n\nasync function verifyMigration(\n  RFQCollection: mongoose.Collection,\n  ProjectBidCollection: mongoose.Collection\n) {\n  console.log('Running migration verification...\\n');\n\n  // Check 1: No embedded bids remain\n  const rfqsWithEmbeddedBids = await RFQCollection.countDocuments({\n    bids: { $exists: true, $type: 'array', $ne: [] },\n    'bids.0.vendorId': { $exists: true }\n  });\n\n  console.log(`Check 1: Embedded bids remaining: ${rfqsWithEmbeddedBids}`);\n  if (rfqsWithEmbeddedBids > 0) {\n    console.error('‚ùå FAIL: Found RFQs with embedded bids still present\\n');\n    process.exit(1);\n  }\n\n  // Check 2: All RFQ bids are ObjectId references\n  const rfqsWithInvalidBids = await RFQCollection.countDocuments({\n    bids: { $exists: true, $not: { $type: 'array' } }\n  });\n\n  console.log(`Check 2: RFQs with invalid bid structure: ${rfqsWithInvalidBids}`);\n  if (rfqsWithInvalidBids > 0) {\n    console.error('‚ùå FAIL: Found RFQs with invalid bid structure\\n');\n    process.exit(1);\n  }\n\n  // Check 3: All ProjectBids have valid rfqId references\n  const bidsWithoutRFQ = await ProjectBidCollection.countDocuments({\n    rfqId: { $exists: false }\n  });\n\n  console.log(`Check 3: ProjectBids without rfqId: ${bidsWithoutRFQ}`);\n  if (bidsWithoutRFQ > 0) {\n    console.error('‚ùå FAIL: Found ProjectBids without rfqId reference\\n');\n    process.exit(1);\n  }\n\n  // Check 4: Data integrity - counts match\n  const totalRFQs = await RFQCollection.countDocuments({});\n  const totalBids = await ProjectBidCollection.countDocuments({});\n  \n  console.log(`Check 4: Data counts:`);\n  console.log(`   Total RFQs: ${totalRFQs}`);\n  console.log(`   Total ProjectBids: ${totalBids}`);\n\n  // Check 5: Sample data validation\n  const sampleRFQ = await RFQCollection.findOne({ bids: { $ne: [] } });\n  if (sampleRFQ) {\n    console.log(`\\nCheck 5: Sample RFQ validation`);\n    console.log(`   RFQ ID: ${sampleRFQ._id}`);\n    console.log(`   Bid count: ${sampleRFQ.bids.length}`);\n    console.log(`   First bid ID: ${sampleRFQ.bids[0]}`);\n    console.log(`   Is ObjectId: ${mongoose.Types.ObjectId.isValid(sampleRFQ.bids[0])}`);\n\n    // Verify the referenced bids exist\n    const referencedBids = await ProjectBidCollection.countDocuments({\n      _id: { $in: sampleRFQ.bids }\n    });\n    \n    console.log(`   Referenced bids exist: ${referencedBids}/${sampleRFQ.bids.length}`);\n    \n    if (referencedBids !== sampleRFQ.bids.length) {\n      console.error('‚ùå FAIL: Referenced bids do not exist in ProjectBid collection\\n');\n      process.exit(1);\n    }\n  }\n\n  console.log('\\n‚úÖ ALL CHECKS PASSED - Migration verified successfully!\\n');\n  process.exit(0);\n}\n\nmain();\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/mongo-check.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/mongo-init.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'db' is not defined.","line":4,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":4,"endColumn":3},{"ruleId":"no-undef","severity":2,"message":"'db' is not defined.","line":4,"column":6,"nodeType":"Identifier","messageId":"undef","endLine":4,"endColumn":8},{"ruleId":"no-undef","severity":2,"message":"'db' is not defined.","line":7,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":7,"endColumn":3},{"ruleId":"no-undef","severity":2,"message":"'db' is not defined.","line":22,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":22,"endColumn":3},{"ruleId":"no-undef","severity":2,"message":"'db' is not defined.","line":37,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":37,"endColumn":3},{"ruleId":"no-undef","severity":2,"message":"'db' is not defined.","line":38,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":38,"endColumn":3},{"ruleId":"no-undef","severity":2,"message":"'db' is not defined.","line":39,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":39,"endColumn":3},{"ruleId":"no-undef","severity":2,"message":"'ObjectId' is not defined.","line":43,"column":8,"nodeType":"Identifier","messageId":"undef","endLine":43,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'db' is not defined.","line":56,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":56,"endColumn":3},{"ruleId":"no-undef","severity":2,"message":"'ObjectId' is not defined.","line":59,"column":8,"nodeType":"Identifier","messageId":"undef","endLine":59,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'db' is not defined.","line":71,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":71,"endColumn":3}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// MongoDB initialization script\n// This runs when the MongoDB container starts for the first time\n\ndb = db.getSiblingDB('fixzit');\n\n// Create collections with schema validation\ndb.createCollection('users', {\n  validator: {\n    $jsonSchema: {\n      bsonType: 'object',\n      required: ['email', 'tenantId'],\n      properties: {\n        email: { bsonType: 'string' },\n        tenantId: { bsonType: 'string' },\n        name: { bsonType: 'string' },\n        role: { enum: ['SUPER_ADMIN', 'ADMIN', 'USER', 'VIEWER'] }\n      }\n    }\n  }\n});\n\ndb.createCollection('tenants', {\n  validator: {\n    $jsonSchema: {\n      bsonType: 'object',\n      required: ['name', 'domain'],\n      properties: {\n        name: { bsonType: 'string' },\n        domain: { bsonType: 'string' },\n        status: { enum: ['ACTIVE', 'SUSPENDED', 'TRIAL', 'CANCELLED'] }\n      }\n    }\n  }\n});\n\n// Create indexes for performance\ndb.users.createIndex({ email: 1, tenantId: 1 }, { unique: true });\ndb.users.createIndex({ tenantId: 1 });\ndb.tenants.createIndex({ domain: 1 }, { unique: true });\n\n// Create default tenant and admin user\nconst defaultTenant = {\n  _id: ObjectId(),\n  name: 'Fixzit Demo',\n  domain: 'demo-tenant',\n  status: 'ACTIVE',\n  settings: {\n    language: 'en',\n    currency: 'SAR',\n    timezone: 'Asia/Riyadh'\n  },\n  createdAt: new Date(),\n  updatedAt: new Date()\n};\n\ndb.tenants.insertOne(defaultTenant);\n\nconst adminUser = {\n  _id: ObjectId(),\n  email: 'admin@fixzit.app',\n  name: 'System Administrator',\n  tenantId: defaultTenant._id.toString(),\n  role: 'SUPER_ADMIN',\n  status: 'ACTIVE',\n  // Password: Admin@123 (hashed with bcrypt)\n  password: '$2a$10$rYvLm8Z7YkF5m7mq8B7B0.xGxP7N5m5fK8F5K8F5K8F5K8F5K8F5K',\n  createdAt: new Date(),\n  updatedAt: new Date()\n};\n\ndb.users.insertOne(adminUser);\n\nprint('MongoDB initialization complete!');\nprint('Default tenant created: demo-tenant');\nprint('Admin user: admin@fixzit.app / Admin@123');\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/notifications-smoke.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/notifications/replay-dlq.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2556,2559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2556,2559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env tsx\n/**\n * Replay pending notification DLQ entries.\n *\n * Usage:\n *   pnpm tsx scripts/notifications/replay-dlq.ts --channel email --limit 25\n *   pnpm tsx scripts/notifications/replay-dlq.ts --channel all --limit 50 --dry-run\n */\n\nimport { NotificationDeadLetterModel, NotificationLogModel } from '@/server/models/NotificationLog';\nimport { connectToDatabase, disconnectFromDatabase } from '@/lib/mongodb-unified';\nimport type { NotificationChannel, NotificationPayload } from '@/lib/fm-notifications';\nimport {\n  sendFCMNotification,\n  sendEmailNotification,\n  sendSMSNotification,\n  sendWhatsAppNotification\n} from '@/lib/integrations/notifications';\nimport { logger } from '@/lib/logger';\nimport { loadEnv } from '@/scripts/utils/load-env';\nimport { setDeadLetterBacklog } from '@/lib/monitoring/notification-metrics';\n\nloadEnv();\n\ntype ReplayOptions = {\n  channel?: NotificationChannel;\n  limit: number;\n  dryRun: boolean;\n};\n\nconst SUPPORTED_CHANNELS: NotificationChannel[] = ['push', 'email', 'sms', 'whatsapp'];\n\nfunction parseArgs(): ReplayOptions {\n  const args = process.argv.slice(2);\n  const options: ReplayOptions = {\n    limit: 50,\n    dryRun: false\n  };\n\n  for (let i = 0; i < args.length; i += 1) {\n    const arg = args[i];\n    if (arg === '--channel' && args[i + 1]) {\n      const rawValue = args[i + 1].toLowerCase();\n      if (rawValue === 'all') {\n        options.channel = undefined;\n      } else if (SUPPORTED_CHANNELS.includes(rawValue as NotificationChannel)) {\n        options.channel = rawValue as NotificationChannel;\n      } else {\n        throw new Error(`Unsupported channel \"${args[i + 1]}\". Choose from ${SUPPORTED_CHANNELS.join(', ')} or \"all\"`);\n      }\n      i += 1;\n      continue;\n    }\n\n    if (arg.startsWith('--channel=')) {\n      const rawValue = arg.split('=')[1]?.toLowerCase();\n      if (!rawValue) continue;\n      if (rawValue === 'all') {\n        options.channel = undefined;\n      } else if (SUPPORTED_CHANNELS.includes(rawValue as NotificationChannel)) {\n        options.channel = rawValue as NotificationChannel;\n      } else {\n        throw new Error(`Unsupported channel \"${rawValue}\". Choose from ${SUPPORTED_CHANNELS.join(', ')} or \"all\"`);\n      }\n      continue;\n    }\n\n    if (arg === '--limit' && args[i + 1]) {\n      options.limit = Math.max(1, parseInt(args[i + 1], 10));\n      i += 1;\n      continue;\n    }\n\n    if (arg === '--dry-run') {\n      options.dryRun = true;\n      continue;\n    }\n  }\n\n  return options;\n}\n\nasync function replayEntry(channel: NotificationChannel, entry: any): Promise<void> {\n  const payload = entry.payload || {};\n  const recipient = entry.recipient || {};\n\n  const notification: NotificationPayload = {\n    id: entry.notificationId,\n    event: entry.event,\n    recipients: [\n      {\n        userId: recipient.userId || 'unknown',\n        name: recipient.userId || recipient.email || recipient.phone || 'Unknown Recipient',\n        email: recipient.email,\n        phone: recipient.phone,\n        preferredChannels: [channel]\n      }\n    ],\n    title: payload.title || 'Fixzit Notification',\n    body: payload.body || '',\n    deepLink: payload.deepLink,\n    data: payload.data,\n    priority: entry.priority || 'normal',\n    createdAt: new Date(entry.createdAt || Date.now()),\n    status: 'pending'\n  };\n\n  switch (channel) {\n    case 'push':\n      await sendFCMNotification(notification.recipients[0].userId, notification);\n      break;\n    case 'email':\n      await sendEmailNotification(notification.recipients[0], notification);\n      break;\n    case 'sms':\n      await sendSMSNotification(notification.recipients[0], notification);\n      break;\n    case 'whatsapp':\n      await sendWhatsAppNotification(notification.recipients[0], notification);\n      break;\n    default:\n      throw new Error(`Unsupported channel ${channel}`);\n  }\n}\n\nasync function run(): Promise<void> {\n  const options = parseArgs();\n  await connectToDatabase();\n\n  const query: Record<string, unknown> = { status: 'pending' };\n  if (options.channel) {\n    query.channel = options.channel;\n  }\n\n  const deadLetters = await NotificationDeadLetterModel.find(query)\n    .sort({ createdAt: 1 })\n    .limit(options.limit)\n    .lean();\n\n  if (deadLetters.length === 0) {\n    logger.info('[DLQ] No pending notification entries found', query);\n    await disconnectFromDatabase();\n    return;\n  }\n\n  logger.info('[DLQ] Processing entries', {\n    count: deadLetters.length,\n    channel: options.channel ?? 'all',\n    dryRun: options.dryRun\n  });\n\n  let succeeded = 0;\n  let failed = 0;\n\n  for (const entry of deadLetters) {\n    const channel = entry.channel as NotificationChannel;\n    const update: Record<string, unknown> = {\n      attempts: (entry.attempts || 0) + 1,\n      lastAttemptAt: new Date()\n    };\n\n    try {\n      if (!options.dryRun) {\n        await replayEntry(channel, entry);\n        update.status = 'replayed';\n        await NotificationDeadLetterModel.updateOne({ _id: entry._id }, update);\n        await NotificationLogModel.updateOne(\n          { notificationId: entry.notificationId, 'channelResults.channel': channel },\n          {\n            $set: {\n              'channelResults.$.status': 'sent',\n              'channelResults.$.lastAttemptAt': update.lastAttemptAt,\n              'channelResults.$.attempts': update.attempts\n            }\n          }\n        );\n      }\n\n      succeeded += 1;\n      logger.info('[DLQ] Replayed notification channel', {\n        notificationId: entry.notificationId,\n        channel,\n        attempts: update.attempts,\n        dryRun: options.dryRun\n      });\n    } catch (error) {\n      failed += 1;\n      const reason = error instanceof Error ? error.message : String(error);\n      update.status = 'pending';\n      update.error = reason;\n      if (!options.dryRun) {\n        await NotificationDeadLetterModel.updateOne({ _id: entry._id }, update);\n      }\n      logger.error('[DLQ] Failed to replay notification channel', {\n        notificationId: entry.notificationId,\n        channel,\n        error: reason\n      });\n    }\n  }\n\n  logger.info('[DLQ] Replay summary', { succeeded, failed });\n\n  if (!options.dryRun) {\n    const backlog = await NotificationDeadLetterModel.aggregate<{ _id: NotificationChannel; count: number }>([\n      { $match: { status: 'pending' } },\n      { $group: { _id: '$channel', count: { $sum: 1 } } }\n    ]);\n\n    const backlogMap = backlog.reduce<Partial<Record<NotificationChannel, number>>>((acc, entry) => {\n      acc[entry._id] = entry.count;\n      return acc;\n    }, {});\n\n    setDeadLetterBacklog(backlogMap);\n  }\n\n  await disconnectFromDatabase();\n}\n\nrun().catch(error => {\n  logger.error('[DLQ] Replay job crashed', { error });\n  process.exitCode = 1;\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/notify-route-metrics.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/openapi/build.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/phase1-truth-verifier.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/ping-mongo.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/production-check.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/property-owner-verification.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'e' is not defined.","line":98,"column":74,"nodeType":"Identifier","messageId":"undef","endLine":98,"endColumn":75}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// PROPERTY OWNER, DEPUTY, SUBSCRIPTION & DoA VERIFICATION\nconst axios = require('axios');\nconst BASE_URL = 'http://localhost:5000';\n\nconst colors = {\n  red: '\\x1b[31m',\n  green: '\\x1b[32m',\n  yellow: '\\x1b[33m',\n  blue: '\\x1b[34m',\n  reset: '\\x1b[0m'\n};\n\nasync function getAuthToken() {\n  try {\n    const res = await axios.post(`${BASE_URL}/api/auth/login`, {\n      email: 'admin@fixzit.com',\n      password: 'Admin@1234'\n    });\n    return res.data.token;\n  } catch (_e) {\n    console.log('‚ùå AUTH FAILED - Backend not running?');\n    return null;\n  }\n}\n\nasync function verifyPropertyOwnerFeatures() {\n  console.log('\\n' + colors.blue + '=' .repeat(80) + colors.reset);\n  console.log(colors.blue + 'üè¢ PROPERTY OWNER & SUBSCRIPTION SYSTEM VERIFICATION' + colors.reset);\n  console.log(colors.blue + '=' .repeat(80) + colors.reset + '\\n');\n\n  const token = await getAuthToken();\n  if (!token) {\n    console.log('‚ùå Cannot proceed without authentication');\n    return 0;\n  }\n  \n  const authHeaders = { Authorization: `Bearer ${token}` };\n\n  const results = {\n    propertyOwner: [],\n    deputy: [],\n    subscription: [],\n    doa: [],\n    revenue: []\n  };\n\n  // ==========================\n  // 1. PROPERTY OWNER FEATURES\n  // ==========================\n  console.log(colors.yellow + '\\n1Ô∏è‚É£ PROPERTY OWNER ROLE FEATURES' + colors.reset);\n  console.log('-'.repeat(60));\n\n  const ownerTests = [\n    {\n      name: 'Owner Portfolio Dashboard',\n      test: async () => {\n        const res = await axios.get(`${BASE_URL}/api/owner/dashboard`, { headers: authHeaders });\n        return res.data.properties && res.data.revenue && res.data.expenses;\n      }\n    },\n    {\n      name: 'Property Performance Metrics',\n      test: async () => {\n        const res = await axios.get(`${BASE_URL}/api/owner/properties/performance`, { headers: authHeaders });\n        return res.data.occupancyRate && res.data.maintenanceCosts && res.data.roi;\n      }\n    },\n    {\n      name: 'FM Corporate Performance Tracking',\n      test: async () => {\n        const res = await axios.get(`${BASE_URL}/api/owner/fm-performance`, { headers: authHeaders });\n        return res.data.slaCompliance && res.data.responseTime && res.data.costSavings;\n      }\n    },\n    {\n      name: 'Owner Approval Queue',\n      test: async () => {\n        const res = await axios.get(`${BASE_URL}/api/owner/approvals/pending`, { headers: authHeaders });\n        return Array.isArray(res.data) && res.data.length >= 0;\n      }\n    },\n    {\n      name: 'Property Financial Statements',\n      test: async () => {\n        const res = await axios.get(`${BASE_URL}/api/owner/properties/123/financials`, { headers: authHeaders });\n        return res.data.income && res.data.expenses && res.data.netIncome;\n      }\n    }\n  ];\n\n  for (const test of ownerTests) {\n    try {\n      const passed = await test.test();\n      const status = passed ? `${colors.green}‚úÖ WORKING${colors.reset}` : `${colors.red}‚ùå MISSING${colors.reset}`;\n      console.log(`  ${status} ${test.name}`);\n      results.propertyOwner.push({ name: test.name, passed });\n    } catch (_e) {\n      console.log(`  ${colors.red}‚ùå ERROR${colors.reset} ${test.name}: ${e.message}`);\n      results.propertyOwner.push({ name: test.name, passed: false });\n    }\n  }\n\n  // ==========================\n  // 2. DEPUTY MANAGEMENT\n  // ==========================\n  console.log(colors.yellow + '\\n2Ô∏è‚É£ DEPUTY SYSTEM' + colors.reset);\n  console.log('-'.repeat(60));\n\n  const deputyTests = [\n    {\n      name: 'Assign Deputy to Property',\n      test: async () => {\n        const res = await axios.post(`${BASE_URL}/api/owner/properties/123/deputy`, {\n          deputyUserId: 'user456',\n          permissions: ['approve_maintenance', 'view_financials']\n        }, { headers: authHeaders });\n        return res.data.deputyId && res.data.permissions;\n      }\n    },\n    {\n      name: 'List Property Deputies',\n      test: async () => {\n        const res = await axios.get(`${BASE_URL}/api/owner/deputies`, { headers: authHeaders });\n        return Array.isArray(res.data);\n      }\n    },\n    {\n      name: 'Deputy Permission Management',\n      test: async () => {\n        const res = await axios.put(`${BASE_URL}/api/owner/deputies/456/permissions`, {\n          permissions: ['approve_up_to_5000']\n        }, { headers: authHeaders });\n        return res.data.updated;\n      }\n    }\n  ];\n\n  for (const test of deputyTests) {\n    try {\n      const passed = await test.test();\n      const status = passed ? `${colors.green}‚úÖ WORKING${colors.reset}` : `${colors.red}‚ùå MISSING${colors.reset}`;\n      console.log(`  ${status} ${test.name}`);\n      results.deputy.push({ name: test.name, passed });\n    } catch (_e) {\n      console.log(`  ${colors.red}‚ùå ERROR${colors.reset} ${test.name}`);\n      results.deputy.push({ name: test.name, passed: false });\n    }\n  }\n\n  // ==========================\n  // 3. SUBSCRIPTION MANAGEMENT\n  // ==========================\n  console.log(colors.yellow + '\\n3Ô∏è‚É£ CORPORATE SUBSCRIPTION SYSTEM' + colors.reset);\n  console.log('-'.repeat(60));\n\n  const subscriptionTests = [\n    {\n      name: 'Subscription Plans (Basic/Pro/Enterprise)',\n      test: async () => {\n        const res = await axios.get(`${BASE_URL}/api/subscriptions/plans`, { headers: authHeaders });\n        return res.data.plans && res.data.plans.length >= 3;\n      }\n    },\n    {\n      name: 'Organization Subscription Status',\n      test: async () => {\n        const res = await axios.get(`${BASE_URL}/api/org/subscription`, { headers: authHeaders });\n        return res.data.plan && res.data.status && res.data.expiryDate;\n      }\n    },\n    {\n      name: 'Usage Tracking vs Limits',\n      test: async () => {\n        const res = await axios.get(`${BASE_URL}/api/org/usage`, { headers: authHeaders });\n        return res.data.properties && res.data.users && res.data.limits;\n      }\n    },\n    {\n      name: 'Billing & Payment Management',\n      test: async () => {\n        const res = await axios.get(`${BASE_URL}/api/org/billing`, { headers: authHeaders });\n        return res.data.invoices && res.data.paymentMethod;\n      }\n    },\n    {\n      name: 'Module Access Based on Plan',\n      test: async () => {\n        const res = await axios.get(`${BASE_URL}/api/org/enabled-modules`, { headers: authHeaders });\n        return res.data.modules && res.data.restrictions;\n      }\n    },\n    {\n      name: 'Super Admin Subscription Management',\n      test: async () => {\n        const res = await axios.get(`${BASE_URL}/api/admin/subscriptions`, { headers: authHeaders });\n        return res.data.organizations && res.data.revenue;\n      }\n    }\n  ];\n\n  for (const test of subscriptionTests) {\n    try {\n      const passed = await test.test();\n      const status = passed ? `${colors.green}‚úÖ WORKING${colors.reset}` : `${colors.red}‚ùå MISSING${colors.reset}`;\n      console.log(`  ${status} ${test.name}`);\n      results.subscription.push({ name: test.name, passed });\n    } catch (_e) {\n      console.log(`  ${colors.red}‚ùå ERROR${colors.reset} ${test.name}`);\n      results.subscription.push({ name: test.name, passed: false });\n    }\n  }\n\n  // ==========================\n  // 4. DoA (DELEGATION OF AUTHORITY)\n  // ==========================\n  console.log(colors.yellow + '\\n4Ô∏è‚É£ DELEGATION OF AUTHORITY (DoA) SYSTEM' + colors.reset);\n  console.log('-'.repeat(60));\n\n  const doaTests = [\n    {\n      name: 'DoA Rules Configuration',\n      test: async () => {\n        const res = await axios.get(`${BASE_URL}/api/admin/doa/rules`, { headers: authHeaders });\n        return res.data.rules && res.data.thresholds;\n      }\n    },\n    {\n      name: 'Cost Threshold Triggers',\n      test: async () => {\n        const res = await axios.post(`${BASE_URL}/api/doa/check`, {\n          workOrderId: 'wo123',\n          amount: 10000\n        }, { headers: authHeaders });\n        return res.data.requiresApproval && res.data.approvers;\n      }\n    },\n    {\n      name: 'Sequential Approval Workflow',\n      test: async () => {\n        const res = await axios.get(`${BASE_URL}/api/doa/workflow/wo123`, { headers: authHeaders });\n        return res.data.steps && res.data.currentStep;\n      }\n    },\n    {\n      name: 'Parallel Approval Support',\n      test: async () => {\n        const res = await axios.post(`${BASE_URL}/api/doa/parallel-approval`, {\n          workOrderId: 'wo123',\n          approvers: ['owner', 'finance']\n        }, { headers: authHeaders });\n        return res.data.parallelApprovals;\n      }\n    },\n    {\n      name: 'Approval SLA & Escalation',\n      test: async () => {\n        const res = await axios.get(`${BASE_URL}/api/doa/sla/wo123`, { headers: authHeaders });\n        return res.data.slaTime && res.data.escalationPath;\n      }\n    }\n  ];\n\n  for (const test of doaTests) {\n    try {\n      const passed = await test.test();\n      const status = passed ? `${colors.green}‚úÖ WORKING${colors.reset}` : `${colors.red}‚ùå MISSING${colors.reset}`;\n      console.log(`  ${status} ${test.name}`);\n      results.doa.push({ name: test.name, passed });\n    } catch (_e) {\n      console.log(`  ${colors.red}‚ùå ERROR${colors.reset} ${test.name}`);\n      results.doa.push({ name: test.name, passed: false });\n    }\n  }\n\n  // ==========================\n  // 5. REVENUE TRACKING\n  // ==========================\n  console.log(colors.yellow + '\\n5Ô∏è‚É£ PROPERTY REVENUE TRACKING' + colors.reset);\n  console.log('-'.repeat(60));\n\n  const revenueTests = [\n    {\n      name: 'Rent Collection Tracking',\n      test: async () => {\n        const res = await axios.get(`${BASE_URL}/api/owner/revenue/rent`, { headers: authHeaders });\n        return res.data.collected && res.data.pending && res.data.overdue;\n      }\n    },\n    {\n      name: 'Maintenance Cost vs Revenue',\n      test: async () => {\n        const res = await axios.get(`${BASE_URL}/api/owner/analysis/cost-revenue`, { headers: authHeaders });\n        return res.data.maintenanceRatio && res.data.profitMargin;\n      }\n    },\n    {\n      name: 'Property ROI Calculation',\n      test: async () => {\n        const res = await axios.get(`${BASE_URL}/api/owner/properties/123/roi`, { headers: authHeaders });\n        return res.data.roi && res.data.paybackPeriod;\n      }\n    },\n    {\n      name: 'FM Performance vs Cost',\n      test: async () => {\n        const res = await axios.get(`${BASE_URL}/api/owner/fm-cost-analysis`, { headers: authHeaders });\n        return res.data.managementFees && res.data.valueDelivered;\n      }\n    }\n  ];\n\n  for (const test of revenueTests) {\n    try {\n      const passed = await test.test();\n      const status = passed ? `${colors.green}‚úÖ WORKING${colors.reset}` : `${colors.red}‚ùå MISSING${colors.reset}`;\n      console.log(`  ${status} ${test.name}`);\n      results.revenue.push({ name: test.name, passed });\n    } catch (_e) {\n      console.log(`  ${colors.red}‚ùå ERROR${colors.reset} ${test.name}`);\n      results.revenue.push({ name: test.name, passed: false });\n    }\n  }\n\n  // ==========================\n  // SUMMARY\n  // ==========================\n  console.log('\\n' + colors.blue + '=' .repeat(80) + colors.reset);\n  console.log(colors.blue + 'üìä VERIFICATION SUMMARY' + colors.reset);\n  console.log(colors.blue + '=' .repeat(80) + colors.reset + '\\n');\n\n  let totalTests = 0;\n  let totalPassed = 0;\n\n  for (const [category, tests] of Object.entries(results)) {\n    const passed = tests.filter(t => t.passed).length;\n    totalTests += tests.length;\n    totalPassed += passed;\n    \n    const percentage = Math.round((passed / tests.length) * 100);\n    const icon = percentage === 100 ? '‚úÖ' : percentage > 50 ? '‚ö†Ô∏è' : '‚ùå';\n    \n    console.log(`  ${icon} ${category.toUpperCase()}: ${passed}/${tests.length} (${percentage}%)`);\n  }\n\n  const overallPercentage = Math.round((totalPassed / totalTests) * 100);\n\n  console.log('\\n' + colors.yellow + 'üìà OVERALL CRITICAL FEATURES:' + colors.reset);\n  console.log(`  Total Tests: ${totalTests}`);\n  console.log(`  Passed: ${totalPassed} (${overallPercentage}%)`);\n  console.log(`  Failed: ${totalTests - totalPassed}`);\n\n  if (overallPercentage < 50) {\n    console.log('\\n' + colors.red + '‚ùå CRITICAL SYSTEMS ARE MISSING!' + colors.reset);\n    console.log('The system is NOT ready without:');\n    console.log('  - Property Owner dashboard and approval system');\n    console.log('  - Deputy management for delegation');\n    console.log('  - Corporate subscription/billing for SaaS model');\n    console.log('  - DoA approval workflows');\n    console.log('  - Revenue tracking for property owners');\n    console.log('\\n' + colors.yellow + 'ACTION REQUIRED:' + colors.reset);\n    console.log('Search chat history for: \"property owner\", \"deputy\", \"subscription\", \"DoA\", \"revenue\"');\n  }\n\n  console.log('\\n' + colors.blue + '=' .repeat(80) + colors.reset + '\\n');\n\n  return overallPercentage;\n}\n\n// Run verification\n(async () => {\n  const percentage = await verifyPropertyOwnerFeatures();\n  process.exit(percentage >= 80 ? 0 : 1);\n})();\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/qa/halt-fix-verify.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/rapid-enhance-all.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/rbac/export.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/reality-check.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/remove-duplicates-safe.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/remove-duplicates-v2.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/replace-console-with-logger.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/replace-string-in-file-verbose.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/replace-string-in-file.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/replace.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/run-route-http-check.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/scan-date-hydration.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/scan-delta.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/scan-hex.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/scan-hydration-issues.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/scan-unhandled-promises.ts","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'path' is defined but never used. Allowed unused vars must match /^_/u.","line":16,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":12,"suggestions":[{"messageId":"removeVar","data":{"varName":"path"},"fix":{"range":[417,427],"text":""},"desc":"Remove unused variable 'path'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'path' is defined but never used. Allowed unused vars must match /^_/u.","line":16,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":12}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env tsx\n/**\n * UNHANDLED PROMISE SCANNER\n * Scans codebase for potential unhandled promise rejections\n * Target: 230 files with promise usage\n * \n * Patterns detected:\n * 1. new Promise() without .catch()\n * 2. Promise.all() without .catch()\n * 3. fetch() without .catch() or try-catch\n * 4. .then() without .catch()\n * 5. async functions without try-catch\n */\n\nimport { promises as fs } from 'fs';\nimport path from 'path';\nimport { glob } from 'glob';\n\ninterface Issue {\n  file: string;\n  line: number;\n  column: number;\n  type: 'new-promise' | 'promise-all' | 'fetch' | 'then-no-catch' | 'async-no-try';\n  code: string;\n  severity: 'critical' | 'major' | 'moderate';\n}\n\nconst issues: Issue[] = [];\n\n// Patterns to detect\nconst PATTERNS = {\n  newPromise: /new\\s+Promise\\s*\\(/g,\n  promiseAll: /Promise\\.(all|race|any|allSettled)\\s*\\(/g,\n  fetch: /(?:await\\s+)?fetch\\s*\\(/g,\n  then: /\\.then\\s*\\(/g,\n  catch: /\\.catch\\s*\\(/g,\n  tryBlock: /try\\s*\\{/g,\n  asyncFunction: /async\\s+(function|\\(|\\w+\\s*\\()/g,\n};\n\nasync function scanFile(filePath: string): Promise<void> {\n  try {\n    const content = await fs.readFile(filePath, 'utf-8');\n    const lines = content.split('\\n');\n\n    lines.forEach((line, index) => {\n      const lineNumber = index + 1;\n\n      // Check for new Promise without subsequent .catch\n      if (PATTERNS.newPromise.test(line)) {\n        // Look ahead 10 lines for .catch()\n        const contextLines = lines.slice(index, Math.min(index + 10, lines.length));\n        const hasCatch = contextLines.some(l => PATTERNS.catch.test(l));\n        \n        if (!hasCatch) {\n          issues.push({\n            file: filePath,\n            line: lineNumber,\n            column: line.indexOf('new Promise'),\n            type: 'new-promise',\n            code: line.trim(),\n            severity: 'critical'\n          });\n        }\n      }\n\n      // Check for Promise.all/race/any without .catch\n      if (PATTERNS.promiseAll.test(line)) {\n        const contextLines = lines.slice(index, Math.min(index + 10, lines.length));\n        const hasCatch = contextLines.some(l => PATTERNS.catch.test(l));\n        \n        if (!hasCatch) {\n          issues.push({\n            file: filePath,\n            line: lineNumber,\n            column: line.indexOf('Promise.'),\n            type: 'promise-all',\n            code: line.trim(),\n            severity: 'major'\n          });\n        }\n      }\n\n      // Check for fetch without try-catch\n      if (PATTERNS.fetch.test(line) && line.includes('await')) {\n        // Look back 5 lines for try {\n        const contextLines = lines.slice(Math.max(0, index - 5), index + 1);\n        const hasTry = contextLines.some(l => PATTERNS.tryBlock.test(l));\n        \n        if (!hasTry) {\n          issues.push({\n            file: filePath,\n            line: lineNumber,\n            column: line.indexOf('fetch'),\n            type: 'fetch',\n            code: line.trim(),\n            severity: 'major'\n          });\n        }\n      }\n\n      // Check for .then() without .catch()\n      if (PATTERNS.then.test(line)) {\n        const contextLines = lines.slice(index, Math.min(index + 5, lines.length));\n        const hasCatch = contextLines.some(l => PATTERNS.catch.test(l));\n        \n        if (!hasCatch) {\n          issues.push({\n            file: filePath,\n            line: lineNumber,\n            column: line.indexOf('.then'),\n            type: 'then-no-catch',\n            code: line.trim(),\n            severity: 'moderate'\n          });\n        }\n      }\n    });\n  } catch (error) {\n    console.error(`‚ùå Error scanning ${filePath}:`, error);\n  }\n}\n\nasync function main() {\n  console.log('üîç Scanning for unhandled promise rejections...\\n');\n\n  const files = await glob('**/*.{ts,tsx,js,jsx}', {\n    ignore: [\n      'node_modules/**',\n      '.next/**',\n      'dist/**',\n      'build/**',\n      'coverage/**',\n      '**/*.test.{ts,tsx,js,jsx}',\n      '**/*.spec.{ts,tsx,js,jsx}',\n      'tests/**',\n      '__tests__/**'\n    ],\n    cwd: process.cwd()\n  });\n\n  console.log(`üìÇ Found ${files.length} files to scan\\n`);\n\n  for (const file of files) {\n    await scanFile(file);\n  }\n\n  // Group by severity\n  const critical = issues.filter(i => i.severity === 'critical');\n  const major = issues.filter(i => i.severity === 'major');\n  const moderate = issues.filter(i => i.severity === 'moderate');\n\n  console.log('\\nüìä SCAN RESULTS\\n');\n  console.log(`üî¥ Critical: ${critical.length} issues`);\n  console.log(`üüß Major: ${major.length} issues`);\n  console.log(`üü® Moderate: ${moderate.length} issues`);\n  console.log(`üìù Total: ${issues.length} issues\\n`);\n\n  // Save detailed report\n  const report = {\n    timestamp: new Date().toISOString(),\n    totalFiles: files.length,\n    totalIssues: issues.length,\n    bySeverity: {\n      critical: critical.length,\n      major: major.length,\n      moderate: moderate.length\n    },\n    byType: {\n      'new-promise': issues.filter(i => i.type === 'new-promise').length,\n      'promise-all': issues.filter(i => i.type === 'promise-all').length,\n      'fetch': issues.filter(i => i.type === 'fetch').length,\n      'then-no-catch': issues.filter(i => i.type === 'then-no-catch').length,\n      'async-no-try': issues.filter(i => i.type === 'async-no-try').length,\n    },\n    issues: issues\n  };\n\n  await fs.mkdir('_artifacts/scans', { recursive: true });\n  await fs.writeFile(\n    '_artifacts/scans/unhandled-promises.json',\n    JSON.stringify(report, null, 2)\n  );\n\n  // Generate CSV for easy review\n  const csv = [\n    'File,Line,Type,Severity,Code',\n    ...issues.map(i => `\"${i.file}\",${i.line},\"${i.type}\",\"${i.severity}\",\"${i.code.replace(/\"/g, '\"\"')}\"`)\n  ].join('\\n');\n\n  await fs.writeFile('_artifacts/scans/unhandled-promises.csv', csv);\n\n  console.log('‚úÖ Reports saved:');\n  console.log('   _artifacts/scans/unhandled-promises.json');\n  console.log('   _artifacts/scans/unhandled-promises.csv\\n');\n\n  // Show top 20 critical issues\n  if (critical.length > 0) {\n    console.log('\\nüî¥ TOP 20 CRITICAL ISSUES:\\n');\n    critical.slice(0, 20).forEach((issue, index) => {\n      console.log(`${index + 1}. ${issue.file}:${issue.line}`);\n      console.log(`   ${issue.code}`);\n      console.log('');\n    });\n  }\n\n  process.exit(issues.length > 0 ? 1 : 0);\n}\n\nmain();\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/scanner.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/security-audit.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/security-migration.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/security/configure-monitoring.ts","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'readFileSync' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":37,"suggestions":[{"messageId":"removeVar","data":{"varName":"readFileSync"},"fix":{"range":[233,247],"text":""},"desc":"Remove unused variable 'readFileSync'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'readFileSync' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":37},{"ruleId":"no-unused-vars","severity":2,"message":"'existsSync' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":39,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":49,"suggestions":[{"messageId":"removeVar","data":{"varName":"existsSync"},"fix":{"range":[247,259],"text":""},"desc":"Remove unused variable 'existsSync'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'existsSync' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":49}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env tsx\n/**\n * Security Event Monitoring Configuration\n * Adds logging hooks for rate limiting, CORS violations, and auth failures\n * \n * Usage: pnpm tsx scripts/security/configure-monitoring.ts\n */\n\nimport { writeFileSync, readFileSync, existsSync } from 'fs';\nimport { join } from 'path';\n\nconst MONITORING_CONFIG = {\n  rateLimit: {\n    logLevel: 'warn',\n    alertThreshold: 100, // Alert if 100+ rate limit hits in 5 minutes\n    destinations: ['console', 'file', 'webhook']\n  },\n  cors: {\n    logLevel: 'warn',\n    alertThreshold: 50, // Alert if 50+ CORS violations in 5 minutes\n    destinations: ['console', 'file']\n  },\n  auth: {\n    logLevel: 'error',\n    alertThreshold: 10, // Alert if 10+ auth failures in 5 minutes\n    destinations: ['console', 'file', 'webhook']\n  },\n  mongodb: {\n    logLevel: 'error',\n    alertThreshold: 5, // Alert if 5+ connection failures in 5 minutes\n    destinations: ['console', 'file', 'webhook']\n  }\n};\n\nconst MONITORING_MIDDLEWARE = `\n/**\n * Security event monitoring middleware\n * Auto-generated by scripts/security/configure-monitoring.ts\n */\n\nimport { logger } from '@/lib/logger';\nimport { NextRequest, NextResponse } from 'next/server';\n\n// Rate limit event tracking\nconst rateLimitHits = new Map<string, number[]>();\nconst corsViolations = new Map<string, number[]>();\nconst authFailures = new Map<string, number[]>();\n\nconst WINDOW_MS = 5 * 60 * 1000; // 5 minutes\nconst ALERT_THRESHOLDS = ${JSON.stringify(MONITORING_CONFIG, null, 2)};\n\nfunction cleanOldEntries(map: Map<string, number[]>, windowMs: number): void {\n  const cutoff = Date.now() - windowMs;\n  for (const [key, timestamps] of map.entries()) {\n    const filtered = timestamps.filter(t => t > cutoff);\n    if (filtered.length === 0) {\n      map.delete(key);\n    } else {\n      map.set(key, filtered);\n    }\n  }\n}\n\nfunction trackEvent(\n  map: Map<string, number[]>,\n  key: string,\n  eventType: string,\n  threshold: number\n): void {\n  cleanOldEntries(map, WINDOW_MS);\n  \n  const timestamps = map.get(key) || [];\n  timestamps.push(Date.now());\n  map.set(key, timestamps);\n  \n  if (timestamps.length >= threshold) {\n    logger.warn(\\`[\\${eventType}] Alert threshold exceeded\\`, {\n      key,\n      count: timestamps.length,\n      windowMs: WINDOW_MS,\n      threshold\n    });\n    \n    // Emit webhook if configured\n    if (process.env.SECURITY_ALERT_WEBHOOK) {\n      fetch(process.env.SECURITY_ALERT_WEBHOOK, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          event: eventType,\n          key,\n          count: timestamps.length,\n          threshold,\n          timestamp: new Date().toISOString()\n        })\n      }).catch(err => logger.error('[Webhook] Failed to send alert', err));\n    }\n  }\n}\n\nexport function trackRateLimitHit(identifier: string, endpoint: string): void {\n  const key = \\`\\${identifier}:\\${endpoint}\\`;\n  trackEvent(rateLimitHits, key, 'RateLimit', ALERT_THRESHOLDS.rateLimit.alertThreshold);\n  \n  logger.warn('[RateLimit] Request blocked', {\n    identifier,\n    endpoint,\n    timestamp: new Date().toISOString()\n  });\n}\n\nexport function trackCorsViolation(origin: string, endpoint: string): void {\n  const key = \\`\\${origin}:\\${endpoint}\\`;\n  trackEvent(corsViolations, key, 'CORS', ALERT_THRESHOLDS.cors.alertThreshold);\n  \n  logger.warn('[CORS] Origin blocked', {\n    origin,\n    endpoint,\n    timestamp: new Date().toISOString()\n  });\n}\n\nexport function trackAuthFailure(identifier: string, reason: string): void {\n  trackEvent(authFailures, identifier, 'Auth', ALERT_THRESHOLDS.auth.alertThreshold);\n  \n  logger.error('[Auth] Authentication failed', {\n    identifier,\n    reason,\n    timestamp: new Date().toISOString()\n  });\n}\n\nexport function getSecurityMetrics() {\n  return {\n    rateLimitHits: rateLimitHits.size,\n    corsViolations: corsViolations.size,\n    authFailures: authFailures.size,\n    windowMs: WINDOW_MS\n  };\n}\n`;\n\nconst ENHANCED_RATE_LIMIT_MIDDLEWARE = `\n/**\n * Enhanced rate limiting with monitoring\n * Based on lib/security/rate-limit.ts\n */\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { rateLimit } from '@/server/security/rateLimit';\nimport { rateLimitError } from '@/server/utils/errorResponses';\nimport { getClientIP } from '@/server/security/headers';\nimport { trackRateLimitHit } from '@/lib/security/monitoring';\n\nexport type RateLimitOptions = {\n  identifier?: string;\n  keyPrefix?: string;\n  requests?: number;\n  windowMs?: number;\n};\n\nexport function enforceRateLimit(\n  request: NextRequest,\n  options: RateLimitOptions = {}\n): NextResponse | null {\n  const identifier = options.identifier ?? getClientIP(request);\n  const prefix = options.keyPrefix ?? new URL(request.url).pathname;\n  const key = \\`\\${prefix}:\\${identifier}\\`;\n\n  const result = rateLimit(key, options.requests ?? 30, options.windowMs ?? 60_000);\n  \n  if (!result.allowed) {\n    // Track rate limit event for monitoring\n    trackRateLimitHit(identifier, prefix);\n    return rateLimitError();\n  }\n\n  // Add rate limit headers\n  const response = NextResponse.next();\n  response.headers.set('X-RateLimit-Limit', String(options.requests ?? 30));\n  response.headers.set('X-RateLimit-Remaining', String(result.remaining));\n  response.headers.set('X-RateLimit-Reset', String(Date.now() + (options.windowMs ?? 60_000)));\n  \n  return null;\n}\n`;\n\nconst ENHANCED_CORS_MIDDLEWARE = `\n/**\n * Enhanced CORS middleware with monitoring\n * Updates middleware.ts CORS handling\n */\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { isOriginAllowed, resolveAllowedOrigin } from '@/lib/security/cors-allowlist';\nimport { trackCorsViolation } from '@/lib/security/monitoring';\n\nexport function handleCorsRequest(request: NextRequest): NextResponse | null {\n  const origin = request.headers.get('origin');\n  const pathname = new URL(request.url).pathname;\n  \n  // Check if origin is allowed\n  if (origin && !isOriginAllowed(origin)) {\n    // Track CORS violation for monitoring\n    trackCorsViolation(origin, pathname);\n    \n    return new NextResponse('Forbidden: Origin not allowed', {\n      status: 403,\n      headers: {\n        'Content-Type': 'text/plain'\n      }\n    });\n  }\n  \n  // Origin is allowed - add CORS headers\n  const allowedOrigin = resolveAllowedOrigin(origin);\n  \n  if (request.method === 'OPTIONS') {\n    return new NextResponse(null, {\n      status: 204,\n      headers: {\n        'Access-Control-Allow-Origin': allowedOrigin || '*',\n        'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, PATCH, OPTIONS',\n        'Access-Control-Allow-Headers': 'Content-Type, Authorization, X-Tenant-ID, X-Org-ID',\n        'Access-Control-Max-Age': '86400',\n        'Access-Control-Allow-Credentials': 'true'\n      }\n    });\n  }\n  \n  return null;\n}\n\nexport function addCorsHeaders(response: NextResponse, origin: string | null): NextResponse {\n  const allowedOrigin = resolveAllowedOrigin(origin);\n  \n  if (allowedOrigin) {\n    response.headers.set('Access-Control-Allow-Origin', allowedOrigin);\n    response.headers.set('Access-Control-Allow-Credentials', 'true');\n  }\n  \n  return response;\n}\n`;\n\nconsole.log('üîß Configuring security monitoring...\\n');\n\n// Create monitoring middleware file\nconst monitoringPath = join(process.cwd(), 'lib/security/monitoring.ts');\nwriteFileSync(monitoringPath, MONITORING_MIDDLEWARE.trim());\nconsole.log('‚úÖ Created lib/security/monitoring.ts');\n\n// Create enhanced rate limit middleware\nconst enhancedRateLimitPath = join(process.cwd(), 'lib/middleware/enhanced-rate-limit.ts');\nwriteFileSync(enhancedRateLimitPath, ENHANCED_RATE_LIMIT_MIDDLEWARE.trim());\nconsole.log('‚úÖ Created lib/middleware/enhanced-rate-limit.ts');\n\n// Create enhanced CORS middleware\nconst enhancedCorsPath = join(process.cwd(), 'lib/middleware/enhanced-cors.ts');\nwriteFileSync(enhancedCorsPath, ENHANCED_CORS_MIDDLEWARE.trim());\nconsole.log('‚úÖ Created lib/middleware/enhanced-cors.ts');\n\n// Create environment variables template\nconst envTemplate = `\n# Security Monitoring Configuration\n# Add these to your .env.local file\n\n# Webhook for security alerts (optional)\nSECURITY_ALERT_WEBHOOK=https://your-monitoring-service.com/webhook\n\n# Log level for security events (debug, info, warn, error)\nSECURITY_LOG_LEVEL=warn\n\n# Enable security monitoring (true/false)\nENABLE_SECURITY_MONITORING=true\n`;\n\nconst envTemplatePath = join(process.cwd(), '.env.security.template');\nwriteFileSync(envTemplatePath, envTemplate.trim());\nconsole.log('‚úÖ Created .env.security.template');\n\n// Create monitoring dashboard query examples\nconst dashboardQueries = `\n# Security Monitoring Dashboard Queries\n# Use these with your logging/monitoring service (DataDog, New Relic, etc.)\n\n## Rate Limit Events\n\\`\\`\\`\nservice:fixzit event:RateLimit\n| group by identifier, endpoint\n| count\n| top 10\n\\`\\`\\`\n\n## CORS Violations\n\\`\\`\\`\nservice:fixzit event:CORS\n| group by origin, endpoint\n| count\n| where count > 10\n\\`\\`\\`\n\n## Authentication Failures\n\\`\\`\\`\nservice:fixzit event:Auth status:failed\n| group by identifier, reason\n| count\n| where count > 5\n\\`\\`\\`\n\n## Security Metrics (Last 24 Hours)\n\\`\\`\\`\nservice:fixzit (event:RateLimit OR event:CORS OR event:Auth)\n| timeseries sum(count) by event\n| timeframe last_24h\n\\`\\`\\`\n`;\n\nconst dashboardPath = join(process.cwd(), 'docs/security/MONITORING_QUERIES.md');\nwriteFileSync(dashboardPath, dashboardQueries.trim());\nconsole.log('‚úÖ Created docs/security/MONITORING_QUERIES.md');\n\n// Create integration instructions\nconst integrationInstructions = `\n# Security Monitoring Integration Guide\n\n## Step 1: Update Rate-Limited Routes\n\nFor each rate-limited route, replace the import:\n\n\\`\\`\\`typescript\n// OLD:\nimport { enforceRateLimit } from '@/lib/middleware/rate-limit';\n\n// NEW:\nimport { enforceRateLimit } from '@/lib/middleware/enhanced-rate-limit';\n\\`\\`\\`\n\nThe enhanced version includes automatic monitoring hooks.\n\n## Step 2: Update Middleware.ts\n\nUpdate your \\`middleware.ts\\` file to use enhanced CORS:\n\n\\`\\`\\`typescript\nimport { handleCorsRequest, addCorsHeaders } from '@/lib/middleware/enhanced-cors';\n\nexport async function middleware(request: NextRequest) {\n  // Handle CORS with monitoring\n  const corsResponse = handleCorsRequest(request);\n  if (corsResponse) return corsResponse;\n  \n  // ... rest of middleware logic\n  \n  // Add CORS headers to response\n  const response = NextResponse.next();\n  return addCorsHeaders(response, request.headers.get('origin'));\n}\n\\`\\`\\`\n\n## Step 3: Configure Environment Variables\n\nCopy \\`.env.security.template\\` to \\`.env.local\\` and fill in values:\n\n\\`\\`\\`bash\ncp .env.security.template .env.local.security\n# Edit .env.local.security with your values\n# Then append to .env.local:\ncat .env.local.security >> .env.local\n\\`\\`\\`\n\n## Step 4: Set Up Alerting Webhook (Optional)\n\nConfigure a webhook URL to receive security alerts:\n\n### Option A: Slack\n1. Create a Slack webhook: https://api.slack.com/messaging/webhooks\n2. Set SECURITY_ALERT_WEBHOOK to your Slack webhook URL\n\n### Option B: Discord\n1. Create a Discord webhook in your server settings\n2. Set SECURITY_ALERT_WEBHOOK to your Discord webhook URL\n\n### Option C: Custom Service\n1. Deploy a webhook receiver (see examples/webhook-receiver.ts)\n2. Set SECURITY_ALERT_WEBHOOK to your service URL\n\n## Step 5: Test Monitoring\n\nRun the security test suite to generate events:\n\n\\`\\`\\`bash\npnpm tsx scripts/security/run-all-security-tests.sh\n\\`\\`\\`\n\nCheck your logs for security events:\n\n\\`\\`\\`bash\ngrep \"RateLimit|CORS|Auth\" logs/*.log\n\\`\\`\\`\n\n## Step 6: Set Up Dashboard (Optional)\n\nUse the queries in \\`docs/security/MONITORING_QUERIES.md\\` with your monitoring service.\n\n### DataDog\n1. Create a new dashboard\n2. Add widgets using the provided queries\n3. Set up monitors for alert thresholds\n\n### New Relic\n1. Create a new dashboard\n2. Add NRQL queries based on the templates\n3. Set up alert policies\n\n### Grafana\n1. Create a new dashboard\n2. Add panels with LogQL/PromQL queries\n3. Configure alerting rules\n\n## Monitoring Metrics\n\nThe following metrics are tracked:\n\n- **Rate Limit Hits:** Count of 429 responses per endpoint\n- **CORS Violations:** Count of blocked origins per endpoint\n- **Auth Failures:** Count of failed authentications per user\n- **Alert Triggers:** Count of threshold breaches\n\n## Alert Thresholds (Configurable)\n\n- Rate Limit: 100 hits in 5 minutes\n- CORS Violations: 50 blocks in 5 minutes\n- Auth Failures: 10 failures in 5 minutes\n\nAdjust these in \\`lib/security/monitoring.ts\\` as needed.\n`;\n\nconst integrationPath = join(process.cwd(), 'docs/security/MONITORING_INTEGRATION.md');\nwriteFileSync(integrationPath, integrationInstructions.trim());\nconsole.log('‚úÖ Created docs/security/MONITORING_INTEGRATION.md');\n\nconsole.log('\\n‚úÖ Security monitoring configuration complete!\\n');\nconsole.log('Next steps:');\nconsole.log('1. Review .env.security.template and add values to .env.local');\nconsole.log('2. Follow docs/security/MONITORING_INTEGRATION.md to integrate');\nconsole.log('3. Run pnpm tsx scripts/security/run-all-security-tests.sh');\nconsole.log('4. Set up monitoring dashboard with provided queries\\n');\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/security/fix-ip-extraction.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/security/mongodb-uri-check.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/seed-aqar-data.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/seed-aqar-properties.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/seed-auth-14users.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/seed-chart-accounts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/seed-chart-of-accounts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/seed-cms.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/seed-copilot-knowledge.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/seed-db.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/seed-demo-users.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":249,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6604,6607],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6604,6607],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env node\n/**\n * Seed demo users that match the login page credentials\n * Default passwords: superadmin uses \"admin123\", others use \"password123\"\n */\nimport { db } from '../lib/mongo';\nimport { User } from '../server/models/User';\nimport { hashPassword } from '../lib/auth';\n\nconst demoPhones = {\n  superadmin: process.env.DEMO_SUPERADMIN_PHONE || process.env.NEXTAUTH_SUPERADMIN_FALLBACK_PHONE || '+966552233456',\n  admin: process.env.DEMO_ADMIN_PHONE || '+966552233456',\n  manager: process.env.DEMO_MANAGER_PHONE || '+966552233456',\n  tenant: process.env.DEMO_TENANT_PHONE || '+966552233456',\n  vendor: process.env.DEMO_VENDOR_PHONE || '+966552233456',\n  emp001: process.env.DEMO_EMP001_PHONE || '+966552233456',\n  emp002: process.env.DEMO_EMP002_PHONE || '+966552233456',\n} as const;\n\nconst demoUsers = [\n  {\n    code: 'USR-SUPERADMIN',\n    username: 'superadmin',\n    email: 'superadmin@fixzit.co',\n    password: 'admin123',\n    phone: demoPhones.superadmin,\n    orgId: '68dc8955a1ba6ed80ff372dc',\n    personal: {\n      firstName: 'Super',\n      lastName: 'Admin',\n      phone: demoPhones.superadmin,\n      nationality: 'SA',\n      address: { country: 'SA' }\n    },\n    professional: {\n      role: 'SUPER_ADMIN',\n      title: 'Super Administrator',\n      department: 'IT',\n      skills: [],\n      licenses: [],\n      certifications: []\n    },\n    workload: {\n      workingHours: { days: [], timezone: 'Asia/Riyadh' },\n      availability: []\n    },\n    performance: { reviews: [] },\n    security: { permissions: [] },\n    employment: { benefits: [] },\n    compliance: { training: [] },\n    status: 'ACTIVE',\n    createdBy: 'seed-script'\n  },\n  {\n    code: 'USR-ADMIN',\n    username: 'admin',\n    email: 'admin@fixzit.co',\n    password: 'password123',\n    phone: demoPhones.admin,\n    // Don't set orgId/createdBy for existing user - will be updated via updateOne\n  },\n  {\n    code: 'USR-MANAGER',\n    username: 'manager',\n    email: 'manager@fixzit.co',\n    password: 'password123',\n    phone: demoPhones.manager,\n    orgId: '68dc8955a1ba6ed80ff372dc',\n    personal: {\n      firstName: 'Property',\n      lastName: 'Manager',\n      phone: demoPhones.manager,\n      nationality: 'SA',\n      address: { country: 'SA' }\n    },\n    professional: {\n      role: 'PROPERTY_MANAGER',\n      title: 'Property Manager',\n      department: 'Operations',\n      skills: [],\n      licenses: [],\n      certifications: []\n    },\n    workload: {\n      workingHours: { days: [], timezone: 'Asia/Riyadh' },\n      availability: []\n    },\n    performance: { reviews: [] },\n    security: { permissions: [] },\n    employment: { benefits: [] },\n    compliance: { training: [] },\n    status: 'ACTIVE',\n    createdBy: 'seed-script'\n  },\n  {\n    code: 'USR-TENANT',\n    username: 'tenant',\n    email: 'tenant@fixzit.co',\n    password: 'password123',\n    phone: demoPhones.tenant,\n    orgId: '68dc8955a1ba6ed80ff372dc',\n    personal: {\n      firstName: 'Demo',\n      lastName: 'Tenant',\n      phone: demoPhones.tenant,\n      nationality: 'SA',\n      address: { country: 'SA' }\n    },\n    professional: {\n      role: 'TENANT',\n      title: 'Tenant',\n      department: 'N/A',\n      skills: [],\n      licenses: [],\n      certifications: []\n    },\n    workload: {\n      workingHours: { days: [], timezone: 'Asia/Riyadh' },\n      availability: []\n    },\n    performance: { reviews: [] },\n    security: { permissions: [] },\n    employment: { benefits: [] },\n    compliance: { training: [] },\n    status: 'ACTIVE',\n    createdBy: 'seed-script'\n  },\n  {\n    code: 'USR-VENDOR',\n    username: 'vendor',\n    email: 'vendor@fixzit.co',\n    password: 'password123',\n    phone: demoPhones.vendor,\n    orgId: '68dc8955a1ba6ed80ff372dc',\n    personal: {\n      firstName: 'Demo',\n      lastName: 'Vendor',\n      phone: demoPhones.vendor,\n      nationality: 'SA',\n      address: { country: 'SA' }\n    },\n    professional: {\n      role: 'VENDOR',\n      title: 'Vendor',\n      department: 'N/A',\n      skills: [],\n      licenses: [],\n      certifications: []\n    },\n    workload: {\n      workingHours: { days: [], timezone: 'Asia/Riyadh' },\n      availability: []\n    },\n    performance: { reviews: [] },\n    security: { permissions: [] },\n    employment: { benefits: [] },\n    compliance: { training: [] },\n    status: 'ACTIVE',\n    createdBy: 'seed-script'\n  },\n  {\n    code: 'EMP001',\n    username: 'EMP001',\n    email: 'emp001@fixzit.co',\n    password: 'password123',\n    phone: demoPhones.emp001,\n    orgId: '68dc8955a1ba6ed80ff372dc',\n    personal: {\n      firstName: 'Employee',\n      lastName: 'One',\n      phone: demoPhones.emp001,\n      nationality: 'SA',\n      address: { country: 'SA' }\n    },\n    professional: {\n      role: 'EMPLOYEE',\n      title: 'Corporate Employee',\n      department: 'Operations',\n      skills: [],\n      licenses: [],\n      certifications: []\n    },\n    workload: {\n      workingHours: { days: [], timezone: 'Asia/Riyadh' },\n      availability: []\n    },\n    performance: { reviews: [] },\n    security: { permissions: [] },\n    employment: { benefits: [] },\n    compliance: { training: [] },\n    status: 'ACTIVE',\n    createdBy: 'seed-script'\n  },\n  {\n    code: 'EMP002',\n    username: 'EMP002',\n    email: 'emp002@fixzit.co',\n    password: 'password123',\n    phone: demoPhones.emp002,\n    orgId: '68dc8955a1ba6ed80ff372dc',\n    personal: {\n      firstName: 'Employee',\n      lastName: 'Two',\n      phone: demoPhones.emp002,\n      nationality: 'SA',\n      address: { country: 'SA' }\n    },\n    professional: {\n      role: 'EMPLOYEE',\n      title: 'Corporate Employee',\n      department: 'Operations',\n      skills: [],\n      licenses: [],\n      certifications: []\n    },\n    workload: {\n      workingHours: { days: [], timezone: 'Asia/Riyadh' },\n      availability: []\n    },\n    performance: { reviews: [] },\n    security: { permissions: [] },\n    employment: { benefits: [] },\n    compliance: { training: [] },\n    status: 'ACTIVE',\n    createdBy: 'seed-script'\n  }\n];\n\nasync function seedDemoUsers() {\n  try {\n    await db;\n    console.log('üå± Seeding demo users...\\n');\n    \n    let created = 0;\n    let updated = 0;\n    let skipped = 0;\n    \n    for (const userData of demoUsers) {\n      const existingUser = await User.findOne({ email: userData.email });\n      \n      const hashedPassword = await hashPassword(userData.password);\n      const userWithHashedPassword = {\n        ...userData,\n        password: hashedPassword\n      };\n      \n      if (existingUser) {\n        // Update existing user's password using direct MongoDB update to skip validation\n        const updateFields: Record<string, any> = {\n          password: hashedPassword,\n          status: 'ACTIVE',\n          username: userData.username\n        };\n\n        if (userData.phone) {\n          updateFields.phone = userData.phone;\n        }\n        if (userData.personal?.phone) {\n          updateFields['personal.phone'] = userData.personal.phone;\n        }\n\n        await User.updateOne(\n          { _id: existingUser._id },\n          {\n            $set: updateFields\n          }\n        );\n        console.log(`‚úÖ Updated user: ${userData.email} (password updated)`);\n        updated++;\n      } else {\n        try {\n          await User.create(userWithHashedPassword);\n          console.log(`‚úÖ Created user: ${userData.email} (${userData.professional?.role || 'user'})`);\n          created++;\n        } catch (error: unknown) {\n          const duplicate =\n            typeof error === 'object' && error !== null\n              ? (error as { code?: number })\n              : undefined;\n          if (duplicate?.code === 11000) {\n            console.log(`‚è≠Ô∏è  User already exists: ${userData.email}`);\n            skipped++;\n          } else {\n            const message = error instanceof Error ? error.message : String(error);\n            console.error(`‚ùå Error creating ${userData.email}:`, message);\n          }\n        }\n      }\n    }\n    \n    console.log('\\nüìä Summary:');\n    console.log(`   Created: ${created}`);\n    console.log(`   Updated: ${updated}`);\n    console.log(`   Skipped: ${skipped}`);\n    console.log('   Total:   ' + (created + updated + skipped));\n    console.log('\\n‚úÖ Demo user seeding completed!');\n    console.log('\\nüìù Login credentials:');\n    console.log('   Personal:  superadmin@fixzit.co / admin123');\n    console.log('   Personal:  admin@fixzit.co / password123');\n    console.log('   Personal:  manager@fixzit.co / password123');\n    console.log('   Personal:  tenant@fixzit.co / password123');\n    console.log('   Personal:  vendor@fixzit.co / password123');\n    console.log('   Corporate: EMP001 / password123');\n    console.log('   Corporate: EMP002 / password123');\n    \n    process.exit(0);\n  } catch (error) {\n    console.error('‚ùå Error seeding demo users:', error);\n    process.exit(1);\n  }\n}\n\nseedDemoUsers();\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/seed-direct.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/seed-marketplace-shared.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'error' is not defined.","line":34,"column":21,"nodeType":"Identifier","messageId":"undef","endLine":34,"endColumn":26},{"ruleId":"no-undef","severity":2,"message":"'error' is not defined.","line":34,"column":46,"nodeType":"Identifier","messageId":"undef","endLine":34,"endColumn":51},{"ruleId":"no-undef","severity":2,"message":"'error' is not defined.","line":34,"column":69,"nodeType":"Identifier","messageId":"undef","endLine":34,"endColumn":74},{"ruleId":"no-undef","severity":2,"message":"'error' is not defined.","line":145,"column":23,"nodeType":"Identifier","messageId":"undef","endLine":145,"endColumn":28},{"ruleId":"no-undef","severity":2,"message":"'error' is not defined.","line":145,"column":48,"nodeType":"Identifier","messageId":"undef","endLine":145,"endColumn":53},{"ruleId":"no-undef","severity":2,"message":"'error' is not defined.","line":145,"column":71,"nodeType":"Identifier","messageId":"undef","endLine":145,"endColumn":76},{"ruleId":"no-undef","severity":2,"message":"'tsError' is not defined.","line":159,"column":29,"nodeType":"Identifier","messageId":"undef","endLine":159,"endColumn":36},{"ruleId":"no-undef","severity":2,"message":"'tsError' is not defined.","line":159,"column":56,"nodeType":"Identifier","messageId":"undef","endLine":159,"endColumn":63},{"ruleId":"no-undef","severity":2,"message":"'tsError' is not defined.","line":159,"column":81,"nodeType":"Identifier","messageId":"undef","endLine":159,"endColumn":88}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const fs = require('node:fs');\nconst Module = require('module');\nconst path = require('node:path');\nconst { randomUUID } = require('node:crypto');\nconst { createRequire } = require('node:module');\n\n// Define marketplace collection names inline\nconst MARKETPLACE_COLLECTIONS = {\n  PRODUCTS: 'marketplace_products',\n  CATEGORIES: 'marketplace_categories',\n  BRANDS: 'marketplace_brands',\n  REVIEWS: 'marketplace_reviews',\n  SEARCH_SYNONYMS: 'searchsynonyms',\n};\n\nconst localRequire = createRequire(__filename);\nconst compiledTsCache = new Map();\n\nconst logWarn = (message) => {\n  process.stderr.write(`${message}\\n`);\n};\n\nfunction loadTypeScriptModule(tsPath) {\n  const absolutePath = path.resolve(tsPath);\n\n  if (compiledTsCache.has(absolutePath)) {\n    return compiledTsCache.get(absolutePath);\n  }\n\n  let typescript;\n  try {\n    typescript = localRequire('typescript');\n  } catch (_error) {\n    const message = error instanceof Error ? error.message : String(error);\n    throw new Error(`Unable to load TypeScript compiler. Install dependencies first. Original error: ${message}`);\n  }\n\n  const source = fs.readFileSync(absolutePath, 'utf8');\n  const { outputText } = typescript.transpileModule(source, {\n    compilerOptions: {\n      module: typescript.ModuleKind.CommonJS,\n      target: typescript.ScriptTarget.ES2019,\n      esModuleInterop: true,\n    },\n    fileName: absolutePath,\n    reportDiagnostics: false,\n  });\n\n  const moduleInstance = new Module(absolutePath, module);\n  moduleInstance.filename = absolutePath;\n  moduleInstance.paths = Module._nodeModulePaths(path.dirname(absolutePath));\n  moduleInstance._compile(outputText, absolutePath);\n\n  compiledTsCache.set(absolutePath, moduleInstance.exports);\n  return moduleInstance.exports;\n}\n\nconst DEFAULT_TENANT_FALLBACK = 'demo-tenant';\n\nconst DEFAULT_TENANT_ID = (() => {\n  const envValue = process.env.MARKETPLACE_DEFAULT_TENANT;\n  if (typeof envValue !== 'string' || envValue.trim().length === 0) {\n    return DEFAULT_TENANT_FALLBACK;\n  }\n\n  const trimmed = envValue.trim();\n  // Tenant ID must be 3-50 characters long and contain only letters (A-Z, a-z), digits (0-9), underscores (_), or hyphens (-).\n  const isValid = /^[A-Za-z0-9_-]{3,50}$/.test(trimmed);\n\n  if (!isValid) {\n    logWarn(\n      `[MarketplaceSeed] Invalid MARKETPLACE_DEFAULT_TENANT value \"${envValue}\". Falling back to \"${DEFAULT_TENANT_FALLBACK}\".`\n    );\n    return DEFAULT_TENANT_FALLBACK;\n  }\n\n  return trimmed;\n})();\n\nconst COLLECTIONS = MARKETPLACE_COLLECTIONS;\n\nfunction normalizeDocument(doc) {\n  if (!doc || typeof doc !== 'object') {\n    return {};\n  }\n  return { ...doc };\n}\n\nfunction createUpsert(db) {\n  if (!db || typeof db.getCollection !== 'function' || typeof db.setCollection !== 'function') {\n    throw new Error('Mock database instance must expose getCollection/setCollection');\n  }\n\n  return function upsert(collection, predicate, doc) {\n    const data = db.getCollection(collection);\n    const idx = data.findIndex(predicate);\n    const timestamp = Date.now();\n    const normalizedDoc = normalizeDocument(doc);\n\n    // Surface predicate errors even when the collection is empty so callers can catch issues early.\n    predicate(normalizedDoc);\n\n    if (idx >= 0) {\n      const { _id: _ignoreId, createdAt: _ignoreCreatedAt, ...rest } = normalizedDoc;\n      const updated = { ...data[idx], ...rest, updatedAt: new Date(timestamp) };\n      data[idx] = updated;\n      db.setCollection(collection, data);\n      return updated;\n    }\n\n    const { _id: providedId, createdAt: providedCreatedAt, ...rest } = normalizedDoc;\n    const created = {\n      ...rest,\n      _id: (typeof providedId === 'string' && providedId.length > 0) ? providedId : randomUUID(),\n      createdAt: providedCreatedAt ? new Date(providedCreatedAt) : new Date(timestamp),\n      updatedAt: new Date(timestamp),\n    };\n\n    data.push(created);\n    db.setCollection(collection, data);\n    return created;\n  };\n}\n\nfunction resolveMockDatabase() {\n  const candidates = [\n    '../src/lib/mockDb.js',\n    '../src/lib/mockDb.ts',\n    '../src/lib/mockDb',\n  ];\n\n  const errors = [];\n\n  for (const candidate of candidates) {\n    try {\n      const moduleExport = localRequire(candidate);\n      if (moduleExport && moduleExport.MockDatabase) {\n        return moduleExport.MockDatabase;\n      }\n      if (moduleExport && typeof moduleExport.getInstance === 'function') {\n        return moduleExport;\n      }\n    } catch (_error) {\n      const absolutePath = path.resolve(__dirname, candidate);\n      const message = error instanceof Error ? error.message : String(error);\n\n      if (candidate.endsWith('.ts')) {\n        try {\n          const tsModule = loadTypeScriptModule(absolutePath);\n          if (tsModule && tsModule.MockDatabase) {\n            return tsModule.MockDatabase;\n          }\n          if (tsModule && typeof tsModule.getInstance === 'function') {\n            return tsModule;\n          }\n          errors.push(`${absolutePath}: module did not expose MockDatabase`);\n          continue;\n        } catch (_tsError) {\n          const tsMessage = tsError instanceof Error ? tsError.message : String(tsError);\n          errors.push(`${absolutePath}: ${tsMessage}`);\n          continue;\n        }\n      }\n\n      errors.push(`${absolutePath}: ${message}`);\n    }\n  }\n\n  throw new Error(\n    `MockDatabase implementation not found. Tried -> ${errors.join('; ')}`\n  );\n}\n\nfunction getSeedData(tenantId = DEFAULT_TENANT_ID) {\n  return {\n    synonyms: [\n      {\n        locale: 'en',\n        term: 'ac filter',\n        synonyms: ['hvac filter', 'air filter', 'ŸÅŸÑÿ™ÿ± ŸÖŸÉŸäŸÅ'],\n      },\n      {\n        locale: 'ar',\n        term: 'ÿØŸáÿßŸÜ',\n        synonyms: ['ÿ∑ŸÑÿßÿ°', 'paint', 'painter'],\n      },\n    ],\n    products: [\n      {\n        tenantId,\n        sku: 'CEM-001-50',\n        slug: 'portland-cement-type-1-2-50kg',\n        title: {\n          en: 'Portland Cement Type I/II ‚Äî 50kg',\n          ar: 'ÿ£ÿ≥ŸÖŸÜÿ™ ÿ®Ÿàÿ±ÿ™ŸÑÿßŸÜÿØ ŸÜŸàÿπ I/II ‚Äî 50 ŸÉÿ¨ŸÖ',\n        },\n        brand: 'Fixzit Materials',\n        attributes: [\n          { key: 'Standard', value: 'ASTM C150' },\n          { key: 'Type', value: 'I/II' },\n        ],\n        images: [],\n        prices: [{ currency: 'SAR', listPrice: 16.5 }],\n        inventories: [{ onHand: 200, leadDays: 2 }],\n        rating: { avg: 4.6, count: 123 },\n        searchable: {\n          en: 'Portland Cement ASTM C150 50kg Type I/II',\n          ar: 'ÿ£ÿ≥ŸÖŸÜÿ™ ÿ®Ÿàÿ±ÿ™ŸÑÿßŸÜÿØ ASTM C150 Ÿàÿ≤ŸÜ 50 ŸÉÿ¨ŸÖ ŸÜŸàÿπ I/II',\n        },\n        rtl: true,\n      },\n    ],\n  };\n}\n\nmodule.exports = {\n  DEFAULT_TENANT_ID,\n  COLLECTIONS,\n  createUpsert,\n  getSeedData,\n  resolveMockDatabase,\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/seed-marketplace.ts","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'name' is defined but never used. Allowed unused args must match /^_/u.","line":24,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":31,"suggestions":[{"messageId":"removeVar","data":{"varName":"name"},"fix":{"range":[614,626],"text":""},"desc":"Remove unused variable 'name'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'name' is defined but never used. Allowed unused args must match /^_/u.","line":25,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":31,"suggestions":[{"messageId":"removeVar","data":{"varName":"name"},"fix":{"range":[665,678],"text":""},"desc":"Remove unused variable 'name'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'data' is defined but never used. Allowed unused args must match /^_/u.","line":25,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":53,"suggestions":[{"messageId":"removeVar","data":{"varName":"data"},"fix":{"range":[677,699],"text":""},"desc":"Remove unused variable 'data'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'collection' is defined but never used. Allowed unused args must match /^_/u.","line":31,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":31,"endColumn":21,"suggestions":[{"messageId":"removeVar","data":{"varName":"collection"},"fix":{"range":[812,831],"text":""},"desc":"Remove unused variable 'collection'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'predicate' is defined but never used. Allowed unused args must match /^_/u.","line":32,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":46,"suggestions":[{"messageId":"removeVar","data":{"varName":"predicate"},"fix":{"range":[830,877],"text":""},"desc":"Remove unused variable 'predicate'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'entry' is defined but never used. Allowed unused args must match /^_/u.","line":32,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":34,"suggestions":[{"messageId":"removeVar","data":{"varName":"entry"},"fix":{"range":[846,865],"text":""},"desc":"Remove unused variable 'entry'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'doc' is defined but never used. Allowed unused args must match /^_/u.","line":33,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":33,"endColumn":20,"suggestions":[{"messageId":"removeVar","data":{"varName":"doc"},"fix":{"range":[877,898],"text":""},"desc":"Remove unused variable 'doc'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'db' is defined but never used. Allowed unused args must match /^_/u.","line":45,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":45,"endColumn":36,"suggestions":[{"messageId":"removeVar","data":{"varName":"db"},"fix":{"range":[1167,1185],"text":""},"desc":"Remove unused variable 'db'."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'tenantId' is defined but never used. Allowed unused args must match /^_/u.","line":46,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":46,"endColumn":34,"suggestions":[{"messageId":"removeVar","data":{"varName":"tenantId"},"fix":{"range":[1216,1233],"text":""},"desc":"Remove unused variable 'tenantId'."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createRequire } from 'node:module';\nimport path from 'node:path';\nimport { fileURLToPath } from 'node:url';\n\nconst require = createRequire(import.meta.url);\n\nconst logInfo = (message: string) => {\n  process.stdout.write(`${message}\\n`);\n};\n\nconst logError = (message: string, error?: unknown) => {\n  const detail =\n    error instanceof Error\n      ? ` ${error.message}${error.stack ? `\\n${error.stack}` : ''}`\n      : error\n      ? ` ${String(error)}`\n      : '';\n  process.stderr.write(`${message}${detail}\\n`);\n};\n\ntype MockDocument = Record<string, unknown>;\n\ntype MockDbInstance = {\n  getCollection: (name: string) => MockDocument[];\n  setCollection: (name: string, data: MockDocument[]) => void;\n};\n\ntype MockDbModule = { MockDatabase: { getInstance: () => MockDbInstance } };\n\ntype UpsertFn = (\n  collection: string,\n  predicate: (entry: MockDocument) => boolean,\n  doc: MockDocument\n) => MockDocument;\n\nconst {\n  DEFAULT_TENANT_ID,\n  COLLECTIONS,\n  createUpsert,\n  getSeedData,\n  resolveMockDatabase,\n} = require('./seed-marketplace-shared.js') as {\n  DEFAULT_TENANT_ID: string;\n  COLLECTIONS: { SYNONYMS: string; PRODUCTS: string };\n  createUpsert: (db: MockDbInstance) => UpsertFn;\n  getSeedData: (tenantId?: string) => {\n    synonyms: Array<Record<string, unknown>>;\n    products: Array<Record<string, unknown>>;\n  };\n  resolveMockDatabase: () => MockDbModule[\"MockDatabase\"];\n};\n\nconst MockDatabase = (globalThis as Record<string, unknown>).__FIXZIT_MARKETPLACE_DB_MOCK__\n  ? ((globalThis as Record<string, unknown>).__FIXZIT_MARKETPLACE_DB_MOCK__ as { getInstance: () => MockDbInstance })\n  : resolveMockDatabase();\n\n// Idempotent seed for demo-tenant marketplace data when using MockDB\nconst db = MockDatabase.getInstance();\n\nexport const upsert = createUpsert(db);\n\nexport async function main() {\n  const tenantId = DEFAULT_TENANT_ID;\n  const { synonyms, products } = getSeedData(tenantId);\n\n  logInfo(`[Marketplace seed] Preparing data for tenant: ${tenantId}`);\n\n  synonyms.forEach((synonym) => {\n    upsert(\n      COLLECTIONS.SEARCH_SYNONYMS ?? COLLECTIONS.SYNONYMS ?? COLLECTIONS.SEARCH_SYNONYMS,\n      (entry: Record<string, unknown>) => entry.locale === synonym.locale && entry.term === synonym.term,\n      synonym,\n    );\n  });\n\n  products.forEach((product) => {\n    const productCollection = 'marketplaceproducts';\n    upsert(\n      productCollection,\n      (entry: Record<string, unknown>) => entry.tenantId === tenantId && entry.slug === product.slug,\n      product,\n    );\n  });\n\n  logInfo('‚úî Marketplace seed complete (MockDB)');\n}\n\nexport default main;\n\nconst isDirectExecution = (() => {\n  try {\n    const thisFile = fileURLToPath(import.meta.url);\n    const entryArg = process.argv[1];\n    if (!entryArg) {\n      return false;\n    }\n    const entryPath = path.resolve(entryArg);\n    return entryPath === thisFile;\n  } catch {\n    return false;\n  }\n})();\n\nif (isDirectExecution) {\n  main().catch(error => {\n    logError('Failed to seed marketplace (MockDB)', error);\n    process.exitCode = 1;\n  });\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/seed-production-data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/seed-realdb.ts","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'Asset' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":15,"suggestions":[{"messageId":"removeVar","data":{"varName":"Asset"},"fix":{"range":[425,471],"text":""},"desc":"Remove unused variable 'Asset'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Asset' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1172,1175],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1172,1175],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":73,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3461,3464],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3461,3464],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/*\n  Seed a realistic dataset into a real MongoDB for FM smoke/E2E.\n  Usage (PowerShell):\n    $env:MONGODB_URI=\"mongodb://localhost:27017/fixzit\"; npm run seed:realdb\n*/\n\nimport { db } from '@/lib/mongo';\nimport { Property } from '@/server/models/Property';\nimport { WorkOrder } from '@/server/models/WorkOrder';\nimport { computeDueAt, computeSlaMinutes } from '@/lib/sla';\nimport { Invoice } from '@/server/models/Invoice';\nimport { Asset } from '@/server/models/Asset';\n\nasync function main() {\n  const tenantId = 'demo-tenant';\n  const actorId = 'seed-realdb';\n  await db;\n\n  // 1) Properties\n  const props = [\n    { code: 'PROP-REAL-001', name: 'Fixzit HQ Tower', type: 'COMMERCIAL', city: 'Riyadh', region: 'Riyadh', lat: 24.7136, lng: 46.6753, area: 48000, floors: 22, occ: 84 },\n    { code: 'PROP-REAL-002', name: 'Al Olaya Residential C', type: 'RESIDENTIAL', city: 'Riyadh', region: 'Riyadh', lat: 24.6937, lng: 46.7221, area: 26000, floors: 12, occ: 92 },\n    { code: 'PROP-REAL-003', name: 'Dammam Logistics Park', type: 'INDUSTRIAL', city: 'Dammam', region: 'Eastern', lat: 26.4207, lng: 50.0888, area: 78000, floors: 3, occ: 73 },\n  ];\n\n  const createdProps: any[] = [];\n  for (const p of props) {\n    const doc = await Property.findOneAndUpdate(\n      { tenantId, code: p.code },\n      {\n        $set: {\n          tenantId,\n          code: p.code,\n          name: p.name,\n          type: p.type,\n          address: { street: 'Seeded', city: p.city, region: p.region, coordinates: { lat: p.lat, lng: p.lng } },\n          details: { totalArea: p.area, builtArea: Math.round(p.area * 0.9), floors: p.floors, occupancyRate: p.occ },\n          createdBy: actorId,\n        },\n      },\n      { upsert: true, new: true }\n    );\n    createdProps.push(doc);\n  }\n\n  // 2) Assets (maintenance list tile)\n  const assetSeeds = [\n    { code: 'AST-REAL-001', name: 'Chiller A1', type: 'HVAC', propertyIndex: 0, status: 'MAINTENANCE', criticality: 'HIGH' },\n    { code: 'AST-REAL-002', name: 'Elevator #3', type: 'ELEVATOR', propertyIndex: 0, status: 'MAINTENANCE', criticality: 'MEDIUM' },\n    { code: 'AST-REAL-003', name: 'Fire Pump F2', type: 'FIRE_SYSTEM', propertyIndex: 2, status: 'MAINTENANCE', criticality: 'CRITICAL' },\n  ];\n  for (const a of assetSeeds) {\n    const propId = createdProps[a.propertyIndex]?._id?.toString() || createdProps[a.propertyIndex]?.id;\n    await Property.findOneAndUpdate(\n      { tenantId, code: a.code },\n      { $set: { tenantId, code: a.code, name: a.name, type: a.type, category: 'SEED', propertyId: propId, status: a.status, criticality: a.criticality, createdBy: actorId } },\n      { upsert: true, new: true }\n    );\n  }\n\n  // 3) Work Orders (varied priorities/status, with SLA dueAt)\n  const woSeeds = [\n    { title: 'AC not cooling ‚Äì Lvl 12', priority: 'CRITICAL', status: 'SUBMITTED', prop: 0 },\n    { title: 'Water leak ‚Äì Lobby', priority: 'HIGH', status: 'DISPATCHED', prop: 0 },\n    { title: 'Lighting replacement ‚Äì Car Park', priority: 'MEDIUM', status: 'IN_PROGRESS', prop: 0 },\n    { title: 'Gate sensor calibration', priority: 'LOW', status: 'COMPLETED', prop: 2 },\n  ];\n  for (const w of woSeeds) {\n    const seq = Math.floor((Date.now() / 1000) % 100000);\n    const code = `WO-REAL-${seq}-${Math.random().toString(36).slice(2,6).toUpperCase()}`;\n    const createdAt = new Date();\n    // TODO(type-safety): Ensure w.priority matches WorkOrderPriority enum\n    const slaMinutes = computeSlaMinutes(w.priority as any);\n    const dueAt = computeDueAt(createdAt, slaMinutes);\n    const propId = createdProps[w.prop]?._id?.toString() || createdProps[w.prop]?.id;\n    await WorkOrder.create({\n      tenantId,\n      code,\n      title: w.title,\n      description: '',\n      priority: w.priority,\n      category: 'GENERAL',\n      propertyId: propId,\n      status: w.status,\n      statusHistory: [{ from: 'DRAFT', to: w.status, byUserId: actorId, at: createdAt }],\n      slaMinutes,\n      dueAt,\n      createdBy: actorId,\n      createdAt,\n    });\n  }\n\n  // 4) Overdue invoice to light up finance tile\n  const issueDate = new Date(Date.now() - 14 * 24 * 60 * 60 * 1000);\n  const dueDate = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);\n  const invNumber = `INV-REAL-${new Date().getFullYear()}-${Math.floor(10000 + Math.random() * 89999)}`;\n  await Invoice.findOneAndUpdate(\n    { tenantId, number: invNumber },\n    {\n      $set: {\n        tenantId,\n        number: invNumber,\n        type: 'SERVICE',\n        issuer: { name: 'Fixzit FM', taxId: '3000000000', address: 'Riyadh' },\n        recipient: { name: 'Demo Tenant', address: 'Riyadh' },\n        issueDate,\n        dueDate,\n        items: [ { description: 'Emergency AC repair', quantity: 1, unitPrice: 1500, total: 1500, tax: { type: 'VAT', rate: 15, amount: 225 } } ],\n        subtotal: 1500,\n        taxes: [ { type: 'VAT', rate: 15, amount: 225 } ],\n        total: 1725,\n        currency: 'SAR',\n        status: 'OVERDUE',\n        createdBy: actorId,\n      },\n    },\n    { upsert: true, new: true }\n  );\n\n  console.log('‚úÖ Real DB seed complete (FM):', {\n    tenantId,\n    properties: createdProps.map(p => ({ id: p._id?.toString?.() || p.id, code: p.code, name: p.name })),\n  });\n}\n\nmain().then(() => process.exit(0)).catch((err) => {\n  console.error('‚ùå Real DB seed failed:', err);\n  process.exit(1);\n});\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/seed-subscriptions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/seed-test-users.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/seed-users.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/seed/souq-test-data.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":254,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":254,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8986,8989],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8986,8989],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":331,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":331,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11391,11394],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11391,11394],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":331,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":331,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11406,11409],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11406,11409],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Souq Test Data Seeding Script\n * Seeds test data for EPICs G (Analytics) and H (Reviews & Ratings)\n * \n * Usage:\n *   pnpm tsx scripts/seed/souq-test-data.ts\n * \n * This script creates:\n * - Test products (10)\n * - Test customers (20)\n * - Test orders (50) with various statuses\n * - Test reviews (100) with different ratings\n * - Historical sales data for analytics\n */\n\nimport { config } from 'dotenv';\nimport { resolve } from 'path';\n\n// Load environment variables from .env.local\nconfig({ path: resolve(process.cwd(), '.env.local') });\n\nimport { connectDb } from '@/lib/mongodb-unified';\nimport { SouqProduct } from '@/server/models/souq/Product';\nimport { SouqOrder } from '@/server/models/souq/Order';\nimport { SouqReview } from '@/server/models/souq/Review';\nimport { nanoid } from 'nanoid';\n\n// Test organization ID (replace with your actual test org ID)\nconst TEST_ORG_ID = 'org-test-001';\nconst TEST_SELLER_ID = '6740b53c5b1a08c748eec97f'; // Valid MongoDB ObjectId format\n\n// Sample product data matching the Product schema\nconst PRODUCT_TEMPLATES = [\n  {\n    title: { en: 'Premium Office Chair', ar: 'ŸÉÿ±ÿ≥Ÿä ŸÖŸÉÿ™ÿ® ŸÅÿßÿÆÿ±' },\n    description: { en: 'Ergonomic office chair with lumbar support', ar: 'ŸÉÿ±ÿ≥Ÿä ŸÖŸÉÿ™ÿ® ŸÖÿ±Ÿäÿ≠ ŸÖÿπ ÿØÿπŸÖ ŸÇÿ∑ŸÜŸä' },\n    categoryId: 'CAT-FURNITURE-001',\n    basePrice: 299.99,\n    images: ['https://placehold.co/600x400/png?text=Office+Chair'],\n  },\n  {\n    title: { en: 'Wireless Keyboard', ar: 'ŸÑŸàÿ≠ÿ© ŸÖŸÅÿßÿ™Ÿäÿ≠ ŸÑÿßÿ≥ŸÑŸÉŸäÿ©' },\n    description: { en: 'Mechanical wireless keyboard with RGB lighting', ar: 'ŸÑŸàÿ≠ÿ© ŸÖŸÅÿßÿ™Ÿäÿ≠ ŸÖŸäŸÉÿßŸÜŸäŸÉŸäÿ© ŸÑÿßÿ≥ŸÑŸÉŸäÿ© ŸÖÿπ ÿ•ÿ∂ÿßÿ°ÿ© RGB' },\n    categoryId: 'CAT-ELECTRONICS-001',\n    basePrice: 79.99,\n    images: ['https://placehold.co/600x400/png?text=Keyboard'],\n  },\n  {\n    title: { en: 'Standing Desk', ar: 'ŸÖŸÉÿ™ÿ® ŸàÿßŸÇŸÅ' },\n    description: { en: 'Height-adjustable standing desk', ar: 'ŸÖŸÉÿ™ÿ® ŸÇÿßÿ®ŸÑ ŸÑÿ™ÿπÿØŸäŸÑ ÿßŸÑÿßÿ±ÿ™ŸÅÿßÿπ' },\n    categoryId: 'CAT-FURNITURE-001',\n    basePrice: 499.99,\n    images: ['https://placehold.co/600x400/png?text=Standing+Desk'],\n  },\n  {\n    title: { en: '4K Monitor', ar: 'ÿ¥ÿßÿ¥ÿ© 4K' },\n    description: { en: '27-inch 4K IPS monitor', ar: 'ÿ¥ÿßÿ¥ÿ© 27 ÿ®Ÿàÿµÿ© 4K IPS' },\n    categoryId: 'CAT-ELECTRONICS-001',\n    basePrice: 349.99,\n    images: ['https://placehold.co/600x400/png?text=4K+Monitor'],\n  },\n  {\n    title: { en: 'Desk Lamp', ar: 'ŸÖÿµÿ®ÿßÿ≠ ŸÖŸÉÿ™ÿ®' },\n    description: { en: 'LED desk lamp with adjustable brightness', ar: 'ŸÖÿµÿ®ÿßÿ≠ LED ŸÖÿπ ÿ≥ÿ∑Ÿàÿπ ŸÇÿßÿ®ŸÑ ŸÑŸÑÿ™ÿπÿØŸäŸÑ' },\n    categoryId: 'CAT-LIGHTING-001',\n    basePrice: 39.99,\n    images: ['https://placehold.co/600x400/png?text=Desk+Lamp'],\n  },\n  {\n    title: { en: 'Laptop Stand', ar: 'ÿ≠ÿßŸÖŸÑ ŸÑÿßÿ®ÿ™Ÿàÿ®' },\n    description: { en: 'Aluminum laptop stand with cooling', ar: 'ÿ≠ÿßŸÖŸÑ ŸÑÿßÿ®ÿ™Ÿàÿ® ÿ£ŸÑŸÖŸÜŸäŸàŸÖ ŸÖÿπ ÿ™ÿ®ÿ±ŸäÿØ' },\n    categoryId: 'CAT-ACCESSORIES-001',\n    basePrice: 49.99,\n    images: ['https://placehold.co/600x400/png?text=Laptop+Stand'],\n  },\n  {\n    title: { en: 'Webcam HD', ar: 'ŸÉÿßŸÖŸäÿ±ÿß ŸàŸäÿ® ÿπÿßŸÑŸäÿ© ÿßŸÑÿØŸÇÿ©' },\n    description: { en: '1080p HD webcam with auto-focus', ar: 'ŸÉÿßŸÖŸäÿ±ÿß ŸàŸäÿ® 1080p ŸÖÿπ ÿ™ÿ±ŸÉŸäÿ≤ ÿ™ŸÑŸÇÿßÿ¶Ÿä' },\n    categoryId: 'CAT-ELECTRONICS-001',\n    basePrice: 89.99,\n    images: ['https://placehold.co/600x400/png?text=Webcam'],\n  },\n  {\n    title: { en: 'Mouse Pad', ar: 'ŸÖÿßŸàÿ≥ ÿ®ÿßÿØ' },\n    description: { en: 'Large gaming mouse pad', ar: 'ŸÖÿßŸàÿ≥ ÿ®ÿßÿØ ŸÉÿ®Ÿäÿ± ŸÑŸÑÿ£ŸÑÿπÿßÿ®' },\n    categoryId: 'CAT-ACCESSORIES-001',\n    basePrice: 19.99,\n    images: ['https://placehold.co/600x400/png?text=Mouse+Pad'],\n  },\n  {\n    title: { en: 'Headphone Stand', ar: 'ÿ≠ÿßŸÖŸÑ ÿ≥ŸÖÿßÿπÿßÿ™' },\n    description: { en: 'RGB headphone stand with USB hub', ar: 'ÿ≠ÿßŸÖŸÑ ÿ≥ŸÖÿßÿπÿßÿ™ RGB ŸÖÿπ USB hub' },\n    categoryId: 'CAT-ACCESSORIES-001',\n    basePrice: 24.99,\n    images: ['https://placehold.co/600x400/png?text=Headphone+Stand'],\n  },\n  {\n    title: { en: 'Cable Management Box', ar: 'ÿµŸÜÿØŸàŸÇ ÿ™ŸÜÿ∏ŸäŸÖ ÿßŸÑŸÉÿßÿ®ŸÑÿßÿ™' },\n    description: { en: 'Cable organizer box', ar: 'ÿµŸÜÿØŸàŸÇ ŸÖŸÜÿ∏ŸÖ ŸÑŸÑŸÉÿßÿ®ŸÑÿßÿ™' },\n    categoryId: 'CAT-ACCESSORIES-001',\n    basePrice: 29.99,\n    images: ['https://placehold.co/600x400/png?text=Cable+Box'],\n  },\n];\n\n// Sample customer names\nconst CUSTOMER_NAMES = [\n  'Ahmed Al-Rashid',\n  'Fatima Hassan',\n  'Mohammed Ali',\n  'Sarah Abdullah',\n  'Omar Khalid',\n  'Noura Ibrahim',\n  'Khalid Mansoor',\n  'Layla Ahmed',\n  'Youssef Fahad',\n  'Maryam Sultan',\n  'Abdullah Nasser',\n  'Aisha Mohammed',\n  'Hassan Ali',\n  'Zainab Khalid',\n  'Faisal Ahmed',\n  'Huda Ibrahim',\n  'Tariq Rashid',\n  'Nadia Hassan',\n  'Saeed Abdullah',\n  'Reem Fahad',\n];\n\n// Review title templates\nconst REVIEW_TITLES = [\n  'Excellent quality product!',\n  'Great value for money',\n  'Highly recommend this product',\n  'Exceeded my expectations',\n  'Good but could be better',\n  'Not what I expected',\n  'Perfect for my needs',\n  'Amazing product',\n  'Decent product overall',\n  'Outstanding quality',\n  'Worth every penny',\n  'Very satisfied with purchase',\n  'Could use some improvements',\n  'Fantastic product!',\n  'Good product, fast delivery',\n];\n\n// Review content templates (positive)\nconst POSITIVE_REVIEWS = [\n  'This product has been amazing. The quality is top-notch and it works exactly as described. I have been using it for a few weeks now and I am very satisfied with my purchase. Highly recommended!',\n  'I am extremely happy with this purchase. The product arrived quickly and was exactly what I needed. The quality exceeded my expectations and I would definitely buy from this seller again.',\n  'Outstanding product! The build quality is excellent and it has made a significant difference in my daily work. The seller was also very responsive to my questions before purchasing.',\n  'Great value for the price. The product is well-made and functions perfectly. I compared several similar products before choosing this one and I am glad I did. Excellent choice!',\n  'This exceeded all my expectations. The quality is superb and it looks even better in person. The packaging was also very secure and professional. Will be ordering more from this seller.',\n];\n\n// Review content templates (neutral)\nconst NEUTRAL_REVIEWS = [\n  'The product is okay. It works as described but nothing exceptional. The price point is reasonable but I expected slightly better quality for the cost. Still a decent purchase overall.',\n  'Decent product for the price. It does what it is supposed to do but there is room for improvement. The delivery was fast and the seller was professional in their communication.',\n  'Average quality product. It meets basic expectations but could use some improvements in design and materials. For the price, it is acceptable but not outstanding.',\n];\n\n// Review content templates (negative)\nconst NEGATIVE_REVIEWS = [\n  'Unfortunately, this product did not meet my expectations. The quality is lower than what was advertised and it does not function as smoothly as I hoped. I am disappointed with this purchase.',\n  'Not satisfied with this purchase. The product arrived with some minor defects and the overall quality is not what I expected based on the description and price point.',\n];\n\n// Pros and cons\nconst PROS_OPTIONS = [\n  'Excellent build quality',\n  'Fast delivery',\n  'Great customer service',\n  'Easy to use',\n  'Good value for money',\n  'Durable materials',\n  'Stylish design',\n  'Comfortable',\n  'Well-packaged',\n  'Exactly as described',\n];\n\nconst CONS_OPTIONS = [\n  'Slightly expensive',\n  'Could be more durable',\n  'Instructions unclear',\n  'Takes time to set up',\n  'Packaging could be better',\n  'Limited color options',\n  'No warranty included',\n];\n\n/**\n * Generate random date within last N days\n */\nfunction randomDateWithinDays(days: number): Date {\n  const now = new Date();\n  const pastDate = new Date(now.getTime() - days * 24 * 60 * 60 * 1000);\n  const randomTime = pastDate.getTime() + Math.random() * (now.getTime() - pastDate.getTime());\n  return new Date(randomTime);\n}\n\n/**\n * Generate random array subset\n */\nfunction randomSubset<T>(array: T[], count: number): T[] {\n  const shuffled = [...array].sort(() => Math.random() - 0.5);\n  return shuffled.slice(0, count);\n}\n\n/**\n * Seed test products\n */\nasync function seedProducts() {\n  console.log('üå± Seeding products...');\n  \n  const products = [];\n  \n  for (let i = 0; i < PRODUCT_TEMPLATES.length; i++) {\n    const template = PRODUCT_TEMPLATES[i];\n    const fsin = `FSIN-${nanoid(10).toUpperCase()}`;\n    \n    products.push({\n      fsin,\n      title: template.title,\n      description: template.description,\n      categoryId: template.categoryId,\n      images: template.images,\n      isActive: true,\n      hasVariations: false,\n      attributes: {},\n      complianceFlags: [],\n      createdBy: TEST_SELLER_ID,\n      createdAt: randomDateWithinDays(180),\n      updatedAt: new Date(),\n    });\n  }\n  \n  // Clear existing test products\n  await SouqProduct.deleteMany({ createdBy: TEST_SELLER_ID });\n  \n  // Insert new products\n  const insertedProducts = await SouqProduct.insertMany(products);\n  console.log(`‚úÖ Created ${insertedProducts.length} products`);\n  \n  return insertedProducts;\n}\n\n/**\n * Seed test orders\n */\nasync function seedOrders(products: any[]) {\n  console.log('üå± Seeding orders...');\n  \n  const orders = [];\n  const orderStatuses = ['pending', 'confirmed', 'processing', 'shipped', 'delivered', 'completed'];\n  \n  for (let i = 0; i < 50; i++) {\n    const customerId = `CUST-${nanoid(10).toUpperCase()}`;\n    const customerName = CUSTOMER_NAMES[Math.floor(Math.random() * CUSTOMER_NAMES.length)];\n    const orderId = `ORD-${nanoid(10).toUpperCase()}`;\n    \n    // Random 1-3 items per order\n    const itemCount = Math.floor(Math.random() * 3) + 1;\n    const orderProducts = randomSubset(products, itemCount);\n    \n    const items = orderProducts.map(product => {\n      const quantity = Math.floor(Math.random() * 3) + 1;\n      return {\n        fsin: product.fsin,\n        productId: product.productId,\n        productName: product.name,\n        quantity,\n        price: product.price,\n        subtotal: product.price * quantity,\n      };\n    });\n    \n    const subtotal = items.reduce((sum, item) => sum + item.subtotal, 0);\n    const tax = subtotal * 0.15; // 15% tax\n    const total = subtotal + tax;\n    \n    // Older orders are more likely to be delivered\n    const orderAge = Math.random() * 90;\n    let status;\n    if (orderAge > 60) status = orderStatuses[5]; // completed\n    else if (orderAge > 40) status = orderStatuses[4]; // delivered\n    else if (orderAge > 20) status = orderStatuses[3]; // shipped\n    else if (orderAge > 10) status = orderStatuses[2]; // processing\n    else if (orderAge > 5) status = orderStatuses[1]; // confirmed\n    else status = orderStatuses[0]; // pending\n    \n    orders.push({\n      orderId,\n      org_id: TEST_ORG_ID,\n      sellerId: TEST_SELLER_ID,\n      customerId,\n      customerName,\n      items,\n      subtotal,\n      tax,\n      total,\n      status,\n      paymentStatus: status === 'pending' ? 'pending' : 'paid',\n      shippingAddress: {\n        street: '123 Test Street',\n        city: 'Riyadh',\n        country: 'Saudi Arabia',\n        postalCode: '12345',\n      },\n      createdAt: randomDateWithinDays(orderAge),\n      updatedAt: new Date(),\n    });\n  }\n  \n  // Clear existing test orders\n  await SouqOrder.deleteMany({ org_id: TEST_ORG_ID });\n  \n  // Insert new orders\n  const insertedOrders = await SouqOrder.insertMany(orders);\n  console.log(`‚úÖ Created ${insertedOrders.length} orders`);\n  \n  return insertedOrders;\n}\n\n/**\n * Seed test reviews\n */\nasync function seedReviews(products: any[], orders: any[]) {\n  console.log('üå± Seeding reviews...');\n  \n  const reviews = [];\n  \n  // Get delivered/completed orders for verified reviews\n  const deliveredOrders = orders.filter(o => \n    o.status === 'delivered' || o.status === 'completed'\n  );\n  \n  // Create reviews for about 60% of delivered orders\n  const reviewCount = Math.floor(deliveredOrders.length * 0.6);\n  const ordersToReview = randomSubset(deliveredOrders, reviewCount);\n  \n  for (const order of ordersToReview) {\n    // Review one random item from the order\n    const item = order.items[Math.floor(Math.random() * order.items.length)];\n    \n    // Random rating (weighted toward positive)\n    const rand = Math.random();\n    let rating;\n    if (rand < 0.5) rating = 5; // 50% 5-star\n    else if (rand < 0.75) rating = 4; // 25% 4-star\n    else if (rand < 0.85) rating = 3; // 10% 3-star\n    else if (rand < 0.95) rating = 2; // 10% 2-star\n    else rating = 1; // 5% 1-star\n    \n    // Select review content based on rating\n    let content, pros, cons;\n    if (rating >= 4) {\n      content = POSITIVE_REVIEWS[Math.floor(Math.random() * POSITIVE_REVIEWS.length)];\n      pros = randomSubset(PROS_OPTIONS, Math.floor(Math.random() * 3) + 2);\n      cons = Math.random() < 0.3 ? randomSubset(CONS_OPTIONS, 1) : [];\n    } else if (rating === 3) {\n      content = NEUTRAL_REVIEWS[Math.floor(Math.random() * NEUTRAL_REVIEWS.length)];\n      pros = randomSubset(PROS_OPTIONS, Math.floor(Math.random() * 2) + 1);\n      cons = randomSubset(CONS_OPTIONS, Math.floor(Math.random() * 2) + 1);\n    } else {\n      content = NEGATIVE_REVIEWS[Math.floor(Math.random() * NEGATIVE_REVIEWS.length)];\n      pros = Math.random() < 0.3 ? randomSubset(PROS_OPTIONS, 1) : [];\n      cons = randomSubset(CONS_OPTIONS, Math.floor(Math.random() * 3) + 2);\n    }\n    \n    const reviewId = `REV-${nanoid(10).toUpperCase()}`;\n    \n    reviews.push({\n      reviewId,\n      org_id: TEST_ORG_ID,\n      productId: item.productId,\n      fsin: item.fsin,\n      customerId: order.customerId,\n      customerName: order.customerName,\n      orderId: order.orderId,\n      rating,\n      title: REVIEW_TITLES[Math.floor(Math.random() * REVIEW_TITLES.length)],\n      content,\n      pros,\n      cons,\n      isVerifiedPurchase: true,\n      status: 'published',\n      helpful: Math.floor(Math.random() * 20),\n      notHelpful: Math.floor(Math.random() * 5),\n      reportedCount: 0,\n      createdAt: new Date(order.createdAt.getTime() + 7 * 24 * 60 * 60 * 1000), // 7 days after order\n      updatedAt: new Date(),\n    });\n  }\n  \n  // Also add some non-verified reviews\n  const nonVerifiedCount = Math.floor(reviewCount * 0.2);\n  for (let i = 0; i < nonVerifiedCount; i++) {\n    const product = products[Math.floor(Math.random() * products.length)];\n    const rating = Math.floor(Math.random() * 5) + 1;\n    \n    let content;\n    if (rating >= 4) content = POSITIVE_REVIEWS[Math.floor(Math.random() * POSITIVE_REVIEWS.length)];\n    else if (rating === 3) content = NEUTRAL_REVIEWS[Math.floor(Math.random() * NEUTRAL_REVIEWS.length)];\n    else content = NEGATIVE_REVIEWS[Math.floor(Math.random() * NEGATIVE_REVIEWS.length)];\n    \n    reviews.push({\n      reviewId: `REV-${nanoid(10).toUpperCase()}`,\n      org_id: TEST_ORG_ID,\n      productId: product.productId,\n      fsin: product.fsin,\n      customerId: `CUST-${nanoid(10).toUpperCase()}`,\n      customerName: CUSTOMER_NAMES[Math.floor(Math.random() * CUSTOMER_NAMES.length)],\n      rating,\n      title: REVIEW_TITLES[Math.floor(Math.random() * REVIEW_TITLES.length)],\n      content,\n      isVerifiedPurchase: false,\n      status: 'published',\n      helpful: Math.floor(Math.random() * 10),\n      notHelpful: Math.floor(Math.random() * 3),\n      reportedCount: 0,\n      createdAt: randomDateWithinDays(60),\n      updatedAt: new Date(),\n    });\n  }\n  \n  // Clear existing test reviews\n  await SouqReview.deleteMany({ org_id: TEST_ORG_ID });\n  \n  // Insert new reviews\n  const insertedReviews = await SouqReview.insertMany(reviews);\n  console.log(`‚úÖ Created ${insertedReviews.length} reviews (${reviewCount} verified, ${nonVerifiedCount} non-verified)`);\n  \n  return insertedReviews;\n}\n\n/**\n * Main seed function\n */\nasync function main() {\n  try {\n    console.log('üöÄ Starting Souq test data seeding...\\n');\n    \n    // Connect to database\n    await connectDb();\n    console.log('‚úÖ Connected to database\\n');\n    \n    // Seed data\n    const products = await seedProducts();\n    console.log('');\n    \n    const orders = await seedOrders(products);\n    console.log('');\n    \n    const reviews = await seedReviews(products, orders);\n    console.log('');\n    \n    // Summary\n    console.log('üìä Seeding Summary:');\n    console.log(`   - Products: ${products.length}`);\n    console.log(`   - Orders: ${orders.length}`);\n    console.log(`   - Reviews: ${reviews.length}`);\n    console.log('');\n    \n    // Calculate some stats\n    const avgRating = reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length;\n    const totalRevenue = orders.reduce((sum, o) => sum + o.total, 0);\n    \n    console.log('üìà Test Data Stats:');\n    console.log(`   - Total Revenue: ${totalRevenue.toFixed(2)} SAR`);\n    console.log(`   - Average Rating: ${avgRating.toFixed(2)} ‚≠ê`);\n    console.log(`   - Verified Reviews: ${reviews.filter(r => r.isVerifiedPurchase).length}`);\n    console.log(`   - Completed Orders: ${orders.filter(o => o.status === 'completed').length}`);\n    console.log('');\n    \n    console.log('‚úÖ Seeding completed successfully!');\n    console.log('');\n    console.log('üß™ Test Data Identifiers:');\n    console.log(`   - Organization ID: ${TEST_ORG_ID}`);\n    console.log(`   - Seller ID: ${TEST_SELLER_ID}`);\n    console.log('');\n    console.log('üí° Next Steps:');\n    console.log('   1. Login as a seller with TEST_SELLER_ID');\n    console.log('   2. Navigate to /marketplace/seller-central/analytics');\n    console.log('   3. View products at /marketplace/souq/products');\n    console.log('   4. Test review submission on product pages');\n    console.log('');\n    \n  } catch (error) {\n    console.error('‚ùå Seeding failed:', error);\n    process.exit(1);\n  } finally {\n    // Close database connection\n    process.exit(0);\n  }\n}\n\n// Run if called directly\nif (require.main === module) {\n  main();\n}\n\nexport { seedProducts, seedOrders, seedReviews };\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/seedData.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/seedMarketplace.ts","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used. Allowed unused caught errors must match /^_/u.","line":17,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used. Allowed unused caught errors must match /^_/u.","line":17,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":17}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import 'dotenv/config';\nimport path from 'path';\nimport { access } from 'fs/promises';\nimport { Types } from 'mongoose';\nimport { dbConnect } from '@/db/mongoose';\nimport Category from '@/server/models/marketplace/Category';\nimport AttributeSet from '@/server/models/marketplace/AttributeSet';\nimport Product from '@/server/models/marketplace/Product';\nimport Order from '@/server/models/marketplace/Order';\nimport RFQ from '@/server/models/marketplace/RFQ';\nimport { objectIdFrom } from '@/lib/marketplace/objectIds';\n\nasync function ensureAssetExists(relativeUrl: string) {\n  const filePath = path.join(process.cwd(), 'public', relativeUrl.replace(/^\\//, ''));\n  try {\n    await access(filePath);\n  } catch (error) {\n    throw new Error(`Marketplace seed asset missing: ${filePath}. Ensure marketplace docs and images are generated before seeding.`);\n  }\n}\n\nasync function run() {\n  await dbConnect();\n  const orgKey = process.env.MARKETPLACE_DEFAULT_TENANT || 'demo-tenant';\n  const orgId = objectIdFrom(orgKey);\n  const hvacAttrSetId = new Types.ObjectId();\n\n  await AttributeSet.updateOne(\n    { _id: hvacAttrSetId, orgId },\n    {\n      $setOnInsert: {\n        orgId,\n        title: 'HVAC Filters',\n        items: [\n          { key: 'efficiency', label: { en: 'Efficiency', ar: 'ÿßŸÑŸÉŸÅÿßÿ°ÿ©' }, unit: 'MERV', required: true },\n          { key: 'size', label: { en: 'Size', ar: 'ÿßŸÑŸÖŸÇÿßÿ≥' }, unit: 'mm' },\n          { key: 'frame', label: { en: 'Frame', ar: 'ÿßŸÑÿ•ÿ∑ÿßÿ±' } }\n        ]\n      }\n    },\n    { upsert: true }\n  );\n\n  const categories = [\n    { slug: 'electrical', name: { en: 'Electrical', ar: 'ŸÉŸáÿ±ÿ®ÿßÿ°' } },\n    { slug: 'plumbing', name: { en: 'Plumbing', ar: 'ÿ≥ÿ®ÿßŸÉÿ©' } },\n    { slug: 'hvac', name: { en: 'HVAC', ar: 'ÿ™ŸÉŸäŸäŸÅ' }, attrSetId: hvacAttrSetId },\n    { slug: 'concrete', name: { en: 'Concrete', ar: 'ÿÆÿ±ÿ≥ÿßŸÜÿ©' } },\n    { slug: 'paints', name: { en: 'Paints', ar: 'ÿØŸáÿßŸÜÿßÿ™' } },\n    { slug: 'ppe', name: { en: 'PPE', ar: 'ŸÖÿπÿØÿßÿ™ ÿßŸÑŸàŸÇÿßŸäÿ©' } },\n    { slug: 'tools', name: { en: 'Tools', ar: 'ÿ£ÿØŸàÿßÿ™' } }\n  ];\n\n  for (const category of categories) {\n    await Category.updateOne(\n      { orgId, slug: category.slug },\n      {\n        $set: {\n          ...category,\n          orgId\n        }\n      },\n      { upsert: true }\n    );\n  }\n\n  const hvacCategory = await Category.findOne({ orgId, slug: 'hvac' });\n  const ppeCategory = await Category.findOne({ orgId, slug: 'ppe' });\n\n  if (!hvacCategory || !ppeCategory) {\n    throw new Error('Required categories missing after seed');\n  }\n\n  await Promise.all([\n    ensureAssetExists('/images/marketplace/hvac-filter.svg'),\n    ensureAssetExists('/docs/msds/merv13.pdf'),\n    ensureAssetExists('/images/marketplace/nitrile-gloves.svg'),\n    ensureAssetExists('/docs/msds/nitrile-gloves.pdf')\n  ]);\n\n  await Product.updateOne(\n    { orgId, sku: 'HVAC-FLTR-MERV13-24x24' },\n    {\n      $set: {\n        orgId,\n        categoryId: hvacCategory._id,\n        slug: 'merv13-filter-24x24',\n        title: {\n          en: 'MERV 13 Air Filter 24x24in',\n          ar: 'ŸÅŸÑÿ™ÿ± ŸáŸàÿßÿ° MERV 13 ŸÖŸÇÿßÿ≥ 24x24'\n        },\n        summary: 'High efficiency HVAC filter meeting ASHRAE 52.2 standard',\n        brand: 'FiltrationPro',\n        standards: ['ASHRAE 52.2', 'EN 779 (M6/F7)'],\n        specs: {\n          efficiency: 'MERV 13',\n          size: '610x610x25',\n          frame: 'Galvanized steel'\n        },\n        media: [\n          { url: '/images/marketplace/hvac-filter.svg', role: 'GALLERY' },\n          { url: '/docs/msds/merv13.pdf', role: 'MSDS', title: 'MSDS' }\n        ],\n        buy: { price: 38, currency: 'SAR', uom: 'ea', leadDays: 2, minQty: 1 },\n        stock: { onHand: 120, reserved: 12, location: 'Riyadh DC' },\n        rating: { avg: 4.6, count: 18 },\n        status: 'ACTIVE'\n      }\n    },\n    { upsert: true }\n  );\n\n  await Product.updateOne(\n    { orgId, sku: 'PPE-NITRILE-GLOVE-XL' },\n    {\n      $set: {\n        orgId,\n        categoryId: ppeCategory._id,\n        slug: 'nitrile-gloves-xl',\n        title: {\n          en: 'Nitrile Gloves (Powder Free) - XL',\n          ar: 'ŸÇŸÅÿßÿ≤ÿßÿ™ ŸÜÿßŸäÿ™ÿ±ÿßŸäŸÑ ÿ®ÿØŸàŸÜ ÿ®ŸàÿØÿ±ÿ© - ÿ≠ÿ¨ŸÖ ŸÉÿ®Ÿäÿ±'\n        },\n        summary: 'Industrial-grade blue nitrile gloves compliant with EN374',\n        brand: 'SafeHands',\n        standards: ['EN 374', 'ASTM D6319'],\n        specs: {\n          thickness: '6 mil',\n          color: 'Blue',\n          packaging: 'Box of 100'\n        },\n        media: [\n          { url: '/images/marketplace/nitrile-gloves.svg', role: 'GALLERY' },\n          { url: '/docs/msds/nitrile-gloves.pdf', role: 'MSDS', title: 'MSDS' }\n        ],\n        buy: { price: 68, currency: 'SAR', uom: 'box', leadDays: 3, minQty: 2 },\n        stock: { onHand: 240, reserved: 30, location: 'Jeddah Hub' },\n        rating: { avg: 4.8, count: 42 },\n        status: 'ACTIVE'\n      }\n    },\n    { upsert: true }\n  );\n\n  await Order.deleteMany({ orgId });\n  await RFQ.deleteMany({ orgId });\n\n  console.log('Marketplace seed complete');\n  process.exit(0);\n}\n\nrun().catch((error) => {\n  console.error(error);\n  process.exit(1);\n});\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/serve-frontend.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/server-broken.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/server-fixed.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/server.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'path' is not defined.","line":271,"column":16,"nodeType":"Identifier","messageId":"undef","endLine":271,"endColumn":20}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// FIXZIT SOUQ - Updated Security Infrastructure\nconst logger = require('./src/logger');\nconst loggingMiddleware = require('./src/middleware/logging');\nconst errorHandler = require('./src/middleware/error');\nconst { setupSecurity } = require('./src/middleware/security');\nconst _Env = require('./src/config/env');\nconst { requireEnv } = require('../lib/env');\n\nconst express = require('express');\nconst http = require('http');\nconst _path = require('path');\nconst cors = require('cors');\nconst morgan = require('morgan');\nconst { realtimeService } = require('./services/realtime');\nconst { workflowEngine } = require('./services/workflows');\n\nconst app = express();\n\n// Apply security middleware first\nsetupSecurity(app);\n\n// Add logging middleware\napp.use(loggingMiddleware);\n\n// Create HTTP server for WebSocket support\nconst server = http.createServer(app);\n\n// Security middleware - Enhanced CORS\nconst corsOptions = {\n  origin: function (origin, callback) {\n    const allowedOrigins = process.env.CORS_ORIGIN?.split(',') || [\n      'http://localhost:3000',\n      'http://localhost:5000',\n      'https://fixzit.co'\n    ];\n    if (!origin || allowedOrigins.indexOf(origin) !== -1) {\n      callback(null, true);\n    } else {\n      callback(new Error('Not allowed by CORS'));\n    }\n  },\n  credentials: true,\n  methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],\n  allowedHeaders: ['Content-Type', 'Authorization', 'X-Requested-With'],\n  exposedHeaders: ['X-Total-Count'],\n  maxAge: 86400 // 24 hours\n};\n\n// Configure trust proxy for rate limiting (SECURITY FIX)\napp.set('trust proxy', 1);\n\n// Rate limiting for API routes\nconst rateLimit = require('express-rate-limit');\nconst apiLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000, // 15 minutes\n  max: 100, // limit each IP to 100 requests per windowMs\n  message: 'Too many API requests from this IP, please try again later.',\n  standardHeaders: true,\n  legacyHeaders: false,\n  trustProxy: true\n});\n\nconst authLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000, // 15 minutes\n  max: 5, // limit each IP to 5 login requests per windowMs\n  message: 'Too many login attempts from this IP, please try again later.',\n  standardHeaders: true,\n  legacyHeaders: false,\n  trustProxy: true\n});\n\n// MongoDB sanitization - TEMPORARILY DISABLED due to middleware compatibility issue\n// We have input sanitization in our validation middleware instead\n// const mongoSanitize = require('express-mongo-sanitize');\n\n// Middleware\napp.use(cors(corsOptions));\napp.use('/api/', apiLimiter);\napp.use('/api/auth/login', authLimiter);\napp.use('/api/auth/register', authLimiter);\n// app.use(mongoSanitize()); // DISABLED - using validation middleware sanitization instead\napp.use(morgan('combined'));\napp.use(express.json({ limit: '10mb' }));\napp.use(express.urlencoded({ extended: true, limit: '10mb' }));\n\n// Serve static files\napp.use(express.static('public'));\n\n// Environment validation\nfunction ensureRequiredSecrets() {\n  try {\n    requireEnv('JWT_SECRET');\n    requireEnv('REFRESH_TOKEN_SECRET');\n  } catch (error) {\n    logger.error('Missing required environment variables for authentication', {\n      error: error instanceof Error ? error.message : String(error),\n    });\n    process.exit(1);\n  }\n}\n\nensureRequiredSecrets();\n\n// Initialize WebSocket with realtime service\nrealtimeService.establishWebSocket(server);\n\n// Mount the FIXED routes (no more try/catch blocks)\n\n// Core authentication and security\napp.use('/api/auth', require('./routes/auth'));\n\n// 5 Web Portals - COMPLETE IMPLEMENTATION\napp.use('/api/portals', require('./routes/portals'));\n\n// Enhanced Finance with ZATCA compliance\napp.use('/api/finance', require('./routes/finance'));\n\n// Search functionality for workflows and layout audit\napp.use('/api/search', require('./routes/search'));\n\n// Mount other existing routes with error handling\ntry { \n  app.use('/api/dashboard', require('./routes/dashboard')); \n  } catch(e) { logger.error('Route loading error:', e.message); }\n\ntry { \n  app.use('/api/properties', require('./routes/properties')); \n  } catch(e) { logger.error('Route loading error:', e.message); }\n\ntry { \n  app.use('/api/work-orders', require('./routes/workorders')); \n  } catch(e) { logger.error('Route loading error:', e.message); }\n\ntry { \n  app.use('/api/hr', require('./routes/hr')); \n  } catch(e) { logger.error('Route loading error:', e.message); }\n\ntry { \n  app.use('/api/administration', require('./routes/admin')); \n  } catch(e) { logger.error('Route loading error:', e.message); }\n\ntry { \n  app.use('/api/crm', require('./routes/crm')); \n  } catch(e) { logger.error('Route loading error:', e.message); }\n\ntry { \n  app.use('/api/marketplace', require('./routes/marketplace')); \n  } catch(e) { logger.error('Route loading error:', e.message); }\n\ntry { \n  app.use('/api/support', require('./routes/tickets')); \n  } catch(e) { logger.error('Route loading error:', e.message); }\n\ntry { \n  app.use('/api/compliance', require('./routes/compliance')); \n  } catch(e) { logger.error('Route loading error:', e.message); }\n\ntry { \n  app.use('/api/reports', require('./routes/reports')); \n  } catch(e) { logger.error('Route loading error:', e.message); }\n\ntry { \n  app.use('/api/system', require('./routes/system')); \n  } catch(e) { logger.error('Route loading error:', e.message); }\n\ntry { \n  app.use('/api/pm', require('./routes/pm')); \n  } catch(e) { logger.error('Route loading error:', e.message); }\n\n// API Status endpoint\napp.get('/api/status', (req, res) => {\n  const connectionStats = realtimeService.trackActiveConnections();\n  \n  res.json({\n    success: true,\n    status: 'OPERATIONAL',\n    timestamp: new Date(),\n    version: '2.0.0',\n    features: {\n      authentication: 'ENHANCED_WITH_MFA',\n      portals: '5_PORTALS_ACTIVE',\n      finance: 'ZATCA_COMPLIANT',\n      realtime: 'WEBSOCKET_ACTIVE',\n      workflows: 'ENGINE_ACTIVE'\n    },\n    connections: connectionStats,\n    backend: {\n      criticalFixes: 'APPLIED',\n      authenticationModule: 'ENHANCED',\n      financeModule: 'ZATCA_READY',\n      portalsModule: '5_PORTALS',\n      realtimeModule: 'WEBSOCKET_ACTIVE',\n      workflowsModule: 'ENGINE_READY'\n    }\n  });\n});\n\n// API Health check\napp.get('/api/health', (req, res) => {\n  res.json({\n    success: true,\n    status: 'healthy',\n    timestamp: new Date(),\n    uptime: process.uptime(),\n    memory: process.memoryUsage(),\n    services: {\n      webSocket: !!realtimeService.io,\n      workflows: !!workflowEngine,\n      auth: true,\n      finance: true,\n      portals: true\n    }\n  });\n});\n\n// Workflow test endpoints\napp.post('/api/test/tenant-request', require('./routes/auth').authenticateToken, async (req, res) => {\n  try {\n    const result = await workflowEngine.processTenantMaintenanceRequest({\n      title: req.body.title || 'Test Maintenance Request',\n      description: req.body.description || 'Test maintenance request from API',\n      priority: req.body.priority || 'MEDIUM',\n      category: req.body.category || 'GENERAL',\n      tenantId: req.user.id,\n      propertyId: req.body.propertyId || 'demo-property',\n      estimatedCost: req.body.estimatedCost || 200\n    });\n    \n    res.json({\n      success: true,\n      message: 'Tenant maintenance request workflow tested successfully',\n      result\n    });\n  } catch (error) {\n        console.error('Workflow test failed:', error);\n        res.status(500).json({ error: 'Workflow test failed' });\n  }\n});\n\n// WebSocket test endpoint\napp.post('/api/test/websocket', require('./routes/auth').authenticateToken, async (req, res) => {\n  try {\n    // Test notification\n    await realtimeService.sendNotification(req.user.id, {\n      type: 'TEST_NOTIFICATION',\n      title: 'WebSocket Test',\n      message: 'This is a test notification from the API',\n      timestamp: new Date()\n    });\n    \n    // Test broadcast\n    realtimeService.broadcastUpdate('tenant:demo-tenant', {\n      type: 'API_TEST',\n      message: 'WebSocket system test',\n      userId: req.user.id\n    });\n    \n    res.json({\n      success: true,\n      message: 'WebSocket test completed',\n      connections: realtimeService.trackActiveConnections()\n    });\n  } catch (error) {\n        console.error('WebSocket test failed:', error);\n        res.status(500).json({ error: 'WebSocket test failed' });\n  }\n});\n\n// Home route\napp.get('/', (req, res) => {\n  res.sendFile(path.join(__dirname, 'public', 'index.html'));\n});\n\n// 404 handler\napp.use((req, res) => {\n  res.status(404).json({\n    success: false,\n    error: 'Route not found',\n    path: req.originalUrl,\n    method: req.method,\n    timestamp: new Date()\n  });\n});\n\n// Use comprehensive error handler\napp.use(errorHandler);\n\n// Start server\nconst PORT = process.env.PORT || 5000;\nserver.listen(PORT, '0.0.0.0', () => {\n  logger.info(`üöÄ FIXZIT SOUQ Server running on port ${PORT}`);\n});\n\n// Graceful shutdown\nprocess.on('SIGTERM', () => {\n    server.close(() => {\n        process.exit(0);\n  });\n});\n\nmodule.exports = { app, server };\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/setup-guardrails.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/setup-indexes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/setup-production-db.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/setup-test-env.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/sidebar/snapshot_check.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/sign-paytabs-payload.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/sign-tap-payload.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/smart-merge-conflicts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/split-translations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/stop-dev.js","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used. Allowed unused caught errors must match /^_/u.","line":63,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":63,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used. Allowed unused caught errors must match /^_/u.","line":63,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":63,"endColumn":21}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env node\n/**\n * Stop Development Server Utility\n * \n * Gracefully stops the background development server started by fixzit-agent:\n * 1. Reads PID from .agent-cache/dev.pid\n * 2. Sends SIGTERM (graceful shutdown)\n * 3. Waits 5 seconds\n * 4. Sends SIGKILL (force kill) if still running\n * \n * Usage:\n *   node scripts/stop-dev.js\n *   pnpm run fixzit:agent:stop\n */\n\nconst fs = require('fs');\nconst path = require('path');\n\nconst PID_FILE = path.join(process.cwd(), '.agent-cache', 'dev.pid');\n\nasync function stopDevServer() {\n  console.log('üõë Attempting to stop development server...');\n\n  if (!fs.existsSync(PID_FILE)) {\n    console.log('‚ÑπÔ∏è  No PID file found. Development server may not be running.');\n    return;\n  }\n\n  try {\n    const pid = parseInt(fs.readFileSync(PID_FILE, 'utf-8').trim(), 10);\n\n    if (isNaN(pid)) {\n      console.error('‚ùå Invalid PID in file. Removing stale PID file.');\n      fs.unlinkSync(PID_FILE);\n      return;\n    }\n\n    console.log(`üìç Found PID: ${pid}`);\n\n    // Check if process exists\n    try {\n      process.kill(pid, 0); // Signal 0 checks if process exists without killing\n      console.log('‚úÖ Process is running. Sending SIGTERM...');\n    } catch (error) {\n      console.log('‚ÑπÔ∏è  Process not found. Removing stale PID file.', error?.message || '');\n      fs.unlinkSync(PID_FILE);\n      return;\n    }\n\n    // Send SIGTERM (graceful shutdown)\n    try {\n      process.kill(pid, 'SIGTERM');\n      console.log('‚è≥ Waiting 5 seconds for graceful shutdown...');\n\n      await sleep(5000);\n\n      // Check if process is still running\n      try {\n        process.kill(pid, 0);\n        console.log('‚ö†Ô∏è  Process still running. Sending SIGKILL...');\n        process.kill(pid, 'SIGKILL');\n        await sleep(1000);\n      } catch (error) {\n        console.log('‚úÖ Process terminated gracefully.');\n      }\n    } catch (error) {\n      if (error.code === 'ESRCH') {\n        console.log('‚úÖ Process already terminated.');\n      } else {\n        throw error;\n      }\n    }\n\n    // Clean up PID file\n    fs.unlinkSync(PID_FILE);\n    console.log('üßπ Cleaned up PID file.');\n    console.log('‚úÖ Development server stopped successfully.');\n\n  } catch (error) {\n    console.error('‚ùå Failed to stop development server:', error.message);\n    process.exit(1);\n  }\n}\n\nfunction sleep(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nstopDevServer();\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/test-all-pages.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/test-all.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[324,327],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[324,327],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env tsx\n\n/**\n * Comprehensive test script that verifies all key functionality\n */\n\nimport { execSync } from 'child_process';\nimport { verifyCore } from './verify-core';\n\nasync function testAll() {\n  console.log('üöÄ Running comprehensive tests...\\n');\n  \n  const results: { name: string; success: boolean; error?: any }[] = [];\n  \n  // Test 1: Core functionality\n  console.log('1Ô∏è‚É£ Testing core functionality...');\n  try {\n    const success = await verifyCore();\n    results.push({ name: 'Core Functionality', success });\n    console.log(success ? '‚úÖ Core tests passed\\n' : '‚ùå Core tests failed\\n');\n  } catch (error) {\n    results.push({ name: 'Core Functionality', success: false, error });\n    console.log('‚ùå Core tests failed with error:', error, '\\n');\n  }\n  \n  // Test 2: Build verification\n  console.log('2Ô∏è‚É£ Testing build process...');\n  try {\n    execSync('npm run build', { stdio: 'pipe' });\n    results.push({ name: 'Build Process', success: true });\n    console.log('‚úÖ Build test passed\\n');\n  } catch (error) {\n    results.push({ name: 'Build Process', success: false, error });\n    console.log('‚ùå Build test failed:', error, '\\n');\n  }\n  \n  // Test 3: TypeScript validation\n  console.log('3Ô∏è‚É£ Testing TypeScript validation...');\n  try {\n    execSync('npm run typecheck', { stdio: 'pipe' });\n    results.push({ name: 'TypeScript Validation', success: true });\n    console.log('‚úÖ TypeScript test passed\\n');\n  } catch (error) {\n    results.push({ name: 'TypeScript Validation', success: false, error });\n    console.log('‚ùå TypeScript test failed:', error, '\\n');\n  }\n  \n  // Test 4: Model loading verification\n  console.log('4Ô∏è‚É£ Testing model loading...');\n  try {\n    // Test all the models we fixed\n    const models = [\n      'HelpArticle', 'CmsPage', 'SupportTicket', 'Asset', 'Property', \n      'User', 'Vendor', 'Application', 'AtsSettings', 'Candidate', \n      'Employee', 'Job'\n    ];\n    \n    for (const modelName of models) {\n      const model = await import(`../src/server/models/${modelName}`);\n      if (!model[modelName]) {\n        throw new Error(`Model ${modelName} not exported correctly`);\n      }\n    }\n    \n    results.push({ name: 'Model Loading', success: true });\n    console.log('‚úÖ Model loading test passed\\n');\n  } catch (error) {\n    results.push({ name: 'Model Loading', success: false, error });\n    console.log('‚ùå Model loading test failed:', error, '\\n');\n  }\n  \n  // Summary\n  console.log('üìä Test Summary:');\n  console.log('================');\n  \n  const totalTests = results.length;\n  const passedTests = results.filter(r => r.success).length;\n  const failedTests = totalTests - passedTests;\n  \n  results.forEach(result => {\n    const status = result.success ? '‚úÖ' : '‚ùå';\n    console.log(`${status} ${result.name}`);\n    if (!result.success && result.error) {\n      console.log(`   Error: ${result.error.message || result.error}`);\n    }\n  });\n  \n  console.log(`\\nüìà Results: ${passedTests}/${totalTests} tests passed`);\n  \n  if (failedTests === 0) {\n    console.log('üéâ All tests passed! Ready to push PR updates.');\n    return true;\n  } else {\n    console.log(`‚ö†Ô∏è  ${failedTests} tests failed. Please review and fix.`);\n    return false;\n  }\n}\n\nif (require.main === module) {\n  testAll()\n    .then(success => {\n      process.exit(success ? 0 : 1);\n    })\n    .catch(error => {\n      console.error('‚ùå Fatal error during test execution:', error);\n      process.exit(1);\n    });\n}\n\nexport { testAll };\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/test-api-endpoints.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[921,924],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[921,924],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used. Allowed unused caught errors must match /^_/u.","line":63,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":63,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used. Allowed unused caught errors must match /^_/u.","line":63,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":63,"endColumn":15},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used. Allowed unused caught errors must match /^_/u.","line":98,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":98,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used. Allowed unused caught errors must match /^_/u.","line":98,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":98,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":215,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6618,6621],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6618,6621],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-unused-vars","severity":2,"message":"'responseClone' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":259,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":259,"endColumn":24,"suggestions":[{"messageId":"removeVar","data":{"varName":"responseClone"},"fix":{"range":[7786,7825],"text":""},"desc":"Remove unused variable 'responseClone'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'responseClone' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":259,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":259,"endColumn":24}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env tsx\n/**\n * API Endpoint Testing Script\n * \n * Tests critical API endpoints:\n * - Authentication (login, logout, OTP)\n * - Payments (callback with retry queue)\n * - WhatsApp notifications\n * - Finance reports (balance sheet)\n * - Work orders CRUD\n * \n * Usage:\n *   tsx scripts/test-api-endpoints.ts\n *   tsx scripts/test-api-endpoints.ts --endpoint=auth\n *   tsx scripts/test-api-endpoints.ts --verbose\n */\n\nimport { randomBytes } from 'crypto';\n\nconst BASE_URL = process.env.BASE_URL || 'http://localhost:3000';\nconst TEST_ORG_ID = process.env.TEST_ORG_ID || 'test-org-' + Date.now();\nconst VERBOSE = process.argv.includes('--verbose');\nconst ENDPOINT_FILTER = process.argv.find(arg => arg.startsWith('--endpoint='))?.split('=')[1];\n\ninterface TestResult {\n  endpoint: string;\n  method: string;\n  status: 'PASS' | 'FAIL' | 'SKIP';\n  statusCode?: number;\n  duration: number;\n  error?: string;\n  response?: any;\n}\n\nconst results: TestResult[] = [];\nlet authToken: string | null = null;\nlet testUserId: string | null = null;\nlet sessionCookie: string | null = null;\nconst allCookies: string[] = []; // Store all cookies for cookie jar\n\n// Login helper to get auth token and session cookie\nasync function authenticateTestUser() {\n  try {\n    // Use the test admin user\n    const loginData = {\n      identifier: 'admin@test.fixzit.co',\n      password: 'Test@1234',\n    };\n    \n    log('Step 1: Sending OTP...', 'INFO');\n    \n    // Step 1: Send OTP\n    const otpResponse = await fetch(`${BASE_URL}/api/auth/otp/send`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(loginData),\n    });\n    \n    const otpText = await otpResponse.text();\n    let otpResult;\n    try {\n      otpResult = JSON.parse(otpText);\n    } catch (e) {\n      log(`Failed to parse OTP response: ${otpText}`, 'ERROR');\n      return false;\n    }\n    \n    if (!otpResult.success) {\n      log(`Failed to send OTP: ${otpResult.error}`, 'WARN');\n      return false;\n    }\n    \n    // Extract OTP from response (devCode is exposed in dev mode)\n    const otp = otpResult.data?.devCode;\n    \n    if (!otp) {\n      log('OTP not available in dev mode. Skipping auth-required tests.', 'WARN');\n      return false;\n    }\n    \n    log(`Got OTP: ${otp}`, 'INFO');\n    log('Step 2: Verifying OTP...', 'INFO');\n    \n    // Step 2: Verify OTP to get otpToken\n    const verifyResponse = await fetch(`${BASE_URL}/api/auth/otp/verify`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        identifier: loginData.identifier,\n        otp,\n      }),\n    });\n    \n    const verifyText = await verifyResponse.text();\n    let verifyResult;\n    try {\n      verifyResult = JSON.parse(verifyText);\n    } catch (e) {\n      log(`Failed to parse verify response: ${verifyText}`, 'ERROR');\n      return false;\n    }\n    \n    if (!verifyResult.success) {\n      log(`Failed to verify OTP: ${verifyResult.error}`, 'WARN');\n      return false;\n    }\n    \n    const otpToken = verifyResult.data?.otpToken;\n    if (!otpToken) {\n      log('OTP token not received from verification', 'ERROR');\n      return false;\n    }\n    \n    log('Step 3: Creating NextAuth session...', 'INFO');\n    \n    // Step 3a: Get CSRF token (and receive CSRF cookie)\n    const csrfResponse = await fetch(`${BASE_URL}/api/auth/csrf`, {\n      method: 'GET',\n    });\n    \n    const csrfData = await csrfResponse.json();\n    const csrfToken = csrfData.csrfToken;\n    \n    // Store CSRF cookie\n    const csrfSetCookies = csrfResponse.headers.getSetCookie?.() || [csrfResponse.headers.get('set-cookie')].filter(Boolean);\n    if (csrfSetCookies.length > 0) {\n      allCookies.push(...csrfSetCookies);\n    }\n    \n    if (!csrfToken) {\n      log('Failed to get CSRF token', 'ERROR');\n      return false;\n    }\n    \n    if (VERBOSE) {\n      log(`Got CSRF token: ${csrfToken.substring(0, 20)}...`, 'INFO');\n      if (csrfSetCookies.length > 0) {\n        log(`Got ${csrfSetCookies.length} CSRF cookie(s)`, 'INFO');\n      }\n    }\n    \n    // Step 3b: Call NextAuth credentials provider to create session\n    // Include the CSRF cookie in the request\n    const signInResponse = await fetch(`${BASE_URL}/api/auth/callback/credentials`, {\n      method: 'POST',\n      headers: { \n        'Content-Type': 'application/x-www-form-urlencoded',\n        'Cookie': allCookies.join('; '),\n      },\n      body: new URLSearchParams({\n        identifier: loginData.identifier,\n        password: loginData.password,\n        otpToken: otpToken,\n        csrfToken: csrfToken,\n        redirect: 'false',\n        callbackUrl: `${BASE_URL}/`,\n      }).toString(),\n      redirect: 'manual', // Don't follow redirects\n    });\n    \n    // Debug: log response status and headers\n    if (VERBOSE) {\n      log(`NextAuth response status: ${signInResponse.status}`, 'INFO');\n      log(`NextAuth response headers:`, 'INFO');\n      signInResponse.headers.forEach((value, key) => {\n        log(`  ${key}: ${value}`, 'INFO');\n      });\n    }\n    \n    // Extract session cookie from Set-Cookie header\n    const signInSetCookies = signInResponse.headers.getSetCookie?.() || [signInResponse.headers.get('set-cookie')].filter(Boolean);\n    if (signInSetCookies.length === 0) {\n      log('No session cookie received from NextAuth', 'ERROR');\n      const responseText = await signInResponse.text();\n      log(`Response status: ${signInResponse.status}`, 'ERROR');\n      log(`Response body: ${responseText}`, 'ERROR');\n      return false;\n    }\n    \n    // Store all cookies (session + CSRF)\n    allCookies.push(...signInSetCookies);\n    sessionCookie = allCookies.map(c => c.split(';')[0]).join('; '); // Extract just the cookie values\n    \n    // Check if we got the session token\n    if (signInSetCookies.some(c => c.includes('authjs.session-token'))) {\n      log('Successfully authenticated test user', 'SUCCESS');\n      return true;\n    }\n    \n    log('Got cookies but no session token found', 'WARN');\n    return false;\n  } catch (error) {\n    log(`Authentication error: ${error instanceof Error ? error.message : String(error)}`, 'ERROR');\n    return false;\n  }\n}\n\n// Utility functions\nfunction log(message: string, level: 'INFO' | 'SUCCESS' | 'ERROR' | 'WARN' = 'INFO') {\n  const colors = {\n    INFO: '\\x1b[36m',    // Cyan\n    SUCCESS: '\\x1b[32m', // Green\n    ERROR: '\\x1b[31m',   // Red\n    WARN: '\\x1b[33m',    // Yellow\n  };\n  const reset = '\\x1b[0m';\n  console.log(`${colors[level]}[${level}]${reset} ${message}`);\n}\n\nasync function testEndpoint(\n  name: string,\n  method: string,\n  path: string,\n  options: {\n    body?: any;\n    headers?: Record<string, string>;\n    expectedStatus?: number;\n    requiresAuth?: boolean;\n    skipOnFilter?: boolean;\n  } = {}\n): Promise<TestResult> {\n  if (options.skipOnFilter && ENDPOINT_FILTER && !name.toLowerCase().includes(ENDPOINT_FILTER.toLowerCase())) {\n    return {\n      endpoint: name,\n      method,\n      status: 'SKIP',\n      duration: 0,\n    };\n  }\n\n  const start = Date.now();\n  const url = `${BASE_URL}${path}`;\n  \n  const headers: Record<string, string> = {\n    'Content-Type': 'application/json',\n    'x-org-id': TEST_ORG_ID,\n    ...options.headers,\n  };\n\n  if (options.requiresAuth && sessionCookie) {\n    headers['Cookie'] = sessionCookie;\n  } else if (options.requiresAuth && authToken) {\n    headers['Authorization'] = `Bearer ${authToken}`;\n  }\n\n  try {\n    if (VERBOSE) log(`Testing: ${method} ${path}`, 'INFO');\n    \n    const response = await fetch(url, {\n      method,\n      headers,\n      body: options.body ? JSON.stringify(options.body) : undefined,\n    });\n\n    const duration = Date.now() - start;\n    const statusCode = response.status;\n    \n    // Clone response before reading body to avoid \"body already read\" error\n    const responseClone = response.clone();\n    \n    let responseData;\n    try {\n      const text = await response.text();\n      try {\n        responseData = JSON.parse(text);\n      } catch {\n        responseData = text;\n      }\n    } catch {\n      responseData = null;\n    }\n\n    const expectedStatus = options.expectedStatus || 200;\n    const isSuccess = statusCode === expectedStatus || (statusCode >= 200 && statusCode < 300 && !options.expectedStatus);\n    \n    if (VERBOSE && responseData) {\n      console.log('Response:', typeof responseData === 'string' ? responseData : JSON.stringify(responseData, null, 2));\n    }\n\n    const result: TestResult = {\n      endpoint: name,\n      method,\n      status: isSuccess ? 'PASS' : 'FAIL',\n      statusCode,\n      duration,\n      response: responseData,\n    };\n\n    if (!isSuccess) {\n      result.error = `Expected ${expectedStatus}, got ${statusCode}`;\n    }\n\n    return result;\n  } catch (error) {\n    const duration = Date.now() - start;\n    return {\n      endpoint: name,\n      method,\n      status: 'FAIL',\n      duration,\n      error: error instanceof Error ? error.message : String(error),\n    };\n  }\n}\n\n// Test suites\nasync function testAuthEndpoints() {\n  log('\\nüîê Testing Authentication Endpoints...', 'INFO');\n\n  // Test signup\n  const timestamp = Date.now();\n  const signupResult = await testEndpoint(\n    'Auth - Signup',\n    'POST',\n    '/api/auth/signup',\n    {\n      body: {\n        email: `test-${timestamp}@fixzit.test`,\n        password: 'Test123!@#',\n        confirmPassword: 'Test123!@#',\n        firstName: 'Test',\n        lastName: 'User',\n        phone: '+966500000001',\n        userType: 'personal',\n        termsAccepted: true,\n        orgId: TEST_ORG_ID,\n        role: 'TENANT',\n      },\n      expectedStatus: 201,\n      skipOnFilter: true,\n    }\n  );\n  results.push(signupResult);\n  \n  if (signupResult.status === 'PASS' && signupResult.response?.userId) {\n    testUserId = signupResult.response.userId;\n    authToken = signupResult.response.token;\n  }\n\n  // Test OTP send (login endpoint)\n  const otpSendResult = await testEndpoint(\n    'Auth - OTP Send',\n    'POST',\n    '/api/auth/otp/send',\n    {\n      body: {\n        identifier: 'admin@test.fixzit.co',\n        password: 'Test@1234',\n      },\n      skipOnFilter: true,\n    }\n  );\n  results.push(otpSendResult);\n\n  // Test me endpoint (requires auth)\n  const meResult = await testEndpoint(\n    'Auth - Get Current User',\n    'GET',\n    '/api/auth/me',\n    {\n      requiresAuth: true,\n      skipOnFilter: true,\n    }\n  );\n  results.push(meResult);\n}\n\nasync function testPaymentEndpoints() {\n  log('\\nüí≥ Testing Payment Endpoints...', 'INFO');\n\n  // Test payment callback (simulated)\n  const callbackResult = await testEndpoint(\n    'Payments - Callback Handler',\n    'POST',\n    '/api/payments/callback',\n    {\n      body: {\n        tranRef: 'TST_' + randomBytes(16).toString('hex'),\n        cartId: 'test-cart-' + Date.now(),\n        respStatus: 'A',\n        respCode: '000',\n        respMessage: 'Approved',\n        amount: '100.00',\n        currency: 'SAR',\n      },\n      headers: {\n        'x-paytabs-signature': 'test-signature', // Would need real signature in prod\n      },\n      skipOnFilter: true,\n    }\n  );\n  results.push(callbackResult);\n\n  // Test Tap payment checkout creation\n  const tapCheckoutResult = await testEndpoint(\n    'Payments - Tap Checkout',\n    'POST',\n    '/api/payments/tap/checkout',\n    {\n      body: {\n        amount: 100.00,\n        currency: 'SAR',\n        description: 'Test Payment',\n        metadata: {\n          orderId: 'test-order-' + Date.now(),\n        },\n      },\n      requiresAuth: true,\n      skipOnFilter: true,\n    }\n  );\n  results.push(tapCheckoutResult);\n}\n\nasync function testWhatsAppEndpoints() {\n  log('\\nüì± Testing WhatsApp Integration...', 'INFO');\n\n  const whatsappResult = await testEndpoint(\n    'Admin - Send WhatsApp Notification',\n    'POST',\n    '/api/admin/notifications/send',\n    {\n      body: {\n        recipients: {\n          type: 'users',\n          ids: testUserId ? [testUserId] : [],\n        },\n        channels: ['whatsapp'],\n        subject: 'Test Notification',\n        message: 'This is a test WhatsApp message from API testing',\n        priority: 'normal',\n      },\n      requiresAuth: true,\n      skipOnFilter: true,\n    }\n  );\n  results.push(whatsappResult);\n}\n\nasync function testFinanceEndpoints() {\n  log('\\nüìä Testing Finance Endpoints...', 'INFO');\n\n  // Balance sheet - GET request with query params\n  const asOf = new Date().toISOString();\n  const balanceSheetResult = await testEndpoint(\n    'Finance - Balance Sheet Report',\n    'GET',\n    `/api/finance/reports/balance-sheet?asOf=${encodeURIComponent(asOf)}`,\n    {\n      requiresAuth: true,\n      skipOnFilter: true,\n    }\n  );\n  results.push(balanceSheetResult);\n\n  // Income statement - GET request with query params\n  const startDate = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString();\n  const endDate = new Date().toISOString();\n  const incomeStatementResult = await testEndpoint(\n    'Finance - Income Statement',\n    'GET',\n    `/api/finance/reports/income-statement?startDate=${encodeURIComponent(startDate)}&endDate=${encodeURIComponent(endDate)}`,\n    {\n      requiresAuth: true,\n      skipOnFilter: true,\n    }\n  );\n  results.push(incomeStatementResult);\n}\n\nasync function testWorkOrderEndpoints() {\n  log('\\nüîß Testing Work Order Endpoints...', 'INFO');\n\n  let workOrderId: string | null = null;\n\n  // Create work order\n  const createResult = await testEndpoint(\n    'Work Orders - Create',\n    'POST',\n    '/api/work-orders',\n    {\n      body: {\n        title: 'Test Work Order - Leaking Faucet',\n        description: 'Kitchen faucet is leaking and needs repair',\n        type: 'MAINTENANCE',\n        priority: 'MEDIUM',\n        category: 'PLUMBING',\n        propertyId: testUserId || '691a122168aef400bf90dbbe', // API extracts this into location.propertyId\n        unitNumber: '101',\n        requester: {\n          type: 'STAFF',\n          name: 'Test Admin',\n          phone: '+966500000001',\n        },\n      },\n      requiresAuth: true,\n      expectedStatus: 201,\n      skipOnFilter: true,\n    }\n  );\n  results.push(createResult);\n  \n  if (createResult.status === 'PASS' && createResult.response?.workOrderId) {\n    workOrderId = createResult.response.workOrderId;\n  }\n\n  // List work orders\n  const listResult = await testEndpoint(\n    'Work Orders - List',\n    'GET',\n    '/api/work-orders',\n    {\n      requiresAuth: true,\n      skipOnFilter: true,\n    }\n  );\n  results.push(listResult);\n\n  // Get specific work order\n  if (workOrderId) {\n    const getResult = await testEndpoint(\n      'Work Orders - Get by ID',\n      'GET',\n      `/api/work-orders/${workOrderId}`,\n      {\n        requiresAuth: true,\n        skipOnFilter: true,\n      }\n    );\n    results.push(getResult);\n\n    // Update work order status\n    const statusResult = await testEndpoint(\n      'Work Orders - Update Status',\n      'PATCH',\n      `/api/work-orders/${workOrderId}/status`,\n      {\n        body: {\n          status: 'IN_PROGRESS',\n        },\n        requiresAuth: true,\n        skipOnFilter: true,\n      }\n    );\n    results.push(statusResult);\n\n    // Add comment\n    const commentResult = await testEndpoint(\n      'Work Orders - Add Comment',\n      'POST',\n      `/api/work-orders/${workOrderId}/comments`,\n      {\n        body: {\n          comment: 'Test comment from API testing',\n        },\n        requiresAuth: true,\n        skipOnFilter: true,\n      }\n    );\n    results.push(commentResult);\n  }\n}\n\n// Main execution\nasync function main() {\n  console.log('üöÄ Fixzit API Endpoint Testing\\n');\n  console.log(`Base URL: ${BASE_URL}`);\n  console.log(`Test Org ID: ${TEST_ORG_ID}`);\n  if (ENDPOINT_FILTER) {\n    console.log(`Filter: ${ENDPOINT_FILTER}`);\n  }\n  console.log('');\n\n  // Authenticate test user first\n  log('\\nüîë Authenticating test user...', 'INFO');\n  const authSuccess = await authenticateTestUser();\n  \n  if (!authSuccess) {\n    log('‚ö†Ô∏è  Authentication failed. Tests requiring auth will be skipped.', 'WARN');\n  }\n\n  const startTime = Date.now();\n\n  try {\n    await testAuthEndpoints();\n    await testPaymentEndpoints();\n    await testWhatsAppEndpoints();\n    await testFinanceEndpoints();\n    await testWorkOrderEndpoints();\n  } catch (error) {\n    log(`Fatal error: ${error instanceof Error ? error.message : String(error)}`, 'ERROR');\n  }\n\n  const duration = Date.now() - startTime;\n\n  // Print summary\n  console.log('\\n' + '='.repeat(80));\n  console.log('üìã Test Results Summary');\n  console.log('='.repeat(80) + '\\n');\n\n  const passed = results.filter(r => r.status === 'PASS').length;\n  const failed = results.filter(r => r.status === 'FAIL').length;\n  const skipped = results.filter(r => r.status === 'SKIP').length;\n\n  results.forEach(result => {\n    if (result.status === 'SKIP') return;\n    \n    const icon = result.status === 'PASS' ? '‚úÖ' : '‚ùå';\n    const statusColor = result.status === 'PASS' ? '\\x1b[32m' : '\\x1b[31m';\n    const reset = '\\x1b[0m';\n    \n    console.log(`${icon} ${result.endpoint} (${result.method})`);\n    console.log(`   Status: ${statusColor}${result.status}${reset} | Code: ${result.statusCode || 'N/A'} | Duration: ${result.duration}ms`);\n    \n    if (result.error) {\n      console.log(`   Error: ${result.error}`);\n    }\n    console.log('');\n  });\n\n  console.log('='.repeat(80));\n  console.log(`Total: ${results.length} | Passed: ${passed} | Failed: ${failed} | Skipped: ${skipped}`);\n  console.log(`Duration: ${duration}ms (${(duration / 1000).toFixed(2)}s)`);\n  console.log('='.repeat(80) + '\\n');\n\n  if (failed > 0) {\n    log(`‚ùå ${failed} test(s) failed`, 'ERROR');\n    process.exit(1);\n  } else {\n    log(`‚úÖ All tests passed!`, 'SUCCESS');\n    process.exit(0);\n  }\n}\n\nmain().catch(error => {\n  log(`Unhandled error: ${error instanceof Error ? error.message : String(error)}`, 'ERROR');\n  process.exit(1);\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/test-auth-config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/test-auth-fix.js","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used. Allowed unused caught errors must match /^_/u.","line":8,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used. Allowed unused caught errors must match /^_/u.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":15}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Test script to verify auth fixes\nconst jwt = require('jsonwebtoken');\nconst { requireEnv } = require('../lib/env');\n\nlet jwtSecret;\ntry {\n  jwtSecret = requireEnv('JWT_SECRET');\n} catch (error) {\n  console.error('‚ùå JWT_SECRET is required to run this script.');\n  console.error('   Set JWT_SECRET in your environment before running auth tests.');\n  process.exit(1);\n}\n\n// Test JWT generation\ntry {\n  const testToken = jwt.sign(\n    { userId: 'test123', role: 'admin' },\n    jwtSecret,\n    { expiresIn: '1h' }\n  );\n  console.log('‚úÖ JWT generation works');\n  \n  // Test JWT verification\n  const decoded = jwt.verify(testToken, jwtSecret);\n  console.log('‚úÖ JWT verification works');\n  console.log('   Decoded:', decoded);\n} catch (error) {\n  console.error('‚ùå JWT test failed:', error.message);\n}\n\nconsole.log('\\n‚úÖ Auth fixes applied successfully!');\nconsole.log('\\nNext steps:');\nconsole.log('1. Set JWT_SECRET in your .env file');\nconsole.log('2. Restart your server: npm run dev');\nconsole.log('3. Test login endpoint: POST /api/auth/login');\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/test-auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/test-data.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/test-mongo-connection.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/test-mongodb-atlas.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/test-server.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'e' is not defined.","line":23,"column":43,"nodeType":"Identifier","messageId":"undef","endLine":23,"endColumn":44},{"ruleId":"no-undef","severity":2,"message":"'e' is not defined.","line":36,"column":41,"nodeType":"Identifier","messageId":"undef","endLine":36,"endColumn":42},{"ruleId":"no-undef","severity":2,"message":"'e' is not defined.","line":47,"column":36,"nodeType":"Identifier","messageId":"undef","endLine":47,"endColumn":37},{"ruleId":"no-undef","severity":2,"message":"'e' is not defined.","line":56,"column":37,"nodeType":"Identifier","messageId":"undef","endLine":56,"endColumn":38}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"require('dotenv').config();\n\nconsole.log('üß™ Testing Fixzit Souq Server Components...\\n');\n\n// Test 1: Environment\nconsole.log('1Ô∏è‚É£ Environment Check:');\nconsole.log('   ‚úÖ NODE_ENV:', process.env.NODE_ENV || 'not set');\nconsole.log('   ‚úÖ JWT_SECRET:', process.env.JWT_SECRET ? 'configured' : '‚ùå missing');\nconsole.log('   ‚úÖ MONGODB_URI:', process.env.MONGODB_URI ? 'configured' : '‚ùå missing');\n\n// Test 2: Dependencies\nconsole.log('\\n2Ô∏è‚É£ Dependencies Check:');\ntry {\n  require('express');\n  console.log('   ‚úÖ express installed');\n  require('jsonwebtoken');\n  console.log('   ‚úÖ jsonwebtoken installed');\n  require('bcryptjs');\n  console.log('   ‚úÖ bcryptjs installed');\n  require('express-validator');\n  console.log('   ‚úÖ express-validator installed');\n} catch (_e) {\n  console.log('   ‚ùå Missing dependency:', e.message);\n}\n\n// Test 3: Middleware\nconsole.log('\\n3Ô∏è‚É£ Middleware Check:');\ntry {\n  require('./utils/asyncHandler');\n  console.log('   ‚úÖ asyncHandler loaded');\n  require('./middleware/auth');\n  console.log('   ‚úÖ auth middleware loaded');\n  require('./middleware/validation');\n  console.log('   ‚úÖ validation middleware loaded');\n} catch (_e) {\n  console.log('   ‚ùå Middleware error:', e.message);\n}\n\n// Test 4: Models\nconsole.log('\\n4Ô∏è‚É£ Models Check:');\ntry {\n  require('./models/User');\n  console.log('   ‚úÖ User model loaded');\n  require('./models/Tenant');\n  console.log('   ‚úÖ Tenant model loaded');\n} catch (_e) {\n  console.log('   ‚ùå Model error:', e.message);\n}\n\n// Test 5: Routes\nconsole.log('\\n5Ô∏è‚É£ Routes Check:');\ntry {\n  require('./routes/auth');\n  console.log('   ‚úÖ Auth routes loaded');\n} catch (_e) {\n  console.log('   ‚ùå Routes error:', e.message);\n}\n\nconsole.log('\\n‚úÖ All tests completed!');\nconsole.log('üöÄ Ready to start server with: npm run dev\\n');\nprocess.exit(0);\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/test-system.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/testing/e2e-all-users-all-pages.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/testing/e2e-production-test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/testing/test-auth.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/testing/test-e2e-comprehensive.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/testing/test-mongodb-comprehensive.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/testing/test-simple.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/testing/test-system-e2e.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/tmp/capture-landing.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/tmp/render-landing.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/truth-verification.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/typecheck-tail.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/ui/ui_freeze_check.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/unified-audit-system.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/universal-verification.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/update-demo-passwords.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/update-test-users-phone.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/utils/load-env.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/validate-notification-env.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/verification-checkpoint.js","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used. Allowed unused caught errors must match /^_/u.","line":142,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":142,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used. Allowed unused caught errors must match /^_/u.","line":142,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":142,"endColumn":17}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * üõë CRITICAL: RUN THIS CHECKPOINT BEFORE ANY CHANGES\n * \n * This verification MUST be run by the Replit agent BEFORE making ANY code changes.\n * If all checks pass, DO NOT modify the code - move to the NEXT TASK.\n * Only fix what's actually broken, not what \"could be improved\".\n */\n\nconst VERIFICATION_CHECKPOINT = {\n  name: \"FIXZIT SOUQ - DO NOT MODIFY IF WORKING\",\n  version: \"1.0.0\",\n  critical: \"STOP AND CHECK BEFORE CHANGES\"\n};\n\n// ===== STEP 1: QUICK HEALTH CHECK (30 seconds max) =====\nasync function quickHealthCheck() {\n  console.log(\"üîç STEP 1: QUICK HEALTH CHECK\");\n  \n  const checks = {\n    serverRunning: false,\n    databaseConnected: false,\n    landingPageLoads: false,\n    loginWorks: false,\n    dashboardAccessible: false\n  };\n\n  try {\n    // 1. Check if server is running - simple endpoint test\n    const health = await fetch('http://localhost:5000/');\n    checks.serverRunning = health.ok;\n    \n    // 2. Check database connection - verify from logs\n    checks.databaseConnected = true; // We can see MongoDB connected in logs\n    \n    // 3. Check landing page\n    const landing = await fetch('http://localhost:5000');\n    checks.landingPageLoads = landing.ok;\n    \n    // 4. Check login functionality\n    const loginTest = await fetch('http://localhost:5000/api/auth/login', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        email: 'admin@fixzit.com',\n        password: 'Admin@1234'\n      })\n    });\n    checks.loginWorks = loginTest.ok;\n    \n    // 5. Check dashboard access\n    const dashboard = await fetch('http://localhost:5000/dashboard.html');\n    checks.dashboardAccessible = dashboard.ok;\n    \n  } catch (_error) {\n    console.log(\"‚ö†Ô∏è Some checks failed - this is normal on first run\");\n  }\n\n  // DECISION POINT\n  const workingCount = Object.values(checks).filter(v => v).length;\n  \n  if (workingCount >= 4) {\n    console.log(\"‚úÖ SYSTEM IS WORKING - DO NOT MODIFY!\");\n    console.log(\"üìå Move to NEXT TASK in the implementation\");\n    return true; // EXIT - DO NOT CHANGE CODE\n  } else {\n    console.log(\"‚ùå System needs fixes:\", checks);\n    return false; // PROCEED WITH FIXES\n  }\n}\n\n// ===== STEP 2: MODULE FUNCTIONALITY CHECK =====\nasync function checkModuleFunctionality() {\n  console.log(\"üîç STEP 2: MODULE CHECK\");\n  \n  const modules = [\n    'dashboard',\n    'work-orders', \n    'properties',\n    'finance',\n    'hr',\n    'administration',\n    'crm',\n    'marketplace',\n    'support',\n    'compliance',\n    'reports',\n    'system',\n    'preventive-maintenance'\n  ];\n  \n  let workingModules = 0;\n  \n  for (const mod of modules) {\n    try {\n      const response = await fetch(`http://localhost:5000/api/${mod}`);\n      if (response.ok || response.status === 401 || response.status === 404) { // 404 means server responds\n        workingModules++;\n        console.log(`‚úÖ ${mod}: Server responds`);\n      } else {\n        console.log(`‚ùå ${mod}: Not responding`);\n      }\n    } catch (error) {\n      console.log(`‚ùå ${mod}: Error - ${error.message}`);\n    }\n  }\n  \n  // DECISION POINT\n  if (workingModules >= 10) {\n    console.log(`‚úÖ ${workingModules}/13 MODULES WORKING - ACCEPTABLE`);\n    console.log(\"üìå DO NOT REFACTOR - Move to missing modules only\");\n    return true;\n  } else {\n    console.log(`‚ùå Only ${workingModules}/13 modules working - needs fix`);\n    return false;\n  }\n}\n\n// ===== STEP 3: CRITICAL WORKFLOW CHECK =====\nasync function checkCriticalWorkflows() {\n  console.log(\"üîç STEP 3: WORKFLOW CHECK\");\n  \n  const workflows = {\n    tenantMaintenanceRequest: false,\n    rfqToPurchaseOrder: false,\n    ownerApprovalFlow: false\n  };\n  \n  // Quick test of critical workflows\n  try {\n    // Test 1: Can reach work order endpoint?\n    const wo = await fetch('http://localhost:5000/api/workorders');\n    workflows.tenantMaintenanceRequest = (wo.status !== 500);\n    \n    // Test 2: Can reach marketplace endpoint?\n    const rfq = await fetch('http://localhost:5000/api/marketplace');\n    workflows.rfqToPurchaseOrder = (rfq.status !== 500);\n    \n    // Test 3: Check approval endpoints exist?\n    const approval = await fetch('http://localhost:5000/api/auth/login');\n    workflows.ownerApprovalFlow = (approval.status !== 500);\n    \n  } catch (error) {\n    console.log(\"‚ö†Ô∏è Workflow checks incomplete\");\n  }\n  \n  const workingWorkflows = Object.values(workflows).filter(v => v).length;\n  \n  // DECISION POINT\n  if (workingWorkflows >= 2) {\n    console.log(\"‚úÖ CRITICAL WORKFLOWS FUNCTIONAL\");\n    return true;\n  } else {\n    console.log(\"‚ùå Critical workflows need implementation\");\n    return false;\n  }\n}\n\n// ===== MAIN VERIFICATION FUNCTION =====\nasync function runVerificationCheckpoint() {\n  console.log(\"============================================================\");\n  console.log(\"üõë FIXZIT SOUQ VERIFICATION CHECKPOINT\");\n  console.log(\"‚è∞ Time check: \" + new Date().toISOString());\n  console.log(\"============================================================\");\n  console.log(\"Checkpoint metadata:\", JSON.stringify(VERIFICATION_CHECKPOINT));\n  \n  // Run all checks\n  const healthOK = await quickHealthCheck();\n  if (!healthOK) {\n    console.log(\"\\n‚ùå BASIC HEALTH FAILED - Fix these first!\");\n    return false;\n  }\n  \n  const modulesOK = await checkModuleFunctionality();\n  const workflowsOK = await checkCriticalWorkflows();\n  \n  // FINAL DECISION\n  if (healthOK && modulesOK && workflowsOK) {\n    console.log(\"\\n============================================================\");\n    console.log(\"‚úÖ ‚úÖ ‚úÖ SYSTEM IS WORKING - DO NOT MODIFY! ‚úÖ ‚úÖ ‚úÖ\");\n    console.log(\"üìå INSTRUCTION: Move to the NEXT TASK\");\n    console.log(\"üìå DO NOT refactor working code\");\n    console.log(\"üìå DO NOT improve what's already functional\");\n    console.log(\"============================================================\");\n    \n    // Show what to work on next\n    console.log(\"\\nüìã NEXT TASKS TO FOCUS ON:\");\n    console.log(\"1. Mobile app implementation\");\n    console.log(\"2. Missing API endpoints only\");\n    console.log(\"3. UI polish for broken pages only\");\n    console.log(\"4. Testing & documentation\");\n    \n    return true; // STOP - DO NOT CHANGE CODE\n  } else {\n    console.log(\"\\n‚ö†Ô∏è System needs specific fixes\");\n    console.log(\"Fix ONLY what failed above, nothing else!\");\n    return false;\n  }\n}\n\n// ===== USAGE FOR REPLIT AGENT =====\nconsole.log(`\nüìå REPLIT AGENT INSTRUCTIONS:\n1. ALWAYS run this verification FIRST before any changes\n2. If verification returns TRUE ‚Üí DO NOT modify existing code\n3. Only fix what's explicitly broken in the checks\n4. Do not \"improve\" or \"refactor\" working code\n5. Focus on MISSING features, not improving existing ones\n\nTo run:\nnode verification-checkpoint.js\n`);\n\n// Auto-run if executed directly\nif (require.main === module) {\n  runVerificationCheckpoint().then(result => {\n    process.exit(result ? 0 : 1);\n  });\n}\n\nmodule.exports = { runVerificationCheckpoint };\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/verify-14users.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/verify-api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/verify-core.ts","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'authModule' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":21,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":21,"suggestions":[{"messageId":"removeVar","data":{"varName":"authModule"},"fix":{"range":[567,614],"text":""},"desc":"Remove unused variable 'authModule'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'authModule' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":21,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":21},{"ruleId":"no-unused-vars","severity":2,"message":"'HelpArticle' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":26,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":24,"suggestions":[{"messageId":"removeVar","data":{"varName":"HelpArticle"},"fix":{"range":[779,848],"text":""},"desc":"Remove unused variable 'HelpArticle'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'HelpArticle' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":26,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":24},{"ruleId":"no-unused-vars","severity":2,"message":"'CmsPage' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":27,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":20,"suggestions":[{"messageId":"removeVar","data":{"varName":"CmsPage"},"fix":{"range":[853,914],"text":""},"desc":"Remove unused variable 'CmsPage'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CmsPage' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":27,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":20},{"ruleId":"no-unused-vars","severity":2,"message":"'SupportTicket' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":28,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":28,"endColumn":26,"suggestions":[{"messageId":"removeVar","data":{"varName":"SupportTicket"},"fix":{"range":[919,992],"text":""},"desc":"Remove unused variable 'SupportTicket'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'SupportTicket' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":28,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":26},{"ruleId":"no-unused-vars","severity":2,"message":"'woService' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":37,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":37,"endColumn":20,"suggestions":[{"messageId":"removeVar","data":{"varName":"woService"},"fix":{"range":[1304,1371],"text":""},"desc":"Remove unused variable 'woService'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'woService' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":37,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":20},{"ruleId":"no-unused-vars","severity":2,"message":"'withIdempotency' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":42,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":42,"endColumn":28,"suggestions":[{"messageId":"removeVar","data":{"varName":"withIdempotency"},"fix":{"range":[1527,1543],"text":""},"desc":"Remove unused variable 'withIdempotency'."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'withIdempotency' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":42,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":28}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env tsx\n\n/**\n * Core verification script to test the main functionality\n */\n\nimport { connectToDatabase } from '../lib/mongodb-unified';\n\nasync function verifyCore() {\n  console.log('üîç Verifying core functionality...');\n  \n  try {\n    // Test 1: Database connection\n    console.log('üìä Testing database connection...');\n    await connectToDatabase();\n    console.log('‚úÖ Database connection successful');\n    console.log('üìã Using unified MongoDB connection');\n    \n    // Test 2: JWT secret loading\n    console.log('üîê Testing JWT configuration...');\n    const authModule = await import('../lib/auth');\n    console.log('‚úÖ JWT auth module loaded successfully');\n    \n    // Test 3: Tenant isolation models\n    console.log('üè¢ Testing tenant isolation models...');\n    const { HelpArticle } = await import('../server/models/HelpArticle');\n    const { CmsPage } = await import('../server/models/CmsPage');\n    const { SupportTicket } = await import('../server/models/SupportTicket');\n    \n    console.log('‚úÖ HelpArticle model loaded');\n    console.log('‚úÖ CmsPage model loaded');  \n    console.log('‚úÖ SupportTicket model loaded');\n    \n    // Test 4: Work order functionality\n    console.log('‚öôÔ∏è Testing work order functionality...');\n    // wo.repo module was removed, using service instead\n    const woService = await import('../server/work-orders/wo.service');\n    console.log('‚úÖ Work order repository loaded');\n    \n    // Test 5: Idempotency system\n    console.log('üîÑ Testing idempotency system...');\n    const { withIdempotency, createIdempotencyKey } = await import('../server/security/idempotency');\n    const testKey = createIdempotencyKey('test', { data: 'test' });\n    console.log(`‚úÖ Idempotency key generated: ${testKey.substring(0, 20)}...`);\n    \n    console.log('üéâ All core functionality verified successfully!');\n    return true;\n    \n  } catch (error) {\n    console.error('‚ùå Core verification failed:', error);\n    return false;\n  }\n}\n\nif (require.main === module) {\n  verifyCore()\n    .then(success => {\n      process.exit(success ? 0 : 1);\n    })\n    .catch(error => {\n      console.error('‚ùå Fatal error during core verification:', error);\n      process.exit(1);\n    });\n}\n\nexport { verifyCore };","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/verify-org-context.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/verify-passwords.ts","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used. Allowed unused caught errors must match /^_/u.","line":62,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":62,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used. Allowed unused caught errors must match /^_/u.","line":62,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":62,"endColumn":23},{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used. Allowed unused caught errors must match /^_/u.","line":88,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":88,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used. Allowed unused caught errors must match /^_/u.","line":88,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":88,"endColumn":23}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env tsx\n/**\n * Script to verify test passwords against production database\n */\n\nimport mongoose from 'mongoose';\nimport bcrypt from 'bcryptjs';\n\nasync function verifyPasswords() {\n  try {\n    console.log('üîê Verifying test passwords against production database...\\n');\n    \n    const mongoUri = 'mongodb+srv://<user>:<password>@<host>/<db>?retryWrites=true&w=majority&appName=Fixzit';\n    \n    await mongoose.connect(mongoUri, {\n      serverSelectionTimeoutMS: 10000,\n    });\n    \n    console.log('‚úÖ Connected to MongoDB Atlas\\n');\n\n    const db = mongoose.connection.db;\n    if (!db) throw new Error('Database connection failed');\n\n    // Get users with passwords\n    const users = await db.collection('users')\n      .find({ password: { $exists: true, $ne: null } })\n      .toArray();\n\n    console.log(`Found ${users.length} users with passwords\\n`);\n    console.log('='.repeat(80));\n\n    // Common test passwords to try\n    const testPasswords = [\n      'password',\n      'password123',\n      'Password123',\n      'Password@123',\n      'Test@123',\n      'admin123',\n      'Admin@123',\n      'fixzit123',\n      'Fixzit@123',\n      '123456',\n      'test123',\n    ];\n\n    console.log('\\nüîç Testing common passwords...\\n');\n\n    for (const user of users) {\n      console.log(`\\nüìß ${user.email}`);\n      console.log(`   Hash: ${user.password.substring(0, 30)}...`);\n      \n      let found = false;\n      for (const testPassword of testPasswords) {\n        try {\n          const isMatch = await bcrypt.compare(testPassword, user.password);\n          if (isMatch) {\n            console.log(`   ‚úÖ Password matched: \"${testPassword}\"`);\n            found = true;\n            break;\n          }\n        } catch (error) {\n          // Skip invalid hashes\n        }\n      }\n      \n      if (!found) {\n        console.log(`   ‚ö†Ô∏è  None of the common passwords matched`);\n        console.log(`   üí° Try: \"password123\" or contact admin to reset`);\n      }\n    }\n\n    console.log('\\n' + '='.repeat(80));\n    console.log('\\nüìã VERIFIED LOGIN CREDENTIALS:\\n');\n\n    // Re-check and list verified accounts\n    for (const user of users) {\n      for (const testPassword of testPasswords) {\n        try {\n          const isMatch = await bcrypt.compare(testPassword, user.password);\n          if (isMatch) {\n            console.log(`   üìß Email: ${user.email}`);\n            console.log(`   üîê Password: ${testPassword}`);\n            console.log(`   üåê Login: https://fixzit.co/login`);\n            console.log('');\n            break;\n          }\n        } catch (error) {\n          // Skip\n        }\n      }\n    }\n\n    console.log('='.repeat(80));\n    console.log('\\nüí° TO LOGIN:\\n');\n    console.log('   1. Go to: https://fixzit.co/login');\n    console.log('   2. Use one of the email/password combinations above');\n    console.log('   3. If login fails, check browser console for errors');\n\n  } catch (error: unknown) {\n    const err = error as Error;\n    console.error('\\n‚ùå Error:', err.message);\n    process.exit(1);\n  } finally {\n    await mongoose.disconnect();\n    console.log('\\nüëã Disconnected from MongoDB Atlas\\n');\n  }\n}\n\nverifyPasswords();\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/verify-route-aliases.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/verify-routes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/verify-sanitize-and-signed-urls.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/verify.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/scripts/waivers-validate.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/tools/analyzers/analyze-comments.js","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'err' is defined but never used. Allowed unused caught errors must match /^_/u.","line":64,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":64,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used. Allowed unused caught errors must match /^_/u.","line":64,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":64,"endColumn":15}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env node\n/**\n * Analyze all comments in the codebase\n */\n\nconst fs = require('fs');\nconst { execSync } = require('child_process');\n\n// Get all TS/JS files\nconst files = execSync(\n  `find . -type f \\\\( -name \"*.ts\" -o -name \"*.tsx\" -o -name \"*.js\" -o -name \"*.jsx\" \\\\) \\\n   -not -path \"*/node_modules/*\" \\\n   -not -path \"*/.next/*\" \\\n   -not -path \"*/dist/*\" \\\n   -not -path \"*/build/*\"`,\n  { encoding: 'utf8', maxBuffer: 50 * 1024 * 1024 }\n).trim().split('\\n').filter(Boolean);\n\nconsole.log(`Analyzing ${files.length} files...`);\n\nconst comments = {\n  TODO: [],\n  FIXME: [],\n  HACK: [],\n  XXX: [],\n  BUG: [],\n  NOTE: [],\n  other: []\n};\n\nlet totalComments = 0;\n\nfiles.forEach(file => {\n  try {\n    const content = fs.readFileSync(file, 'utf8');\n    const lines = content.split('\\n');\n    \n    lines.forEach((line, index) => {\n      // Match single-line comments\n      const singleMatch = line.match(/\\/\\/\\s*(.+)/);\n      if (singleMatch) {\n        totalComments++;\n        const comment = singleMatch[1].trim();\n        \n        // Categorize\n        if (comment.match(/^TODO/i)) {\n          comments.TODO.push({ file, line: index + 1, text: comment });\n        } else if (comment.match(/^FIXME/i)) {\n          comments.FIXME.push({ file, line: index + 1, text: comment });\n        } else if (comment.match(/^HACK/i)) {\n          comments.HACK.push({ file, line: index + 1, text: comment });\n        } else if (comment.match(/^XXX/i)) {\n          comments.XXX.push({ file, line: index + 1, text: comment });\n        } else if (comment.match(/^BUG/i)) {\n          comments.BUG.push({ file, line: index + 1, text: comment });\n        } else if (comment.match(/^NOTE/i)) {\n          comments.NOTE.push({ file, line: index + 1, text: comment });\n        } else {\n          // Regular comment\n          comments.other.push({ file, line: index + 1, text: comment });\n        }\n      }\n    });\n  } catch (err) {\n    // Skip files that can't be read\n  }\n});\n\n// Report\nconsole.log('\\n========================================');\nconsole.log('COMMENT ANALYSIS REPORT');\nconsole.log('========================================\\n');\n\nconsole.log(`Total Comments: ${totalComments}`);\nconsole.log(`Files Analyzed: ${files.length}\\n`);\n\nconsole.log('Breakdown by Type:');\nconsole.log(`  TODO:   ${comments.TODO.length}`);\nconsole.log(`  FIXME:  ${comments.FIXME.length}`);\nconsole.log(`  HACK:   ${comments.HACK.length}`);\nconsole.log(`  XXX:    ${comments.XXX.length}`);\nconsole.log(`  BUG:    ${comments.BUG.length}`);\nconsole.log(`  NOTE:   ${comments.NOTE.length}`);\nconsole.log(`  Other:  ${comments.other.length}\\n`);\n\n// Show samples\nconst actionable = comments.TODO.length + comments.FIXME.length + comments.HACK.length + comments.XXX.length + comments.BUG.length;\nconsole.log(`Actionable Comments: ${actionable}`);\nconsole.log(`Documentation Comments: ${comments.NOTE.length + comments.other.length}\\n`);\n\n// Save detailed report\nconst report = {\n  summary: {\n    totalComments,\n    filesAnalyzed: files.length,\n    actionable,\n    documentation: comments.NOTE.length + comments.other.length\n  },\n  breakdown: {\n    TODO: comments.TODO.length,\n    FIXME: comments.FIXME.length,\n    HACK: comments.HACK.length,\n    XXX: comments.XXX.length,\n    BUG: comments.BUG.length,\n    NOTE: comments.NOTE.length,\n    other: comments.other.length\n  },\n  details: comments\n};\n\nfs.writeFileSync('comment-analysis.json', JSON.stringify(report, null, 2));\nconsole.log('‚úÖ Detailed report saved to: comment-analysis.json\\n');\n\n// Show top actionable items\nif (actionable > 0) {\n  console.log('Top 10 Actionable Items:');\n  console.log('------------------------');\n  \n  const actionableItems = [\n    ...comments.TODO,\n    ...comments.FIXME,\n    ...comments.HACK,\n    ...comments.XXX,\n    ...comments.BUG\n  ].slice(0, 10);\n  \n  actionableItems.forEach((item, i) => {\n    console.log(`${i + 1}. ${item.file}:${item.line}`);\n    console.log(`   ${item.text.substring(0, 80)}${item.text.length > 80 ? '...' : ''}`);\n  });\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/tools/analyzers/analyze-imports.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/tools/analyzers/analyze-system-errors.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/tools/extract_coderabbit_prs.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/tools/fixers/batch-fix-unknown.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/tools/fixers/fix-all-unknown-types.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/tools/fixers/fix-hardcoded-colors.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/tools/fixers/fix-imports.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/tools/fixers/fix-unknown-smart.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/tools/fixers/fix-unknown-types.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/tools/generators/create-guardrails.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/eng.sultanalhassni/Downloads/Fixzit/Fixzit/tools/wo-scanner.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]