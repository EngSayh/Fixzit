{
  "name": "Fixzit Dev Container",
  "image": "mcr.microsoft.com/devcontainers/typescript-node:1-22-bookworm",
  "features": {
    "ghcr.io/devcontainers/features/github-cli:1": {},
    "ghcr.io/devcontainers/features/git:1": {},
    "ghcr.io/devcontainers/features/docker-in-docker:2": {}
  },
  "mounts": [
    "source=vscode-server,target=/home/node/.vscode-server,type=volume",
    "source=qodo-history,target=/home/node/.qodo,type=volume"
  ],
  "customizations": {
    "vscode": {
      "extensions": [
        "GitHub.copilot",
        "GitHub.copilot-chat",
        "ms-vscode.vscode-typescript-next",
        "dbaeumer.vscode-eslint",
        "esbenp.prettier-vscode"
      ],
      "settings": {
        // — Agent: Security-conscious configuration for shared devcontainer —
        "chat.agent.enabled": true,
        "chat.agent.maxRequests": 999,
        
        // SECURITY: Auto-approve disabled in shared environment.
        // Developers who want auto-approve should configure it in their personal User Settings.
        // Do not re-enable these in the shared devcontainer configuration.

        // Stop interactive CLI pauses (y/n, prompts)
        "chat.tools.terminal.autoReplyToPrompts": true,

        // Auto-accept edits DISABLED for security (developers can enable in User Settings)
        // "chat.editing.autoAcceptDelay": 3,

        // Checkpoints for rollback
        "chat.checkpoints.enabled": true,
        
        // Disable notification balloons
        "chat.notifyWindowOnConfirmation": false,

        // Disable MCP discovery (boolean, not object)
        "chat.mcp.discovery.enabled": false,

        // SECURITY: Workspace trust ENABLED (critical security boundary).
        // Do not disable workspace trust in shared devcontainer - users must be warned about untrusted code.
        // The startup prompt is intentional and required for security.
        // Lines below are commented out to use VS Code defaults (trust enabled):
        // "security.workspace.trust.enabled": true,
        // "security.workspace.trust.untrustedFiles": "prompt",
        // "security.workspace.trust.startupPrompt": "default",

        // Agent can run tasks silently
        "github.copilot.chat.agent.runTasks": true,
        "github.copilot.chat.codeGeneration.useInstructionFiles": true,

        // Editor QoL
        "git.branchProtection": ["main", "master"],
        "git.branchProtectionPrompt": "alwaysPrompt"
      }
    }
  },
  "containerEnv": {
    "NO_PROXY": "127.0.0.1,localhost,.local,.internal,.docker,github.com,api.github.com,githubusercontent.com,githubcopilot.com,githubcontent.com,copilot-proxy.githubusercontent.com,origin-tracker.githubusercontent.com",
    "no_proxy": "${containerEnv:NO_PROXY}"
  },
  "remoteEnv": {
    "HTTP_PROXY": "${localEnv:HTTP_PROXY}",
    "HTTPS_PROXY": "${localEnv:HTTPS_PROXY}"
  },
  "postCreateCommand": "bash -c 'if [ -f .devcontainer/setup.sh ]; then bash .devcontainer/setup.sh; else echo Setup script not found, skipping...; fi'",
  "remoteUser": "node",
  "updateRemoteUserUID": true,
  "waitFor": "onCreateCommand"
}
