{
  "name": "Fixzit Dev Container",
  "image": "mcr.microsoft.com/devcontainers/typescript-node:1-22-bookworm",
  "features": {
    "ghcr.io/devcontainers/features/github-cli:1": {},
    "ghcr.io/devcontainers/features/git:1": {},
    "ghcr.io/devcontainers/features/docker-in-docker:2": {}
  },
  "mounts": [
    "source=vscode-server,target=/home/node/.vscode-server,type=volume",
    "source=qodo-history,target=/home/node/.qodo,type=volume"
  ],
  "customizations": {
    "vscode": {
      "extensions": [
        "GitHub.copilot",
        "GitHub.copilot-chat",
        "ms-vscode.vscode-typescript-next",
        "dbaeumer.vscode-eslint",
        "esbenp.prettier-vscode"
      ],
      "settings": {
        // Agent mode - Maximum autonomy in container (safe environment)
        "chat.agent.enabled": true,
        "chat.agent.maxRequests": 999,
        "chat.tools.global.autoApprove": true,
        "chat.tools.terminal.autoReplyToPrompts": true,
        "github.copilot.chat.agent.runTasks": true,
        "chat.notifyWindowOnConfirmation": false,
        "chat.checkpoints.enabled": true,
        "chat.editing.autoAccept": 3,
        "github.copilot.chat.virtualTools.threshold": 0,
        
        // MCP Discovery - disable in container
        "chat.mcp.discovery.enabled": {
          "claude-desktop": false,
          "windsurf": false,
          "cursor-global": false,
          "cursor-workspace": false
        },
        
        // File edits - auto-approve pattern (container-safe)
        "chat.tools.edits.autoApprove": {
          "**/*": true,
          "**/.env*": false,
          "**/.vscode/**": false,
          "**/package.json": false,
          "**/pnpm-lock.yaml": false
        },
        
        // Terminal commands - comprehensive allow/deny
        "chat.tools.terminal.autoApprove": {
          "/^git (status|branch|checkout\\b.*|add\\b.*|commit\\b.*|push\\b.*|show\\b.*|diff\\b.*|fetch\\b.*|stash\\b.*|restore\\b.*|switch\\b.*)$/": true,
          "/^(npm|pnpm|yarn|bun) (ci|install|run build|run dev|run test|run lint|test\\b.*|build\\b.*)$/": true,
          "bash": true,
          "sh": true,
          "node": true,
          "npx": true,
          "git": true,
          "gh": true,
          "python": true,
          "pytest": true,
          "docker": true,
          "make": true,
          "echo": true,
          "cat": true,
          "ls": true,
          "pwd": true,
          "mkdir": true,
          "cp": true,
          
          // Block dangerous operations
          "del": false,
          "rm": false,
          "rmdir": false,
          "chmod": false,
          "chown": false,
          "/^git push\\s+origin\\s+(main|master)$/": false,
          "/^git push\\s+--force/": false
        },
        
        // Workspace trust - container is safe environment
        "security.workspace.trust.enabled": false,
        "security.workspace.trust.untrustedFiles": "open",
        "security.workspace.trust.startupPrompt": "never",
        
        // Git branch protection
        "git.branchProtection": ["main", "master"],
        "git.branchProtectionPrompt": "alwaysPrompt",
        
        // Copilot instructions
        "github.copilot.chat.codeGeneration.useInstructionFiles": true
      }
    }
  },
  "containerEnv": {
    "NO_PROXY": "127.0.0.1,localhost,.local,.internal,.docker,github.com,api.github.com,githubusercontent.com,githubcopilot.com,githubcontent.com,copilot-proxy.githubusercontent.com,origin-tracker.githubusercontent.com",
    "no_proxy": "${containerEnv:NO_PROXY}"
  },
  "remoteEnv": {
    "HTTP_PROXY": "${localEnv:HTTP_PROXY}",
    "HTTPS_PROXY": "${localEnv:HTTPS_PROXY}"
  },
  "postCreateCommand": "bash -c 'if [ -f .devcontainer/setup.sh ]; then bash .devcontainer/setup.sh; else echo Setup script not found, skipping...; fi'",
  "remoteUser": "node",
  "updateRemoteUserUID": true,
  "waitFor": "onCreateCommand"
}
